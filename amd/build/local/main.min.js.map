{"version":3,"file":"main.min.js","sources":["../../src/local/main.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module     local_deepler/deepler\n * @file       amd/src/local/ui_deepler.js\n * @copyright  2025 Bruno Baudry <bruno.baudry@bfh.ch>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n\ndefine(['core/log',\n    'editor_tiny/loader',\n    'editor_tiny/editor',\n    'core/modal',\n    './selectors',\n    './translation',\n    './utils',\n    './customevents',\n    './scrollspy',\n    './api'\n], (Log, TinyMCEinit, TinyMCE,\n    Modal,\n    Selectors,\n    Translation,\n    Utils,\n    Events,\n    ScrollSpy,\n    Api) => {\n\n\n        // Cached DOM elements\n        const cachedSelectors = {\n            wordCount: document.querySelector(Selectors.statuses.wordcount),\n            charWithSpace: document.querySelector(Selectors.statuses.charNumWithSpace),\n            charWOSpace: document.querySelector(Selectors.statuses.charNumWithOutSpace),\n            deeplUseSpan: document.querySelector(Selectors.statuses.deeplUsage),\n            deeplMaxSpan: document.querySelector(Selectors.statuses.deeplMax),\n            deeplStatusContainer: document.querySelector(Selectors.statuses.deeplStatusContainer)\n        };\n\n    let offsetTop; // Highest point of the usable plugin UI.\n    let hideiframes = {};\n    // Store removed iframes and their parent/next sibling for restoration.\n    let removedIframes = [];\n\n    let config = {};\n    let langstrings = {};\n    let autotranslateButton = {};\n    let saveAllBtn = {};\n    let selectAllBtn = {};\n    let checkboxes = [];\n    let format = new Intl.NumberFormat();\n    let saveAllModal = {};\n    let errordbtitle = '';\n    let settingsUI = {};\n    let allDataFormatOne = [];\n    let glossaryDetailViewr;\n    let filterTimeout;\n\n    /**\n     * Event factories.\n     */\n    const registerEventListeners = () => {\n        document.addEventListener('change', handleChangeEvent);\n        document.addEventListener('click', handleClickEvent);\n        document.addEventListener('focusin', handleFocusEvent);\n\n        // Translation events.\n        Events.on(Translation.ON_ITEM_TRANSLATED, onItemTranslated);\n        Events.on(Translation.ON_TRANSLATION_FAILED, onTranslationFailed);\n        Events.on(Translation.ON_TRANSLATION_DONE, onTranslationDone);\n        Events.on(Translation.ON_REPHRASE_FAILED, onTranslationFailed);\n        Events.on(Translation.ON_DB_SAVE_SUCCESS, onDbSavedSuccess);\n        Events.on(Translation.ON_DB_FAILED, onDBFailed);\n        Events.on(Translation.ON_ITEM_SAVED, onSuccessMessageItem);\n        Events.on(Translation.ON_ITEM_NOT_SAVED, onErrorMessageItem);\n        Events.on(Api.GLOSSARY_DB_ALL_FAILED, onGlossaryDbAllfailed);\n        Events.on(Api.GLOSSARY_DB_FAILED, onGlossaryDbfailed);\n        Events.on(Api.GLOSSARY_DB_SUCCESS, onGlossaryDbSuccess);\n        Events.on(Api.GLOSSARY_ENTRIES_SUCCESS, showEntriesModal);\n        Events.on(Api.GLOSSARY_ENTRIES_FAILED, (e)=>Log.error(e));\n    };\n\n    /**\n     * Register UI elements.\n     */\n    const registerUI = () => {\n\n        try {\n            allDataFormatOne = Utils.domQueryAll(Selectors.editors.targetarea);\n            hideiframes = Utils.domQuery(Selectors.actions.hideiframes);\n            langstrings = JSON.parse(Utils.domQuery(Selectors.config.langstrings).getAttribute('data-langstrings'));\n            errordbtitle = langstrings.uistrings.errordbtitle;\n            saveAllBtn = Utils.domQuery(Selectors.actions.saveAll);\n            selectAllBtn = Utils.domQuery(Selectors.actions.selectAllBtn);\n            autotranslateButton = Utils.domQuery(Selectors.actions.autoTranslateBtn);\n            checkboxes = Utils.domQueryAll(Selectors.actions.checkBoxes);\n\nif (!glossaryDetailViewr && document.querySelector(Selectors.glossary.entriesviewerPage)) {\n    glossaryDetailViewr = document.querySelector(Selectors.glossary.entriesviewerPage);\n}\n\n            settingsUI[Selectors.deepl.glossaryId] = Utils.domQuery(Selectors.deepl.glossaryId);\n            settingsUI[Selectors.deepl.context] = Utils.domQuery(Selectors.deepl.context);\n            settingsUI[Selectors.deepl.formality] = Utils.domQuery(Selectors.deepl.formality);\n            settingsUI[Selectors.deepl.modelType] = Utils.domQuery(Selectors.deepl.modelType);\n            settingsUI[Selectors.deepl.ignoreTags] = Utils.domQuery(Selectors.deepl.ignoreTags);\n            settingsUI[Selectors.deepl.nonSplittingTags] = Utils.domQuery(Selectors.deepl.nonSplittingTags);\n            settingsUI[Selectors.deepl.outlineDetection] = Utils.domQuery(Selectors.deepl.outlineDetection);\n            settingsUI[Selectors.deepl.preserveFormatting] = Utils.domQuery(Selectors.deepl.preserveFormatting);\n            settingsUI[Selectors.deepl.splitSentences] = Utils.domQuery(Selectors.deepl.splitSentences);\n            settingsUI[Selectors.deepl.splittingTags] = Utils.domQuery(Selectors.deepl.splittingTags);\n            settingsUI[Selectors.deepl.tagHandling] = Utils.domQuery(Selectors.deepl.tagHandling);\n            if (!config.isfree) {\n                settingsUI[Selectors.deepl.toneorstyle] = Utils.domQuery(Selectors.deepl.toneorstyle);\n            }\n            settingsUI[Selectors.actions.escapeLatex] = Utils.domQuery(Selectors.actions.escapeLatex);\n            settingsUI[Selectors.actions.escapePre] = Utils.domQuery(Selectors.actions.escapePre);\n            fetchCookies();\n            resizeEditors();\n        } catch (e) {\n            if (config.debug) {\n                Log.error(e.message);\n            }\n        }\n    };\n\n    const handleFocusEvent = (e)=>{\n        if (e.target.closest(Selectors.editors.targetarea)) {\n            if (getIconStatus(e.target.id.replace('tiny_', '')) === Selectors.statuses.tosave) {\n                const options = {\n                    subdirs: false,\n                    maxbytes: 10240,\n                    maxfiles: 0,\n                    noclean: true,\n                    trusttext: true,\n                    // eslint-disable-next-line camelcase\n                    enable_filemanagement: false,\n                    autosave: false,\n                    removeorphaneddrafts: true,\n                    plugins: []\n                };\n                // eslint-disable-next-line promise/catch-or-return\n                TinyMCEinit.getTinyMCE().then(\n                    // eslint-disable-next-line promise/always-return\n                    ()=>{\n                        // eslint-disable-next-line promise/no-nesting\n                        TinyMCE.setupForTarget(e.target, options)\n                            // eslint-disable-next-line promise/always-return\n                            .then(()=>{\n                                Log.info('tiny loaded for ' + e.target.id);\n                            })\n                            .catch((r)=>{\n                                Log.error(r);\n                            });\n                    }\n                );\n            }\n\n        }\n    };\n    /**\n     * Event listener for click events.\n     *\n     * @param {event} e\n     */\n    const handleClickEvent = (e) => {\n        if (e.target.closest(Selectors.actions.toggleMultilang)) {\n            onToggleMultilang(e.target.closest(Selectors.actions.toggleMultilang));\n        }\n        if (e.target.closest(Selectors.actions.autoTranslateBtn)) {\n            if ((!config.canimprove && config.deeplsourcelang === config.targetlang) || config.targetlang === undefined) {\n                showModal('Cannot call deepl', `<p>${langstrings.uistrings.canttranslatesame} ${config.targetlang}</p>`);\n            } else {\n                callDeeplServices();\n            }\n        }\n        if (e.target.closest(Selectors.actions.selectAllBtn)) {\n            toggleAllCheckboxes(e);\n        }\n        if (e.target.closest(Selectors.actions.tothetop)) {\n            window.scrollTo({top: offsetTop - 5, behavior: 'smooth'});\n        }\n        if (e.target.closest(Selectors.actions.checkBoxes)) {\n            toggleAutotranslateButton();\n        }\n        if (e.target.closest(Selectors.actions.saveAll)) {\n            saveTranslations();\n        }\n        if (e.target.closest(Selectors.actions.validatorsBtns)) {\n            saveSingleTranslation(e);\n        }\n        if (e.target.closest(Selectors.glossary.entriesviewerPage)) {\n            Log.info('CLICK');\n            Log.info(settingsUI[Selectors.deepl.glossaryId].value);\n            Api.getGlossariesEntries(\n                settingsUI[Selectors.deepl.glossaryId].value,\n                config.deeplsourcelang,\n                config.targetlang\n            );\n        }\n    };\n    /**\n     * Event listener for change events.\n     * @param {event} e\n     */\n    const handleChangeEvent = (e) => {\n\n        if (e.target.closest(Selectors.actions.hideiframes)) {\n            doHideiframes(hideiframes.checked);\n        }\n        if (e.target.closest(Selectors.actions.targetSwitcher)) {\n            switchTarget(e);\n        }\n        if (e.target.closest(Selectors.actions.sectionSwitcher)) {\n            switchSection(e);\n        }\n        if (e.target.closest(Selectors.actions.moduleSwitcher)) {\n            switchModules(e);\n        }\n        if (e.target.closest(Selectors.actions.sourceSwitcher)) {\n            switchSource(e);\n        }\n        clearTimeout(filterTimeout);\n        filterTimeout = setTimeout(() => {\n            if (e.target.closest(Selectors.actions.showUpdated)) {\n                debouncedShowRows();\n            }\n            if (e.target.closest(Selectors.actions.showNeedUpdate)) {\n                debouncedShowRows();\n            }\n            if (e.target.closest(Selectors.actions.showHidden)) {\n                debouncedShowRows();\n            }\n        }, 30);\n        if (e.target.closest(Selectors.actions.checkBoxes)) {\n            onItemChecked(e);\n        }\n        if (e.target.closest(Selectors.actions.sourceselect)) {\n            onSourceChange(e);\n        }\n        if (e.target.closest(Selectors.deepl.glossaryId)) {\n            if (settingsUI[Selectors.deepl.glossaryId].value !== '') {\n                glossaryDetailViewr.style.display = 'block';\n            } else {\n                glossaryDetailViewr.style.display = 'none';\n            }\n        }\n    };\n    /**\n     * Event Listener when DeepL API call failed.\n     * @param {string} error\n     */\n    const onTranslationFailed = (error) => {\n        let s = langstrings.uistrings.deeplapiexception;\n        onTranslationDone();\n        showModal(s, error, 'Alert');\n    };\n    /**\n     * Event Listener when DeepL API call finished.\n     */\n    const onTranslationDone = () => {\n        if (saveAllModal !== null && saveAllModal.isVisible) {\n            saveAllModal.hide();\n        }\n    };\n    /**\n     * Event listener for the translations process to dispaly the status.\n     *\n     * @param {string} key\n     */\n    const onItemTranslated = (key) => {\n        // Add saved indicator.\n        setIconStatus(key, Selectors.statuses.tosave, true);\n    };\n    /**\n     * Displays error message and icon.\n     *\n     * @param {string} key\n     * @param {string} error\n     */\n    const onErrorMessageItem = (key, error) => {\n        Log.warn(`ui/errorMessageItem`);\n        Log.warn(key);\n        Log.warn(error);\n        const editor = Utils.domQuery(Selectors.editors.multiples.editorsWithKey, key);\n        editor.classList.add(\"local_deepler__error\");\n        setIconStatus(key, Selectors.statuses.failed);\n        // Display granular error messages.\n        const indexOfSET = error.indexOf(\"Data too long\");// Probably a text too long for the field if not -1.\n        if (indexOfSET === -1) {\n            showErrorMessageForEditor(key, error);\n        } else {\n            let s = langstrings.uistrings.errortoolong;\n            showErrorMessageForEditor(key, `${error.substring(0, error.indexOf('WHERE id=?'))} ${s}`);\n        }\n    };\n    /**\n     * Listener for individual source change.\n     * @todo MDL-000 implement in v1.4.0\n     *\n     * @param {event} e\n     */\n    const onSourceChange = (e) => {\n        // Do check source and target and propose rephrase if PRO.\n        Log.info('source changed');\n        Log.info(e.target.getAttribute('data-key'));\n    };\n    /**\n     * Event listener for selection checkboxes.\n     * @param {Event} e\n     */\n    const onItemChecked = (e) => {\n        // Check/uncheck checkboxes changes the charcount and icon status.\n        if (e.target.getAttribute('data-action') === \"local_deepler/checkbox\") {\n            toggleStatus(e.target.getAttribute('data-key'), e.target.checked);\n            countWordAndChar();\n        }\n    };\n    /**\n     * When a main error with the DB occurs.\n     *\n     * @param {string} error\n     * @param {int} status\n     */\n    const onDBFailed = (error, status) => {\n        if (saveAllModal !== null && saveAllModal.isVisible) {\n            saveAllModal.hide();\n        }\n        showModal(`${errordbtitle} ${status}`, `DB failed to save translations. ${error}`, 'Alert');\n    };\n    /**\n     *\n     * @param {array} errors\n     */\n    const onDbSavedSuccess = (errors) => {\n        if (saveAllModal !== null && saveAllModal.isVisible) {\n            saveAllModal.hide();\n        }\n        if (errors.length > 0) {\n            let s = langstrings.uistrings.errordbpartial;\n            s = s.replace('{$a}', errors.length);\n            showModal(errordbtitle, s, 'Alert');\n        }\n    };\n\n    /**\n     * Multilang button handler\n     *\n     * @param {Event} e Event\n     */\n    const onToggleMultilang = (e) => {\n        let keyid = e.getAttribute('aria-controls');\n        let key = Utils.keyidToKey(keyid);\n        if (key === null) {\n            Log.error(`KEY ${keyid} BAD FORMAT should be TABLE-ID-FIELD-CMID`);\n        } else {\n            let source = Utils.domQuery(Selectors.sourcetexts.keys, key);\n            let multilang = Utils.domQuery(Selectors.sourcetexts.multilangs, keyid);\n            source.classList.toggle(\"show\");\n            multilang.classList.toggle(\"show\");\n        }\n    };\n    const onGlossaryDbAllfailed = (obj)=> {\n        Log.info('onGlossaryDbAllfailed');\n        Log.error(obj);\n    };\n\n    const onGlossaryDbfailed = (obj)=> {\n        Log.info('onGlossaryDbfailed');\n        Log.error(obj);\n    };\n\n    const onGlossaryDbSuccess = (obj)=> {\n        Log.info('onGlossaryDbSuccess');\n        Log.info(obj);\n    };\n    /**\n     * Displays success message and icon.\n     *\n     * @param {String} key\n     * @param {string} savedText\n     */\n    const onSuccessMessageItem = (key, savedText) => {\n        Utils.domQuery(Selectors.editors.multiples.editorsWithKey, key)\n            .classList.add(\"local_deepler__success\");\n        // Add saved indicator.\n        setIconStatus(key, Selectors.statuses.success);\n        // Replace text in the multilang textarea.\n        const multilangTextarea = Utils.domQuery(Selectors.editors.multiples.textAreas, key);\n        multilangTextarea.innerHTML = savedText;\n        // Deselect the checkbox.\n        Utils.domQuery(Selectors.editors.multiples.checkBoxesWithKey, key).checked = false;\n        // Remove success message after a few seconds.\n        setTimeout(() => {\n            let multilangPill = Utils.domQuery(Selectors.statuses.multilang, key);\n            let prevTransStatus = Utils.domQuery(Selectors.statuses.prevTransStatus, key);\n            prevTransStatus.classList = \"badge badge-pill badge-success\";\n            if (multilangPill.classList.contains(\"disabled\")) {\n                multilangPill.classList.remove('disabled');\n            }\n            setIconStatus(key, Selectors.statuses.saved);\n        });\n    };\n    const resizeEditors = ()=>{\n\n        allDataFormatOne.forEach((editable)=>{\n            const key = editable.id.replace('tiny_', '');\n            const selector = `[data-sourcetext-key=\"${key}\"]`;\n            let parent = Utils.domQuery(selector);\n            const grandparent = parent.parentElement;\n\n            const updateEditableHeight = ()=> {\n                const totalHeight = grandparent.offsetHeight + 80; // Tiny header average height is 80.\n                editable.style.height = totalHeight + 'px';\n            };\n\n            // Observe size changes in parent and grandparent.\n            const resizeObserver = new ResizeObserver(() => {\n                updateEditableHeight();\n            });\n\n            resizeObserver.observe(parent);\n            resizeObserver.observe(grandparent);\n\n        });\n    };\n    /**\n     * Toggle iFrames in sourcetexts.\n     * @param {boolean} isChecked\n     */\n    function doHideiframes(isChecked) {\n        const allIframes = Utils.domQueryAll(Selectors.sourcetexts.iframes);\n        if (!isChecked && allIframes.length > 0) {\n            removedIframes = [];\n            allIframes.forEach(iframe => {\n                removedIframes.push({\n                    parent: iframe.parentNode,\n                    nextSibling: iframe.nextSibling,\n                    html: iframe.outerHTML\n                });\n                iframe.remove();\n            });\n        } else if (removedIframes.length > 0) {\n            // Restore all previously removed iframes.\n            removedIframes.forEach(info => {\n                // Create a new element from the stored HTML.\n                const tempDiv = document.createElement('div');\n                tempDiv.innerHTML = info.html;\n                const newIframe = tempDiv.firstChild;\n                // Insert it back into the DOM\n                if (info.nextSibling) {\n                    info.parent.insertBefore(newIframe, info.nextSibling);\n                } else {\n                    info.parent.appendChild(newIframe);\n                }\n            });\n            removedIframes = [];\n        }\n    }\n\n\n    /**\n     * @returns void\n     */\n    const saveTranslations = () => {\n        const selectedCheckboxes = Utils.domQueryAll(Selectors.statuses.checkedCheckBoxes);\n        if (selectedCheckboxes.length === 0) {\n            return;\n        }\n        // Prepare the UI for the save process.\n        saveAllBtn.disabled = true;\n        launchModal({\n            title: langstrings.uistrings.saveallmodaltitle,\n            body: langstrings.uistrings.saveallmodalbody,\n        }).then(r => Log.info('SaveAll Modal launched ' + r)).catch((reason)=>{\n            Log.error(reason);\n        });\n        // Prepare the data to be saved.\n        const data = [];\n        const keys = Array.from(selectedCheckboxes).map((e) => e.dataset.key);\n        keys.forEach((key) => {\n                // @todo MDL-0000: should not rely on UI (add a flag in temptranslations object) .\n                if (getIconStatus(key) === Selectors.statuses.tosave) {\n                    hideErrorMessage(key);\n                    data.push(prepareDBitem(key));\n                }\n            }\n        );\n        Translation.saveTranslations(data, config);\n    };\n    /**\n     * Saving a single translation to DB.\n     * @param {Event} e\n     */\n    const saveSingleTranslation = (e)=> {\n        const key = e.target.closest(Selectors.actions.validatorsBtns).dataset.keyValidator;\n        if (getIconStatus(key) === Selectors.statuses.tosave) {\n            hideErrorMessage(key);\n            Translation.saveTranslations([prepareDBitem(key)], config);\n        }\n    };\n    /**\n     *\n     * @param {string} key\n     * @returns {{key, courseid, id: number, tid: *, table: *, field: *}}\n     */\n    const prepareDBitem = (key) => {\n        const element = Utils.domQuery(Selectors.editors.multiples.editorsWithKey, key);\n        return {\n            key: key,\n            courseid: config.courseid,\n            id: parseInt(element.getAttribute(\"data-id\")),\n            tid: element.getAttribute(\"data-tid\"),\n            table: element.getAttribute(\"data-table\"),\n            field: element.getAttribute(\"data-field\"),\n            cmid: element.getAttribute(\"data-cmid\"),\n        };\n    };\n\n    /**\n     * Toggle checkboxes\n     * @param {Event} e Event\n     */\n    const toggleAllCheckboxes = (e) => {\n        const checked = e.target.checked;\n        const updates = [];\n\n        // Prepare all updates without applying immediately.\n        checkboxes.forEach(checkbox => {\n            // Parent row.\n            const node = checkbox.closest(Utils.replaceKey(Selectors.sourcetexts.parentrow, node.getAttribute('data-key')));\n            // If the row is checked, verifiy that the parent is not hidden else do not select.\n            const shouldCheck = checked ? !node.classList.contains('d-none') : false;\n\n            if (checkbox.checked !== shouldCheck) {\n                updates.push({checkbox, shouldCheck});\n            }\n        });\n\n        // Apply updates in the next animation frame, batching DOM writes.\n        requestAnimationFrame(() => {\n            updates.forEach(({checkbox, shouldCheck}) => {\n                checkbox.checked = shouldCheck;\n                toggleStatus(checkbox.getAttribute('data-key'), shouldCheck);\n            });\n\n            toggleAutotranslateButton();\n            countWordAndChar();\n        });\n    };\n    /**\n     * Toggle Autotranslate Button\n     */\n    const toggleAutotranslateButton = () => {\n        // Use Array.some() for early exit when a checked checkbox is found\n        autotranslateButton.disabled = !Array.from(checkboxes).some(e => e.checked);\n    };\n    /**\n     * Get the translation row status icon.\n     *\n     * @param {string} key\n     * @returns {*}\n     */\n    const getIconStatus = (key)=> {\n        return Utils.domQuery(Selectors.actions.validatorBtn, key).getAttribute('data-status');\n    };\n    /**\n     * Change translation process status icon.\n     *\n     * @param {string} key\n     * @param {string} status\n     * @param {boolean} isBtn\n     */\n    const setIconStatus = (key, status = Selectors.statuses.wait, isBtn = false) => {\n        let icon = Utils.domQuery(Selectors.actions.validatorBtn, key);\n        if (!isBtn) {\n            if (!icon.classList.contains('disable')) {\n                icon.classList.add('disable');\n            }\n            if (icon.classList.contains('btn')) {\n                icon.classList.remove('btn');\n                icon.classList.remove('btn-outline-secondary');\n            }\n        } else {\n            if (!icon.classList.contains('btn')) {\n                icon.classList.add('btn');\n                icon.classList.add('btn-outline-secondary');\n            }\n            if (icon.classList.contains('disable')) {\n                icon.classList.remove('disable');\n            }\n        }\n        icon.setAttribute('role', isBtn ? 'button' : 'status');\n        icon.setAttribute('data-status', status);\n        icon.setAttribute('title', langstrings.statusstrings[status.replace('local_deepler/', '')]);\n    };\n\n\n    /**\n     * Wrap debounce for displaying rows.\n     * @type {(function(...[*]): void)|*}\n     */\n    const debouncedShowRows = Utils.debounce(() => {\n        showRows();\n    }, 100);\n    /**/\n    /**\n     * Display an error message attached to the item's editor.\n     * @param {String} key\n     * @param {String} message\n     */\n    const showErrorMessageForEditor = (key, message) => {\n        let parent = Utils.domQuery(Selectors.editors.multiples.editorsWithKey, key);\n        const errorMsg = document.createElement('div');\n        errorMsg.id = 'local_deepler__errormsg';\n        errorMsg.classList = ['alert alert-danger'];\n        errorMsg.innerHTML = message;\n        parent.appendChild(errorMsg);\n    };\n    /**\n     * Opens a modal infobox to warn user trunks of fields are saving.\n     * @param {object} messageObject\n     * @returns {Promise<void>}\n     */\n    const launchModal = async(messageObject) => {\n        saveAllModal = await Modal.create(messageObject);\n        await saveAllModal.show();\n    };\n    const showModal = (title, body, type = 'default') => {\n        Modal.create({\n            title: title,\n            body: body,\n            type: type,\n            show: true,\n            removeOnClose: true,\n        });\n    };\n\n    const showEntriesModal = (ajaxResponse)=>{\n        const glossaryid = ajaxResponse.glossaryid;\n        const entries = JSON.parse(ajaxResponse.entries);\n        const status = ajaxResponse.status;\n        const message = ajaxResponse.message;\n        if (status === 'success') {\n            const table = document.createElement('table');\n            table.className = 'generaltable';\n            // Create the header.\n            const thead = document.createElement('thead');\n            thead.innerHTML = `<tr><th>${ajaxResponse.source.toUpperCase()}</th>\n                <th>${ajaxResponse.target.toUpperCase()}</th></tr>`;\n            table.appendChild(thead);\n\n            const tbody = document.createElement('tbody');\n\n            Object.entries(entries).forEach(([key, value]) => {\n                const row = document.createElement('tr');\n                row.innerHTML = `<td>${key}</td><td>${value}</td>`;\n                tbody.appendChild(row);\n            });\n\n            table.appendChild(tbody);\n\n            Modal.create({\n                title: 'Entries',\n                body: table,\n                type: 'default',\n                show: true,\n                removeOnClose: true,\n            });\n        } else {\n            Modal.create({\n                title: `Error fetching entries for<br/><em>${glossaryid}</em>`,\n                body: message,\n                type: 'default',\n                show: true,\n                removeOnClose: true,\n            });\n        }\n    };\n    /**\n     * Launch deepl services.\n     */\n    const callDeeplServices = () => {\n        saveAllModal = launchModal(\n            {\n                title: langstrings.uistrings.translatemodaltitle,\n                body: langstrings.uistrings.translatemodalbody,\n            }\n        );\n        const keys = [];\n        const [cookie, settings] = prepareSettingsAndCookieValues();\n        saveAllBtn.disabled = false;\n        Utils.domQueryAll(Selectors.statuses.checkedCheckBoxes)\n            .forEach((ckBox) => {\n                const key = ckBox.getAttribute(\"data-key\");\n                const sourceText = Utils.domQuery(Selectors.sourcetexts.keys, key);\n                const editor = findEditor(key);\n                Translation.initTempForKey(\n                    key, editor,\n                    sourceText.getAttribute(\"data-sourcetext-raw\"),\n                    sourceText.getAttribute(\"data-filedtext-raw\"),\n                    Utils.domQuery(Selectors.sourcetexts.sourcelangdd, key).value\n                );\n                keys.push(key);\n            });\n        const newCookiename = Utils.COOKIE_PREFIX_NEW + config.currentlang + config.targetlang + config.courseid;\n        Utils.setEncodedCookie(newCookiename, JSON.stringify(cookie), config.cookieduration);\n        Translation.callTranslations(keys, config, settings);\n    };\n    /**\n     * Get the stored settings for this course and lang pair.\n     */\n    const fetchCookies = () => {\n        if (!config.targetlang) {\n            return;\n        }\n        const glossaryCookie = Utils.getCookie(config);\n        const newCookie = Utils.getEncodedCookie(config);\n        if (newCookie !== null) {\n            const settingsCookie = JSON.parse(newCookie);\n            for (const selector in settingsUI) {\n                if (settingsCookie[selector] !== undefined) {\n                    switch (settingsUI[selector].type) {\n                        case 'select-one' :\n                            setOptionFromCookie(settingsCookie[selector]);\n                            break;\n                        case 'checkbox' :\n                            settingsUI[selector].checked = settingsCookie[selector];\n                            break;\n                        case 'radio' :\n                            Utils.domQuery(selector + `[value=\"${settingsCookie[selector]}\"]`).checked = true;\n                            break;\n                        default:\n                            settingsUI[selector].value = settingsCookie[selector];\n                            break;\n                    }\n\n                }\n            }\n        }\n        if (glossaryCookie !== null) {\n            // Legacy cookie.\n            settingsUI[Selectors.deepl.glossaryId].value = glossaryCookie;\n        }\n    };\n    /**\n     * Selects a dd based on its value.\n     * @param {string} value\n     */\n    const setOptionFromCookie = (value)=>{\n        let optionToSelect = Utils.domQuery(`option[value=\"${value}\"]`);\n        if (optionToSelect) {\n            optionToSelect.selected = true;\n        }\n    };\n    /**\n     * Parse the advanced settings UI and map the values for cookies and Deepl.\n     *\n     * @returns {[{},{}]}\n     */\n    const prepareSettingsAndCookieValues = () => {\n        let settings = {};\n        let cookie = {};\n        for (const selector in settingsUI) {\n            if (settingsUI[selector] === null) {\n                Log.warn(`prepareSettingsAndCookieValues. Could not find selector ${selector}`);\n                Log.warn(settingsUI);\n            } else {\n                switch (settingsUI[selector].type) {\n                    case 'select-one':\n                        cookie[selector] = settingsUI[selector].value;\n                        settings[selector] = settingsUI[selector].value;\n                        break;\n                    case 'textarea':\n                        cookie[selector] = settingsUI[selector].value;\n                        // Deepl needs an array.\n                        settings[selector] = Utils.toJsonArray(cookie[selector]);\n                        break;\n                    case 'checkbox':\n                        if (selector === Selectors.deepl.tagHandling) {\n                            cookie[selector] = settingsUI[selector].checked;\n                            // Exception for tag_handling that checkbox but not boolean value for Deepl.\n                            settings[selector] = settingsUI[selector].checked ? 'html' : 'xml';\n                        } else {\n                            settings[selector] = cookie[selector] = settingsUI[selector].checked;\n                        }\n                        break;\n                    case 'radio':\n                        cookie[selector] = Utils.domQuery(Selectors.actions.radioValues.replace(\"<RADIO>\", selector)).value;\n                        settings[selector] = cookie[selector];\n                        break;\n                    default: // Text.\n                        settings[selector] = cookie[selector] = settingsUI[selector].value;\n                        break;\n                }\n            }\n        }\n        return [cookie, settings];\n    };\n    /**\n     * Factory to display process' statuses for each item.\n     *\n     * @param {String} key\n     * @param {Boolean} checked\n     */\n    const toggleStatus = (key, checked) => {\n        const status = Utils.domQuery(Selectors.actions.validatorBtn, key).dataset.status;\n        switch (status) {\n            case Selectors.statuses.wait :\n                Translation.initTemp(key); // Reset the translation.\n                if (checked) {\n                    setIconStatus(key, Selectors.statuses.totranslate);\n                }\n                break;\n            case Selectors.statuses.totranslate :\n                if (checked && Translation.translated[key]) {\n                    setIconStatus(key, Selectors.statuses.tosave, true);\n                } else {\n                    setIconStatus(key, Selectors.statuses.wait);\n                }\n                break;\n            case Selectors.statuses.tosave :\n                if (!checked) {\n                    setIconStatus(key, Selectors.statuses.totranslate);\n                }\n                break;\n            case Selectors.statuses.failed :\n                if (checked) {\n                    setIconStatus(key, Selectors.statuses.totranslate);\n                }\n                break;\n            case Selectors.statuses.success :\n                break;\n            case Selectors.statuses.saved :\n                if (checked) {\n                    setIconStatus(key, Selectors.statuses.totranslate);\n                }\n                Translation.initTemp(key);\n                break;\n        }\n    };\n    /**\n     * Shows/hides rows.\n     */\n    const showRows = () => {\n        // Map each selector to its corresponding checkbox checked state\n        const selectorMap = {\n            [Selectors.statuses.updated]: Utils.domQuery(Selectors.actions.showUpdated).checked,\n            [Selectors.statuses.needsupdate]: Utils.domQuery(Selectors.actions.showNeedUpdate).checked,\n            [Selectors.statuses.hidden]: Utils.domQuery(Selectors.actions.showHidden).checked\n        };\n\n        // Combine all selectors into one comma-separated string for batch querying.\n        const mergedSelector = Object.keys(selectorMap).join(\",\");\n\n        // Query all items matching any of the selectors once.\n        const allItems = Utils.domQueryAll(mergedSelector);\n\n        // Cache the global \"select all\" button checked state once.\n        const allSelected = Utils.domQuery(Selectors.actions.selectAllBtn).checked;\n\n        allItems.forEach(item => {\n            // Determine which selector this item matches so we can apply the right checkbox state.\n            let shouldShow = false;\n            let shouldCheck = false;\n            for (const [selector, checked] of Object.entries(selectorMap)) {\n                if (item.matches(selector)) {\n                    shouldShow = checked;\n                    shouldCheck = allSelected && checked;\n                    break;\n                }\n            }\n\n            // Show or hide item based on checkbox state.\n            item.classList.toggle(\"d-none\", !shouldShow);\n\n            // Handle checkbox selection for this item or its children.\n            let rowId = item.getAttribute('data-row-id');\n            if (rowId === null) {\n                // For items without row-id, toggle checkboxes of their child rows.\n                const childs = Utils.domQueryAll(Selectors.statuses.hiddenForStudentRows, '', item);\n                childs.forEach(child => {\n                    const childId = child.getAttribute('data-row-id');\n                    toggleChildCheckBoxSelection(childId, shouldCheck);\n                });\n            } else {\n                toggleChildCheckBoxSelection(rowId, shouldCheck);\n            }\n        });\n\n        // Call global UI update functions once\n        toggleAutotranslateButton();\n        countWordAndChar();\n    };\n    /**\n     * Manages selection and icon status of fields.\n     *\n     * @param {string} key\n     * @param {bool} shouldBeChecked\n     */\n    const toggleChildCheckBoxSelection = (key, shouldBeChecked)=>{\n        const single = Utils.domQuery(Selectors.editors.multiples.checkBoxesWithKey, key);\n        single.checked = shouldBeChecked;\n        toggleStatus(key, false);\n    };\n\n    /**\n     * Hides an item's error message.\n     *\n     * @param {String} key\n     */\n    const hideErrorMessage = (key) => {\n        let parent = Utils.domQuery(Selectors.editors.multiples.editorsWithKey, key);\n        let alertChild = Utils.domQuery('.alert-danger', '', parent);\n        if (alertChild) {\n            parent.removeChild(alertChild);\n        }\n    };\n\n\n    /**\n     * Event listener to switch target lang.\n     * @param {Event} e\n     */\n    const switchTarget = (e) => {\n        let url = new URL(window.location.href);\n        let searchParams = url.searchParams;\n        // Pass the target lang in the url and refresh, not forgetting to remove the rephrase prefix indicator.\n        searchParams.set(\"target_lang\", e.target.value.replace(config.rephrasesymbol, '').trim());\n        window.location = url.toString();\n    };\n    /**\n     * Event listener to filter sections.\n     * @param {Event} e\n     */\n    const switchSection = (e) => {\n        let url = new URL(window.location.href);\n        let searchParams = url.searchParams;\n        // Pass the target lang in the url and refresh, not forgetting to remove the rephrase prefix indicator.\n        searchParams.set(\"section_id\", e.target.value.trim());\n        if (searchParams.has(\"activity_id\")) {\n            searchParams.delete(\"activity_id\");\n        }\n        window.location = url.toString();\n    };\n    /**\n     * Event listener to filter modules.\n     * @param {Event} e\n     */\n    const switchModules = (e) => {\n        let url = new URL(window.location.href);\n        let searchParams = url.searchParams;\n        // Pass the target lang in the url and refresh, not forgetting to remove the rephrase prefix indicator.\n        searchParams.set(\"activity_id\", e.target.value.trim());\n        window.location = url.toString();\n    };\n    /**\n     * Event listener to switch source lang,\n     * Hence reload the page and change the site main lang.\n     * @param {Event} e\n     */\n    const switchSource = (e) => {\n        let url = new URL(window.location.href);\n        let searchParams = url.searchParams;\n        searchParams.set(\"lang\", e.target.value);\n        window.location = url.toString();\n    };\n    /**\n     * Launch, display count of Words And Chars.\n     */\n    const countWordAndChar = () => {\n        let wrdsc = 0,\n        cws = 0,\n        cwos = 0;\n\n        // Cache checkboxes matching selector once, convert to array if needed.\n        const checkedBoxes = Array.from(Utils.domQueryAll(Selectors.statuses.checkedCheckBoxes));\n\n        // Aggregate counts in one loop.\n        checkedBoxes.forEach(ckBox => {\n            const key = ckBox.getAttribute(\"data-key\");\n            const results = getCount(key);\n            wrdsc += results.wordCount;\n            cws += results.charNumWithSpace;\n            cwos += results.charNumWithOutSpace;\n        });\n\n        // Cache DOM elements once for output instead of querying repeatedly.\n        const wordCount = cachedSelectors.wordCount;\n        const charWithSpace = cachedSelectors.charWithSpace;\n        const charWOSpace = cachedSelectors.charWOSpace;\n        const deeplUseSpan = cachedSelectors.deeplUseSpan;\n        const deeplMaxSpan = cachedSelectors.deeplMaxSpan;\n        const parent = cachedSelectors.deeplStatusContainer;\n\n        // Calculate current usage once.\n        const current = cws + config.usage.character.count;\n\n        // Update UI in one batch (minimizes layout thrashing).\n        wordCount.innerText = wrdsc;\n        charWithSpace.innerText = cws;\n        charWOSpace.innerText = cwos;\n        deeplUseSpan.innerText = format.format(current);\n        deeplMaxSpan.innerText = config.usage.character.limit === null ? 'âˆž' : format.format(config.usage.character.limit);\n\n        // Toggle classes efficiently.\n        parent.classList.toggle('alert-success', current < config.usage.character.limit || config.usage.character.limit === null);\n        parent.classList.toggle('alert-danger', current >= config.usage.character.limit && config.usage.character.limit !== null);\n    };\n    /**\n     * Compile the needed counts for info.\n     *\n     * @param {string} key\n     * @returns {{wordCount: *, charNumWithSpace: *, charNumWithOutSpace: *}}\n     */\n    const getCount = (key) => {\n        const item = Utils.domQuery(Selectors.sourcetexts.keys, key);\n        const raw = item.getAttribute(\"data-sourcetext-raw\");\n        // Cleaned sourceText.\n        const trimmedVal = Utils.stripHTMLTags(Utils.fromBase64(raw)).trim();\n        return {\n            \"wordCount\": (trimmedVal.match(/\\S+/g) || []).length,\n            \"charNumWithSpace\": trimmedVal.length,\n            \"charNumWithOutSpace\": trimmedVal.replace(/\\s+/g, '').length\n        };\n    };\n    /**\n     * Get the editor container based on recieved current user's editor preference.\n     *\n     * @param {string} key Translation Key\n     */\n    const findEditor = (key) => {\n        let e = Utils.domQuery(Selectors.editors.types.basic, key);\n        let et = 'basic';\n        if (e === null) {\n            let r = null;\n            let editorTab = [\"atto\", \"tiny\", \"marklar\", \"textarea\"];\n            if (editorTab.indexOf(config.userPrefs) === -1) {\n                Log.warn('Unsupported editor ' + config.userPrefs);\n            } else {\n                // First let's try the current editor.\n                try {\n                    r = findEditorByType(key, config.userPrefs);\n                } catch (error) {\n                    // Content was edited by another editor.\n                    Log.trace(`Editor not found: ${config.userPrefs} for key ${key}`);\n                }\n            }\n            return r;\n        } else {\n            return {editor: e, editorType: et};\n        }\n    };\n    /**\n     * @param {string} key\n     * @param {object} editorType\n     * @returns {{editor: object, editorType: string}}\n     */\n    const findEditorByType = (key, editorType) => {\n        let et = 'basic';\n        let ed = null;\n        switch (editorType) {\n            case \"atto\" :\n                et = 'iframe';\n                ed = Utils.domQuery(Selectors.editors.types.atto, key);\n                break;\n            case \"tiny\":\n                et = 'iframe';\n                ed = findTinyInstanceByKey(key);\n                break;\n            case 'marklar':\n            case \"textarea\" :\n                ed = Utils.domQuery(Selectors.editors.types.other, key);\n                break;\n        }\n        return {editor: ed, editorType: et};\n    };\n    /**\n     * Finds TinyMCE instance.\n     * @param {string} key\n     * @returns {Node}\n     */\n    const findTinyInstanceByKey = (key)=> {\n        let editor = null;\n        TinyMCE.getAllInstances().every((k, v)=>{\n            if (v.attributes.name.value.indexOf(key) == 0) {\n                editor = k.getBody();\n                return false;\n            }\n            return true;\n        });\n        return editor;\n    };\n\n\n    /**\n     * Event listener to switch source lang.\n     * @param {*} cfg\n     */\n    const init = (cfg) => {\n        offsetTop = Utils.domQuery(Selectors.config.langstrings).offsetTop;\n        ScrollSpy.init('.local_deepler__form', '#local_deepler-scrollspy',\n            {highestLevel: 3, fadingDistance: 60, offsetEndOfScope: 1, offsetTop: 100, crumbsmaxlen: cfg.crumbsmaxlen});\n        Translation.init(cfg);\n        config = cfg;\n        Log.info(cfg);\n        registerUI();\n        registerEventListeners();\n        toggleAutotranslateButton();\n        doHideiframes(hideiframes.checked);\n        saveAllBtn.disabled = true;\n        selectAllBtn.disabled = !Translation.isTranslatable();\n        checkboxes.forEach((node) => {\n            node.disabled = selectAllBtn.disabled;\n        });\n        debouncedShowRows();\n    };\n    /**\n     * Api to be used by the other modules.\n     */\n    return {\n        init: init\n    };\n});\n"],"names":["define","Log","TinyMCEinit","TinyMCE","Modal","Selectors","Translation","Utils","Events","ScrollSpy","Api","cachedSelectors","wordCount","document","querySelector","statuses","wordcount","charWithSpace","charNumWithSpace","charWOSpace","charNumWithOutSpace","deeplUseSpan","deeplUsage","deeplMaxSpan","deeplMax","deeplStatusContainer","offsetTop","glossaryDetailViewr","filterTimeout","hideiframes","removedIframes","config","langstrings","autotranslateButton","saveAllBtn","selectAllBtn","checkboxes","format","Intl","NumberFormat","saveAllModal","errordbtitle","settingsUI","allDataFormatOne","handleFocusEvent","e","target","closest","editors","targetarea","getIconStatus","id","replace","tosave","options","subdirs","maxbytes","maxfiles","noclean","trusttext","enable_filemanagement","autosave","removeorphaneddrafts","plugins","getTinyMCE","then","setupForTarget","info","catch","r","error","handleClickEvent","actions","toggleMultilang","onToggleMultilang","autoTranslateBtn","canimprove","deeplsourcelang","targetlang","undefined","showModal","uistrings","canttranslatesame","callDeeplServices","toggleAllCheckboxes","tothetop","window","scrollTo","top","behavior","checkBoxes","toggleAutotranslateButton","saveAll","saveTranslations","validatorsBtns","saveSingleTranslation","glossary","entriesviewerPage","deepl","glossaryId","value","getGlossariesEntries","handleChangeEvent","doHideiframes","checked","targetSwitcher","switchTarget","sectionSwitcher","switchSection","moduleSwitcher","switchModules","sourceSwitcher","switchSource","clearTimeout","setTimeout","showUpdated","debouncedShowRows","showNeedUpdate","showHidden","onItemChecked","sourceselect","onSourceChange","style","display","onTranslationFailed","s","deeplapiexception","onTranslationDone","isVisible","hide","onItemTranslated","key","setIconStatus","onErrorMessageItem","warn","domQuery","multiples","editorsWithKey","classList","add","failed","indexOf","showErrorMessageForEditor","errortoolong","substring","getAttribute","toggleStatus","countWordAndChar","onDBFailed","status","onDbSavedSuccess","errors","length","errordbpartial","keyid","keyidToKey","source","sourcetexts","keys","multilang","multilangs","toggle","onGlossaryDbAllfailed","obj","onGlossaryDbfailed","onGlossaryDbSuccess","onSuccessMessageItem","savedText","success","textAreas","innerHTML","checkBoxesWithKey","multilangPill","prevTransStatus","contains","remove","saved","resizeEditors","forEach","editable","selector","parent","grandparent","parentElement","resizeObserver","ResizeObserver","totalHeight","offsetHeight","height","updateEditableHeight","observe","isChecked","allIframes","domQueryAll","iframes","iframe","push","parentNode","nextSibling","html","outerHTML","tempDiv","createElement","newIframe","firstChild","insertBefore","appendChild","selectedCheckboxes","checkedCheckBoxes","disabled","launchModal","title","saveallmodaltitle","body","saveallmodalbody","reason","data","Array","from","map","dataset","hideErrorMessage","prepareDBitem","keyValidator","element","courseid","parseInt","tid","table","field","cmid","updates","checkbox","node","replaceKey","parentrow","shouldCheck","requestAnimationFrame","_ref","some","validatorBtn","wait","isBtn","icon","setAttribute","statusstrings","debounce","showRows","message","errorMsg","async","create","messageObject","show","type","removeOnClose","showEntriesModal","ajaxResponse","glossaryid","entries","JSON","parse","className","thead","toUpperCase","tbody","Object","_ref2","row","translatemodaltitle","translatemodalbody","cookie","settings","prepareSettingsAndCookieValues","ckBox","sourceText","editor","findEditor","initTempForKey","sourcelangdd","newCookiename","COOKIE_PREFIX_NEW","currentlang","setEncodedCookie","stringify","cookieduration","callTranslations","fetchCookies","glossaryCookie","getCookie","newCookie","getEncodedCookie","settingsCookie","setOptionFromCookie","optionToSelect","selected","toJsonArray","tagHandling","radioValues","initTemp","totranslate","translated","selectorMap","updated","needsupdate","hidden","mergedSelector","join","allItems","allSelected","item","shouldShow","matches","rowId","hiddenForStudentRows","child","childId","toggleChildCheckBoxSelection","shouldBeChecked","alertChild","removeChild","url","URL","location","href","searchParams","set","rephrasesymbol","trim","toString","has","delete","wrdsc","cws","cwos","results","getCount","current","usage","character","count","innerText","limit","raw","trimmedVal","stripHTMLTags","fromBase64","match","types","basic","userPrefs","findEditorByType","trace","editorType","et","ed","atto","findTinyInstanceByKey","other","getAllInstances","every","k","v","attributes","name","getBody","init","cfg","highestLevel","fadingDistance","offsetEndOfScope","crumbsmaxlen","context","formality","modelType","ignoreTags","nonSplittingTags","outlineDetection","preserveFormatting","splitSentences","splittingTags","isfree","toneorstyle","escapeLatex","escapePre","debug","registerUI","addEventListener","on","ON_ITEM_TRANSLATED","ON_TRANSLATION_FAILED","ON_TRANSLATION_DONE","ON_REPHRASE_FAILED","ON_DB_SAVE_SUCCESS","ON_DB_FAILED","ON_ITEM_SAVED","ON_ITEM_NOT_SAVED","GLOSSARY_DB_ALL_FAILED","GLOSSARY_DB_FAILED","GLOSSARY_DB_SUCCESS","GLOSSARY_ENTRIES_SUCCESS","GLOSSARY_ENTRIES_FAILED","isTranslatable"],"mappings":"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"}