{"version":3,"file":"ui_deepler.min.js","sources":["../../src/local/ui_deepler.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module     local_deepler/deepler\n * @file       amd/src/local/ui_deepler.js\n * @copyright  2025 Bruno Baudry <bruno.baudry@bfh.ch>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n\ndefine(['core/log',\n    'editor_tiny/loader',\n    'editor_tiny/editor',\n    'core/modal',\n    './selectors',\n    './translation',\n    './utils',\n    './customevents',\n    './scrollspy',\n    './api'\n], (Log, TinyMCEinit, TinyMCE,\n    Modal,\n    Selectors,\n    Translation,\n    Utils,\n    Events,\n    ScrollSpy,\n    Api) => {\n\n    /**\n     * Debounce for performance\n     *\n     * @param {function} fn\n     * @param {int} delay\n     * @returns {(function(...[*]): void)|*}\n     */\n    const debounce = (fn, delay) => {\n        let timer;\n        return (...args) => {\n            clearTimeout(timer);\n            timer = setTimeout(() => fn(...args), delay);\n            };\n    };\n\n    /**\n     *\n     * @type {(function(...[*]): void)|*}\n     */\n    const debouncedShowRows = debounce(() => {\n showRows();\n}, 100);\n\n\n// Cached DOM elements\nconst cachedSelectors = {\n    wordCount: document.querySelector(Selectors.statuses.wordcount),\n    charWithSpace: document.querySelector(Selectors.statuses.charNumWithSpace),\n    charWOSpace: document.querySelector(Selectors.statuses.charNumWithOutSpace),\n    deeplUseSpan: document.querySelector(Selectors.statuses.deeplUsage),\n    deeplMaxSpan: document.querySelector(Selectors.statuses.deeplMax),\n    deeplStatusContainer: document.querySelector(Selectors.statuses.deeplStatusContainer)\n};\n\n    let offsetTop; // Highest point of the usable plugin UI.\n    let hideiframes = {};\n    // Store removed iframes and their parent/next sibling for restoration.\n    let removedIframes = [];\n\n    let config = {};\n    let langstrings = {};\n    let autotranslateButton = {};\n    let saveAllBtn = {};\n    let selectAllBtn = {};\n    let checkboxes = [];\n    let format = new Intl.NumberFormat();\n    let saveAllModal = {};\n    let errordbtitle = '';\n    let settingsUI = {};\n    let allDataFormatOne = [];\n    let glossaryDetailViewr;\n    let filterTimeout;\n    /**\n     * When a main error with the DB occurs.\n     *\n     * @param {string} error\n     * @param {int} status\n     */\n    const onDBFailed = (error, status) => {\n        if (saveAllModal !== null && saveAllModal.isVisible) {\n            saveAllModal.hide();\n        }\n        showModal(`${errordbtitle} ${status}`, `DB failed to save translations. ${error}`, 'Alert');\n    };\n    /**\n     *\n     * @param {array} errors\n     */\n    const onDbSavedSuccess = (errors) => {\n        if (saveAllModal !== null && saveAllModal.isVisible) {\n            saveAllModal.hide();\n        }\n        if (errors.length > 0) {\n            let s = langstrings.uistrings.errordbpartial;\n            s = s.replace('{$a}', errors.length);\n            showModal(errordbtitle, s, 'Alert');\n        }\n    };\n\n\n    // Const ON_TARGET_LANG_CHANGE = 'onTargetLangChange';\n    /**\n     * Event factories.\n     */\n    const registerEventListeners = () => {\n        document.addEventListener('change', handleChangeEvent);\n        document.addEventListener('click', handleClickEvent);\n        document.addEventListener('focusin', handleFocusEvent);\n\n        // Translation events.\n        Events.on(Translation.ON_ITEM_TRANSLATED, onItemTranslated);\n        Events.on(Translation.ON_TRANSLATION_FAILED, onTranslationFailed);\n        Events.on(Translation.ON_TRANSLATION_DONE, onTranslationDone);\n        Events.on(Translation.ON_REPHRASE_FAILED, onTranslationFailed);\n        Events.on(Translation.ON_DB_SAVE_SUCCESS, onDbSavedSuccess);\n        Events.on(Translation.ON_DB_FAILED, onDBFailed);\n        Events.on(Translation.ON_ITEM_SAVED, onSuccessMessageItem);\n        Events.on(Translation.ON_ITEM_NOT_SAVED, onErrorMessageItem);\n        Events.on(Api.GLOSSARY_DB_ALL_FAILED, onGlossaryDbAllfailed);\n        Events.on(Api.GLOSSARY_DB_FAILED, onGlossaryDbfailed);\n        Events.on(Api.GLOSSARY_DB_SUCCESS, onGlossaryDbSuccess);\n        Events.on(Api.GLOSSARY_ENTRIES_SUCCESS, showEntriesModal);\n        Events.on(Api.GLOSSARY_ENTRIES_FAILED, (e)=>Log.error(e));\n    };\n    const showEntriesModal = (ajaxResponse)=>{\n        const glossaryid = ajaxResponse.glossaryid;\n        const entries = JSON.parse(ajaxResponse.entries);\n        const status = ajaxResponse.status;\n        const message = ajaxResponse.message;\n        if (status === 'success') {\n            const table = document.createElement('table');\n            table.className = 'generaltable';\n            // Create the header.\n            const thead = document.createElement('thead');\n            thead.innerHTML = `<tr><th>${ajaxResponse.source.toUpperCase()}</th>\n                <th>${ajaxResponse.target.toUpperCase()}</th></tr>`;\n            table.appendChild(thead);\n\n            const tbody = document.createElement('tbody');\n\n            Object.entries(entries).forEach(([key, value]) => {\n                const row = document.createElement('tr');\n                row.innerHTML = `<td>${key}</td><td>${value}</td>`;\n                tbody.appendChild(row);\n            });\n\n            table.appendChild(tbody);\n\n            Modal.create({\n                title: 'Entries',\n                body: table,\n                type: 'default',\n                show: true,\n                removeOnClose: true,\n            });\n        } else {\n            Modal.create({\n                title: `Error fetching entries for<br/><em>${glossaryid}</em>`,\n                body: message,\n                type: 'default',\n                show: true,\n                removeOnClose: true,\n            });\n        }\n    };\n    const onGlossaryDbAllfailed = (obj)=> {\n        Log.info('onGlossaryDbAllfailed');\n        Log.error(obj);\n    };\n\n    const onGlossaryDbfailed = (obj)=> {\n        Log.info('onGlossaryDbfailed');\n        Log.error(obj);\n    };\n\n    const onGlossaryDbSuccess = (obj)=> {\n        Log.info('onGlossaryDbSuccess');\n        Log.info(obj);\n    };\n    const resizeEditors = ()=>{\n\n        allDataFormatOne.forEach((editable)=>{\n            const key = editable.id.replace('tiny_', '');\n            const selector = `[data-sourcetext-key=\"${key}\"]`;\n            let parent = domQuery(selector);\n            const grandparent = parent.parentElement;\n\n            const updateEditableHeight = ()=> {\n                const totalHeight = grandparent.offsetHeight + 80; // Tiny header average height is 80.\n                editable.style.height = totalHeight + 'px';\n            };\n\n            // Observe size changes in parent and grandparent.\n            const resizeObserver = new ResizeObserver(() => {\n                updateEditableHeight();\n            });\n\n            resizeObserver.observe(parent);\n            resizeObserver.observe(grandparent);\n\n        });\n    };\n    /**\n     * Register UI elements.\n     */\n    const registerUI = () => {\n\n        try {\n            allDataFormatOne = domQueryAll(Selectors.editors.targetarea);\n            hideiframes = domQuery(Selectors.actions.hideiframes);\n            langstrings = JSON.parse(domQuery(Selectors.config.langstrings).getAttribute('data-langstrings'));\n            errordbtitle = langstrings.uistrings.errordbtitle;\n            saveAllBtn = domQuery(Selectors.actions.saveAll);\n            selectAllBtn = domQuery(Selectors.actions.selectAllBtn);\n            autotranslateButton = domQuery(Selectors.actions.autoTranslateBtn);\n            checkboxes = domQueryAll(Selectors.actions.checkBoxes);\n\nif (!glossaryDetailViewr && document.querySelector(Selectors.glossary.entriesviewerPage)) {\n    glossaryDetailViewr = document.querySelector(Selectors.glossary.entriesviewerPage);\n}\n\n            settingsUI[Selectors.deepl.glossaryId] = domQuery(Selectors.deepl.glossaryId);\n            settingsUI[Selectors.deepl.context] = domQuery(Selectors.deepl.context);\n            settingsUI[Selectors.deepl.formality] = domQuery(Selectors.deepl.formality);\n            settingsUI[Selectors.deepl.modelType] = domQuery(Selectors.deepl.modelType);\n            settingsUI[Selectors.deepl.ignoreTags] = domQuery(Selectors.deepl.ignoreTags);\n            settingsUI[Selectors.deepl.nonSplittingTags] = domQuery(Selectors.deepl.nonSplittingTags);\n            settingsUI[Selectors.deepl.outlineDetection] = domQuery(Selectors.deepl.outlineDetection);\n            settingsUI[Selectors.deepl.preserveFormatting] = domQuery(Selectors.deepl.preserveFormatting);\n            settingsUI[Selectors.deepl.splitSentences] = domQuery(Selectors.deepl.splitSentences);\n            settingsUI[Selectors.deepl.splittingTags] = domQuery(Selectors.deepl.splittingTags);\n            settingsUI[Selectors.deepl.tagHandling] = domQuery(Selectors.deepl.tagHandling);\n            if (!config.isfree) {\n                settingsUI[Selectors.deepl.toneorstyle] = domQuery(Selectors.deepl.toneorstyle);\n            }\n            settingsUI[Selectors.actions.escapeLatex] = domQuery(Selectors.actions.escapeLatex);\n            settingsUI[Selectors.actions.escapePre] = domQuery(Selectors.actions.escapePre);\n            fetchCookies();\n            resizeEditors();\n        } catch (e) {\n            if (config.debug) {\n                Log.error(e.message);\n            }\n        }\n    };\n    /**\n     * Get the stored settings for this course and lang pair.\n     */\n    const fetchCookies = () => {\n        if (!config.targetlang) {\n            return;\n        }\n        const glossaryCookie = Utils.getCookie(config);\n        const newCookie = Utils.getEncodedCookie(config);\n        if (newCookie !== null) {\n            const settingsCookie = JSON.parse(newCookie);\n            for (const selector in settingsUI) {\n                if (settingsCookie[selector] !== undefined) {\n                    switch (settingsUI[selector].type) {\n                        case 'select-one' :\n                            setOptionFromCookie(settingsCookie[selector]);\n                            break;\n                        case 'checkbox' :\n                            settingsUI[selector].checked = settingsCookie[selector];\n                            break;\n                        case 'radio' :\n                            domQuery(selector + `[value=\"${settingsCookie[selector]}\"]`).checked = true;\n                            break;\n                        default:\n                            settingsUI[selector].value = settingsCookie[selector];\n                            break;\n                    }\n\n                }\n            }\n        }\n        if (glossaryCookie !== null) {\n            // Legacy cookie.\n            settingsUI[Selectors.deepl.glossaryId].value = glossaryCookie;\n        }\n    };\n    /**\n     * Selects a dd based on its value.\n     * @param {string} value\n     */\n    const setOptionFromCookie = (value)=>{\n        let optionToSelect = domQuery(`option[value=\"${value}\"]`);\n        if (optionToSelect) {\n            optionToSelect.selected = true;\n        }\n    };\n    /**\n     * Opens a modal infobox to warn user trunks of fields are saving.\n     * @param {object} messageObject\n     * @returns {Promise<void>}\n     */\n    const launchModal = async(messageObject) => {\n        saveAllModal = await Modal.create(messageObject);\n        await saveAllModal.show();\n    };\n\n    /**\n     * TinyMCE initialize.\n     *\n     * @param {Event} e\n     * @param {Object} options\n     * @return {Promise<void>}\n     */\n    const initTinyMCE = async(e, options) => {\n        try {\n            await TinyMCEinit.getTinyMCE(); // Ensure TinyMCE is initialized.\n            await TinyMCE.setupForTarget(e.target, options);\n            Log.info(`tiny loaded for ${e.target.id}`);\n        } catch (error) {\n            Log.error(error);\n        }\n    };\n\n    const handleFocusEvent = (e)=>{\n        if (e.target.closest(Selectors.editors.targetarea)) {\n            if (getIconStatus(e.target.id.replace('tiny_', '')) === Selectors.statuses.tosave) {\n                const options = {\n                    subdirs: false,\n                    maxbytes: 10240,\n                    maxfiles: 0,\n                    noclean: true,\n                    trusttext: true,\n                    // eslint-disable-next-line camelcase\n                    enable_filemanagement: false,\n                    autosave: false,\n                    removeorphaneddrafts: true,\n                    plugins: []\n                };\n                initTinyMCE(e, options);\n                // // eslint-disable-next-line promise/catch-or-return\n                // TinyMCEinit.getTinyMCE().then(\n                //     // eslint-disable-next-line promise/always-return\n                //     ()=>{\n                //         TinyMCE.setupForTarget(e.target, options)\n                //             // eslint-disable-next-line promise/always-return\n                //             .then(()=>{\n                //                 Log.info('tiny loaded for ' + e.target.id);\n                //             })\n                //             .catch((r)=>{\n                //                 Log.error(r);\n                //             });\n                //     }\n                // );\n            }\n\n        }\n    };\n    /**\n     * Event listener for click events.\n     *\n     * @param {event} e\n     */\n    const handleClickEvent = (e) => {\n        if (e.target.closest(Selectors.actions.toggleMultilang)) {\n            onToggleMultilang(e.target.closest(Selectors.actions.toggleMultilang));\n        }\n        if (e.target.closest(Selectors.actions.autoTranslateBtn)) {\n            if ((!config.canimprove && config.deeplsourcelang === config.targetlang) || config.targetlang === undefined) {\n                showModal('Cannot call deepl', `<p>${langstrings.uistrings.canttranslatesame} ${config.targetlang}</p>`);\n            } else {\n                callDeeplServices();\n            }\n        }\n        if (e.target.closest(Selectors.actions.selectAllBtn)) {\n            toggleAllCheckboxes(e);\n        }\n        if (e.target.closest(Selectors.actions.tothetop)) {\n            window.scrollTo({top: offsetTop - 5, behavior: 'smooth'});\n        }\n        if (e.target.closest(Selectors.actions.checkBoxes)) {\n            toggleAutotranslateButton();\n        }\n        if (e.target.closest(Selectors.actions.saveAll)) {\n            saveTranslations();\n        }\n        if (e.target.closest(Selectors.actions.validatorsBtns)) {\n            saveSingleTranslation(e);\n        }\n        if (e.target.closest(Selectors.glossary.entriesviewerPage)) {\n            Log.info('CLICK');\n            Log.info(settingsUI[Selectors.deepl.glossaryId].value);\n            Api.getGlossariesEntries(\n                settingsUI[Selectors.deepl.glossaryId].value,\n                config.deeplsourcelang,\n                config.targetlang\n            );\n        }\n    };\n    /**\n     * Event listener for change events.\n     * @param {event} e\n     */\n    const handleChangeEvent = (e) => {\n\n        if (e.target.closest(Selectors.actions.hideiframes)) {\n            doHideiframes(hideiframes.checked);\n        }\n        if (e.target.closest(Selectors.actions.targetSwitcher)) {\n            switchTarget(e);\n        }\n        if (e.target.closest(Selectors.actions.sectionSwitcher)) {\n            switchSection(e);\n        }\n        if (e.target.closest(Selectors.actions.moduleSwitcher)) {\n            switchModules(e);\n        }\n        if (e.target.closest(Selectors.actions.sourceSwitcher)) {\n            switchSource(e);\n        }\n        clearTimeout(filterTimeout);\n        filterTimeout = setTimeout(() => {\n            if (e.target.closest(Selectors.actions.showUpdated)) {\n                debouncedShowRows();\n            }\n            if (e.target.closest(Selectors.actions.showNeedUpdate)) {\n                debouncedShowRows();\n            }\n            if (e.target.closest(Selectors.actions.showHidden)) {\n                debouncedShowRows();\n            }\n        }, 30);\n        /* If (e.target.closest(Selectors.actions.showUpdated)) {\n            showRows(Selectors.statuses.updated, e.target.checked);\n        }\n        if (e.target.closest(Selectors.actions.showNeedUpdate)) {\n            showRows(Selectors.statuses.needsupdate, e.target.checked);\n        }\n        if (e.target.closest(Selectors.actions.showHidden)) {\n            showRows(Selectors.statuses.hidden, e.target.checked);\n        }*/\n        if (e.target.closest(Selectors.actions.checkBoxes)) {\n            onItemChecked(e);\n        }\n        if (e.target.closest(Selectors.actions.sourceselect)) {\n            onSourceChange(e);\n        }\n        if (e.target.closest(Selectors.deepl.glossaryId)) {\n            if (settingsUI[Selectors.deepl.glossaryId].value !== '') {\n                glossaryDetailViewr.style.display = 'block';\n            } else {\n                glossaryDetailViewr.style.display = 'none';\n            }\n        }\n    };\n    /**\n     * Toggle iFrames in sourcetexts.\n     * @param {boolean} isChecked\n     */\n    function doHideiframes(isChecked) {\n        const allIframes = domQueryAll(Selectors.sourcetexts.iframes);\n        if (!isChecked && allIframes.length > 0) {\n            removedIframes = [];\n            allIframes.forEach(iframe => {\n                removedIframes.push({\n                    parent: iframe.parentNode,\n                    nextSibling: iframe.nextSibling,\n                    html: iframe.outerHTML\n                });\n                iframe.remove();\n            });\n        } else if (removedIframes.length > 0) {\n            // Restore all previously removed iframes.\n            removedIframes.forEach(info => {\n                // Create a new element from the stored HTML.\n                const tempDiv = document.createElement('div');\n                tempDiv.innerHTML = info.html;\n                const newIframe = tempDiv.firstChild;\n                // Insert it back into the DOM\n                if (info.nextSibling) {\n                    info.parent.insertBefore(newIframe, info.nextSibling);\n                } else {\n                    info.parent.appendChild(newIframe);\n                }\n            });\n            removedIframes = [];\n        }\n    }\n\n\n    /**\n     * Multilang button handler\n     *\n     * @param {Event} e Event\n     */\n    const onToggleMultilang = (e) => {\n        let keyid = e.getAttribute('aria-controls');\n        let key = Utils.keyidToKey(keyid);\n        if (key === null) {\n            Log.error(`KEY ${keyid} BAD FORMAT should be TABLE-ID-FIELD-CMID`);\n        } else {\n            let source = domQuery(Selectors.sourcetexts.keys, key);\n            let multilang = domQuery(Selectors.sourcetexts.multilangs, keyid);\n            source.classList.toggle(\"show\");\n            multilang.classList.toggle(\"show\");\n        }\n    };\n\n    /**\n     * @returns void\n     */\n    const saveTranslations = () => {\n        const selectedCheckboxes = domQueryAll(Selectors.statuses.checkedCheckBoxes);\n        if (selectedCheckboxes.length === 0) {\n            return;\n        }\n        // Prepare the UI for the save process.\n        saveAllBtn.disabled = true;\n        launchModal({\n            title: langstrings.uistrings.saveallmodaltitle,\n            body: langstrings.uistrings.saveallmodalbody,\n        }).then(r => Log.info('SaveAll Modal launched ' + r)).catch((reason)=>{\n            Log.error(reason);\n        });\n        // Prepare the data to be saved.\n        const data = [];\n        const keys = Array.from(selectedCheckboxes).map((e) => e.dataset.key);\n        keys.forEach((key) => {\n                // @todo MDL-0000: should not rely on UI (add a flag in temptranslations object) .\n                if (getIconStatus(key) === Selectors.statuses.tosave) {\n                    hideErrorMessage(key);\n                    data.push(prepareDBitem(key));\n                }\n            }\n        );\n        Translation.saveTranslations(data, config);\n    };\n    /**\n     * Saving a single translation to DB.\n     * @param {Event} e\n     */\n    const saveSingleTranslation = (e)=> {\n        const key = e.target.closest(Selectors.actions.validatorsBtns).dataset.keyValidator;\n        if (getIconStatus(key) === Selectors.statuses.tosave) {\n            hideErrorMessage(key);\n            Translation.saveTranslations([prepareDBitem(key)], config);\n        }\n    };\n    /**\n     *\n     * @param {string} key\n     * @returns {{key, courseid, id: number, tid: *, table: *, field: *}}\n     */\n    const prepareDBitem = (key) => {\n        const element = domQuery(Selectors.editors.multiples.editorsWithKey, key);\n        return {\n            key: key,\n            courseid: config.courseid,\n            id: parseInt(element.getAttribute(\"data-id\")),\n            tid: element.getAttribute(\"data-tid\"),\n            table: element.getAttribute(\"data-table\"),\n            field: element.getAttribute(\"data-field\"),\n            cmid: element.getAttribute(\"data-cmid\"),\n        };\n    };\n    /**\n     * Listener for individual source change.\n     * @todo MDL-000 implement in v1.4.0\n     *\n     * @param {event} e\n     */\n    const onSourceChange = (e) => {\n        // Do check source and target and propose rephrase if PRO.\n        Log.info('source changed');\n        Log.info(e.target.getAttribute('data-key'));\n    };\n    /**\n     * Event listener for selection checkboxes.\n     * @param {Event} e\n     */\n    const onItemChecked = (e) => {\n        // Check/uncheck checkboxes changes the charcount and icon status.\n        if (e.target.getAttribute('data-action') === \"local_deepler/checkbox\") {\n            toggleStatus(e.target.getAttribute('data-key'), e.target.checked);\n            countWordAndChar();\n        }\n    };\n\n    /**\n     * Toggle checkboxes\n     * @param {Event} e Event\n     */\n    const toggleAllCheckboxes = (e) => {\n        const checked = e.target.checked;\n        const updates = [];\n\n        // Prepare all updates without applying immediately.\n        checkboxes.forEach(checkbox => {\n            const shouldCheck = checked ? !getParentRow(checkbox).classList.contains('d-none') : false;\n\n            if (checkbox.checked !== shouldCheck) {\n                updates.push({checkbox, shouldCheck});\n            }\n        });\n\n        // Apply updates in the next animation frame, batching DOM writes.\n        requestAnimationFrame(() => {\n            updates.forEach(({checkbox, shouldCheck}) => {\n                checkbox.checked = shouldCheck;\n                toggleStatus(checkbox.getAttribute('data-key'), shouldCheck);\n            });\n\n            toggleAutotranslateButton();\n            countWordAndChar();\n        });\n    };\n    /**\n     * Toggle Autotranslate Button\n     */\n    const toggleAutotranslateButton = () => {\n        // Use Array.some() for early exit when a checked checkbox is found\n        autotranslateButton.disabled = !Array.from(checkboxes).some(e => e.checked);\n    };\n    /**\n     * Get the translation row status icon.\n     *\n     * @param {string} key\n     * @returns {*}\n     */\n    const getIconStatus = (key)=> {\n        return domQuery(Selectors.actions.validatorBtn, key).getAttribute('data-status');\n    };\n    /**\n     * Change translation process status icon.\n     *\n     * @param {string} key\n     * @param {string} status\n     * @param {boolean} isBtn\n     */\n    const setIconStatus = (key, status = Selectors.statuses.wait, isBtn = false) => {\n        let icon = domQuery(Selectors.actions.validatorBtn, key);\n        if (!isBtn) {\n            if (!icon.classList.contains('disable')) {\n                icon.classList.add('disable');\n            }\n            if (icon.classList.contains('btn')) {\n                icon.classList.remove('btn');\n                icon.classList.remove('btn-outline-secondary');\n            }\n        } else {\n            if (!icon.classList.contains('btn')) {\n                icon.classList.add('btn');\n                icon.classList.add('btn-outline-secondary');\n            }\n            if (icon.classList.contains('disable')) {\n                icon.classList.remove('disable');\n            }\n        }\n        icon.setAttribute('role', isBtn ? 'button' : 'status');\n        icon.setAttribute('data-status', status);\n        icon.setAttribute('title', langstrings.statusstrings[status.replace('local_deepler/', '')]);\n    };\n    /**\n     * Fetch the parent row of the translation.\n     * @param {Node} node\n     * @returns {*}\n     */\n    const getParentRow = (node) => {\n        return node.closest(Utils.replaceKey(Selectors.sourcetexts.parentrow, node.getAttribute('data-key')));\n    };\n    const showModal = (title, body, type = 'default') => {\n        Modal.create({\n            title: title,\n            body: body,\n            type: type,\n            show: true,\n            removeOnClose: true,\n        });\n    };\n    /**\n     * Event Listener when DeepL API call failed.\n     * @param {string} error\n     */\n    const onTranslationFailed = (error) => {\n        let s = langstrings.uistrings.deeplapiexception;\n        onTranslationDone();\n        showModal(s, error, 'Alert');\n    };\n    /**\n     * Event Listener when DeepL API call finished.\n     */\n    const onTranslationDone = () => {\n        if (saveAllModal !== null && saveAllModal.isVisible) {\n            saveAllModal.hide();\n        }\n    };\n    /**\n     * Event listener for the translations process to dispaly the status.\n     *\n     * @param {string} key\n     */\n    const onItemTranslated = (key) => {\n        // Add saved indicator.\n        setIconStatus(key, Selectors.statuses.tosave, true);\n    };\n    /**\n     * Launch deepl services.\n     */\n    const callDeeplServices = () => {\n        saveAllModal = launchModal(\n            {\n                title: langstrings.uistrings.translatemodaltitle,\n                body: langstrings.uistrings.translatemodalbody,\n            }\n        );\n        const keys = [];\n        const [cookie, settings] = prepareSettingsAndCookieValues();\n        saveAllBtn.disabled = false;\n        domQueryAll(Selectors.statuses.checkedCheckBoxes)\n            .forEach((ckBox) => {\n                const key = ckBox.getAttribute(\"data-key\");\n                const sourceText = domQuery(Selectors.sourcetexts.keys, key);\n                const editor = findEditor(key);\n                Translation.initTempForKey(\n                    key, editor,\n                    sourceText.getAttribute(\"data-sourcetext-raw\"),\n                    sourceText.getAttribute(\"data-filedtext-raw\"),\n                    domQuery(Selectors.sourcetexts.sourcelangdd, key).value\n                );\n                keys.push(key);\n            });\n        const newCookiename = Utils.COOKIE_PREFIX_NEW + config.currentlang + config.targetlang + config.courseid;\n        Utils.setEncodedCookie(newCookiename, JSON.stringify(cookie), config.cookieduration);\n        Translation.callTranslations(keys, config, settings);\n    };\n    /**\n     * Parse the advanced settings UI and map the values for cookies and Deepl.\n     *\n     * @returns {[{},{}]}\n     */\n    const prepareSettingsAndCookieValues = () => {\n        let settings = {};\n        let cookie = {};\n        for (const selector in settingsUI) {\n            if (settingsUI[selector] === null) {\n                Log.warn(`prepareSettingsAndCookieValues. Could not find selector ${selector}`);\n                Log.warn(settingsUI);\n            } else {\n                switch (settingsUI[selector].type) {\n                    case 'select-one':\n                        cookie[selector] = settingsUI[selector].value;\n                        settings[selector] = settingsUI[selector].value;\n                        break;\n                    case 'textarea':\n                        cookie[selector] = settingsUI[selector].value;\n                        // Deepl needs an array.\n                        settings[selector] = Utils.toJsonArray(cookie[selector]);\n                        break;\n                    case 'checkbox':\n                        if (selector === Selectors.deepl.tagHandling) {\n                            cookie[selector] = settingsUI[selector].checked;\n                            // Exception for tag_handling that checkbox but not boolean value for Deepl.\n                            settings[selector] = settingsUI[selector].checked ? 'html' : 'xml';\n                        } else {\n                            settings[selector] = cookie[selector] = settingsUI[selector].checked;\n                        }\n                        break;\n                    case 'radio':\n                        settings[selector] = cookie[selector] = queryRadioValue(selector);\n                        break;\n                    default: // Text.\n                        settings[selector] = cookie[selector] = settingsUI[selector].value;\n                        break;\n                }\n            }\n        }\n        return [cookie, settings];\n    };\n    /**\n     * Factory to display process' statuses for each item.\n     *\n     * @param {String} key\n     * @param {Boolean} checked\n     */\n    const toggleStatus = (key, checked) => {\n        const status = domQuery(Selectors.actions.validatorBtn, key).dataset.status;\n        switch (status) {\n            case Selectors.statuses.wait :\n                Translation.initTemp(key); // Reset the translation.\n                if (checked) {\n                    setIconStatus(key, Selectors.statuses.totranslate);\n                }\n                break;\n            case Selectors.statuses.totranslate :\n                if (checked && Translation.translated[key]) {\n                    setIconStatus(key, Selectors.statuses.tosave, true);\n                } else {\n                    setIconStatus(key, Selectors.statuses.wait);\n                }\n                break;\n            case Selectors.statuses.tosave :\n                if (!checked) {\n                    setIconStatus(key, Selectors.statuses.totranslate);\n                }\n                break;\n            case Selectors.statuses.failed :\n                if (checked) {\n                    setIconStatus(key, Selectors.statuses.totranslate);\n                }\n                break;\n            case Selectors.statuses.success :\n                break;\n            case Selectors.statuses.saved :\n                if (checked) {\n                    setIconStatus(key, Selectors.statuses.totranslate);\n                }\n                Translation.initTemp(key);\n                break;\n        }\n    };\n    /**\n     * Shows/hides rows.\n     */\n    const showRows = () => {\n        // Map each selector to its corresponding checkbox checked state\n        const selectorMap = {\n            [Selectors.statuses.updated]: domQuery(Selectors.actions.showUpdated).checked,\n            [Selectors.statuses.needsupdate]: domQuery(Selectors.actions.showNeedUpdate).checked,\n            [Selectors.statuses.hidden]: domQuery(Selectors.actions.showHidden).checked\n        };\n\n        // Combine all selectors into one comma-separated string for batch querying.\n        const mergedSelector = Object.keys(selectorMap).join(\",\");\n\n        // Query all items matching any of the selectors once.\n        const allItems = domQueryAll(mergedSelector);\n\n        // Cache the global \"select all\" button checked state once.\n        const allSelected = domQuery(Selectors.actions.selectAllBtn).checked;\n\n        allItems.forEach(item => {\n            // Determine which selector this item matches so we can apply the right checkbox state.\n            let shouldShow = false;\n            let shouldCheck = false;\n            for (const [selector, checked] of Object.entries(selectorMap)) {\n                if (item.matches(selector)) {\n                    shouldShow = checked;\n                    shouldCheck = allSelected && checked;\n                    break;\n                }\n            }\n\n            // Show or hide item based on checkbox state.\n            item.classList.toggle(\"d-none\", !shouldShow);\n\n            // Handle checkbox selection for this item or its children.\n            let rowId = item.getAttribute('data-row-id');\n            if (rowId === null) {\n                // For items without row-id, toggle checkboxes of their child rows.\n                const childs = domQueryAll(Selectors.statuses.hiddenForStudentRows, '', item);\n                childs.forEach(child => {\n                    const childId = child.getAttribute('data-row-id');\n                    toggleChildCheckBoxSelection(childId, shouldCheck);\n                });\n            } else {\n                toggleChildCheckBoxSelection(rowId, shouldCheck);\n            }\n        });\n\n        // Call global UI update functions once\n        toggleAutotranslateButton();\n        countWordAndChar();\n    };\n    /**\n     * Manages selection and icon status of fields.\n     *\n     * @param {string} key\n     * @param {bool} shouldBeChecked\n     */\n    const toggleChildCheckBoxSelection = (key, shouldBeChecked)=>{\n        const single = domQuery(Selectors.editors.multiples.checkBoxesWithKey, key);\n        single.checked = shouldBeChecked;\n        toggleStatus(key, false);\n    };\n    /**\n     * Displays error message and icon.\n     *\n     * @param {string} key\n     * @param {string} error\n     */\n    const onErrorMessageItem = (key, error) => {\n        Log.warn(`ui/errorMessageItem`);\n        Log.warn(key);\n        Log.warn(error);\n        const editor = domQuery(Selectors.editors.multiples.editorsWithKey, key);\n        editor.classList.add(\"local_deepler__error\");\n        setIconStatus(key, Selectors.statuses.failed);\n        // Display granular error messages.\n        const indexOfSET = error.indexOf(\"Data too long\");// Probably a text too long for the field if not -1.\n        if (indexOfSET === -1) {\n            showErrorMessageForEditor(key, error);\n        } else {\n            let s = langstrings.uistrings.errortoolong;\n            showErrorMessageForEditor(key, `${error.substring(0, error.indexOf('WHERE id=?'))} ${s}`);\n        }\n    };\n    /**\n     * Hides an item's error message.\n     *\n     * @param {String} key\n     */\n    const hideErrorMessage = (key) => {\n        let parent = domQuery(Selectors.editors.multiples.editorsWithKey, key);\n        let alertChild = domQuery('.alert-danger', '', parent);\n        if (alertChild) {\n            parent.removeChild(alertChild);\n        }\n    };\n    /**\n     * Displays success message and icon.\n     *\n     * @param {String} key\n     * @param {string} savedText\n     */\n    const onSuccessMessageItem = (key, savedText) => {\n        domQuery(Selectors.editors.multiples.editorsWithKey, key)\n            .classList.add(\"local_deepler__success\");\n        // Add saved indicator.\n        setIconStatus(key, Selectors.statuses.success);\n        // Replace text in the multilang textarea.\n        const multilangTextarea = domQuery(Selectors.editors.multiples.textAreas, key);\n        multilangTextarea.innerHTML = savedText;\n        // Deselect the checkbox.\n        domQuery(Selectors.editors.multiples.checkBoxesWithKey, key).checked = false;\n        // Remove success message after a few seconds.\n        setTimeout(() => {\n            let multilangPill = domQuery(Selectors.statuses.multilang, key);\n            let prevTransStatus = domQuery(Selectors.statuses.prevTransStatus, key);\n            prevTransStatus.classList = \"badge badge-pill badge-success\";\n            if (multilangPill.classList.contains(\"disabled\")) {\n                multilangPill.classList.remove('disabled');\n            }\n            setIconStatus(key, Selectors.statuses.saved);\n        });\n    };\n    /**/\n    /**\n     * Display error message attached to the item's editor.\n     * @param {String} key\n     * @param {String} message\n     */\n    const showErrorMessageForEditor = (key, message) => {\n        let parent = domQuery(Selectors.editors.multiples.editorsWithKey, key);\n        const errorMsg = document.createElement('div');\n        errorMsg.id = 'local_deepler__errormsg';\n        errorMsg.classList = ['alert alert-danger'];\n        errorMsg.innerHTML = message;\n        parent.appendChild(errorMsg);\n    };\n    /**\n     * Event listener to switch target lang.\n     * @param {Event} e\n     */\n    const switchTarget = (e) => {\n        let url = new URL(window.location.href);\n        let searchParams = url.searchParams;\n        // Pass the target lang in the url and refresh, not forgetting to remove the rephrase prefix indicator.\n        searchParams.set(\"target_lang\", e.target.value.replace(config.rephrasesymbol, '').trim());\n        window.location = url.toString();\n    };\n    /**\n     * Event listener to filter sections.\n     * @param {Event} e\n     */\n    const switchSection = (e) => {\n        let url = new URL(window.location.href);\n        let searchParams = url.searchParams;\n        // Pass the target lang in the url and refresh, not forgetting to remove the rephrase prefix indicator.\n        searchParams.set(\"section_id\", e.target.value.trim());\n        if (searchParams.has(\"activity_id\")) {\n            searchParams.delete(\"activity_id\");\n        }\n        window.location = url.toString();\n    };\n    /**\n     * Event listener to filter modules.\n     * @param {Event} e\n     */\n    const switchModules = (e) => {\n        let url = new URL(window.location.href);\n        let searchParams = url.searchParams;\n        // Pass the target lang in the url and refresh, not forgetting to remove the rephrase prefix indicator.\n        searchParams.set(\"activity_id\", e.target.value.trim());\n        window.location = url.toString();\n    };\n    /**\n     * Event listener to switch source lang,\n     * Hence reload the page and change the site main lang.\n     * @param {Event} e\n     */\n    const switchSource = (e) => {\n        let url = new URL(window.location.href);\n        let searchParams = url.searchParams;\n        searchParams.set(\"lang\", e.target.value);\n        window.location = url.toString();\n    };\n    /**\n     * Launch, display count of Words And Chars.\n     */\n    const countWordAndChar = () => {\n        let wrdsc = 0,\n        cws = 0,\n        cwos = 0;\n\n        // Cache checkboxes matching selector once, convert to array if needed.\n        const checkedBoxes = Array.from(domQueryAll(Selectors.statuses.checkedCheckBoxes));\n\n        // Aggregate counts in one loop.\n        checkedBoxes.forEach(ckBox => {\n            const key = ckBox.getAttribute(\"data-key\");\n            const results = getCount(key);\n            wrdsc += results.wordCount;\n            cws += results.charNumWithSpace;\n            cwos += results.charNumWithOutSpace;\n        });\n\n        // Cache DOM elements once for output instead of querying repeatedly.\n        const wordCount = cachedSelectors.wordCount;\n        const charWithSpace = cachedSelectors.charWithSpace;\n        const charWOSpace = cachedSelectors.charWOSpace;\n        const deeplUseSpan = cachedSelectors.deeplUseSpan;\n        const deeplMaxSpan = cachedSelectors.deeplMaxSpan;\n        const parent = cachedSelectors.deeplStatusContainer;\n\n        // Calculate current usage once.\n        const current = cws + config.usage.character.count;\n\n        // Update UI in one batch (minimizes layout thrashing).\n        wordCount.innerText = wrdsc;\n        charWithSpace.innerText = cws;\n        charWOSpace.innerText = cwos;\n        deeplUseSpan.innerText = format.format(current);\n        deeplMaxSpan.innerText = config.usage.character.limit === null ? 'âˆž' : format.format(config.usage.character.limit);\n\n        // Toggle classes efficiently.\n        parent.classList.toggle('alert-success', current < config.usage.character.limit || config.usage.character.limit === null);\n        parent.classList.toggle('alert-danger', current >= config.usage.character.limit && config.usage.character.limit !== null);\n    };\n    /**\n     * Get the editor container based on recieved current user's editor preference.\n     *\n     * @param {string} key Translation Key\n     */\n    const findEditor = (key) => {\n        let e = domQuery(Selectors.editors.types.basic, key);\n        let et = 'basic';\n        if (e === null) {\n            let r = null;\n            let editorTab = [\"atto\", \"tiny\", \"marklar\", \"textarea\"];\n            if (editorTab.indexOf(config.userPrefs) === -1) {\n                Log.warn('Unsupported editor ' + config.userPrefs);\n            } else {\n                // First let's try the current editor.\n                try {\n                    r = findEditorByType(key, config.userPrefs);\n                } catch (error) {\n                    // Content was edited by another editor.\n                    Log.trace(`Editor not found: ${config.userPrefs} for key ${key}`);\n                }\n            }\n            return r;\n        } else {\n            return {editor: e, editorType: et};\n        }\n    };\n    /**\n     * @param {string} key\n     * @param {object} editorType\n     * @returns {{editor: object, editorType: string}}\n     */\n    const findEditorByType = (key, editorType) => {\n        let et = 'basic';\n        let ed = null;\n        switch (editorType) {\n            case \"atto\" :\n                et = 'iframe';\n                ed = domQuery(Selectors.editors.types.atto, key);\n                break;\n            case \"tiny\":\n                et = 'iframe';\n                ed = findTinyInstanceByKey(key);\n                break;\n            case 'marklar':\n            case \"textarea\" :\n                ed = domQuery(Selectors.editors.types.other, key);\n                break;\n        }\n        return {editor: ed, editorType: et};\n    };\n    /**\n     * Finds TinyMCE instance.\n     * @param {string} key\n     * @returns {Node}\n     */\n    const findTinyInstanceByKey = (key)=> {\n        let editor = null;\n        TinyMCE.getAllInstances().every((k, v)=>{\n            if (v.attributes.name.value.indexOf(key) == 0) {\n                editor = k.getBody();\n                return false;\n            }\n            return true;\n        });\n        return editor;\n    };\n    /**\n     * Compile the needed counts for info.\n     *\n     * @param {string} key\n     * @returns {{wordCount: *, charNumWithSpace: *, charNumWithOutSpace: *}}\n     */\n    const getCount = (key) => {\n        const item = domQuery(Selectors.sourcetexts.keys, key);\n        const raw = item.getAttribute(\"data-sourcetext-raw\");\n        // Cleaned sourceText.\n        const trimmedVal = Utils.stripHTMLTags(Utils.fromBase64(raw)).trim();\n        return {\n            \"wordCount\": (trimmedVal.match(/\\S+/g) || []).length,\n            \"charNumWithSpace\": trimmedVal.length,\n            \"charNumWithOutSpace\": trimmedVal.replace(/\\s+/g, '').length\n        };\n    };\n    /**\n     * Wrapper for radios value.\n     *\n     * @param {string} selector\n     * @returns {*}\n     */\n    const queryRadioValue = (selector) => {\n        return domQuery(Selectors.actions.radioValues.replace(\"<RADIO>\", selector)).value;\n    };\n    /**\n     * Shortcut for dom querySelector.\n     *\n     * @param {string} selector\n     * @param {string} key\n     * @param {element} target\n     * @returns {element}\n     */\n    const domQuery = (selector, key = '', target = null) => {\n        const el = target ?? document;\n        const q = key === '' ? selector : selector.replace(\"<KEY>\", key);\n        return el.querySelector(q);\n    };\n\n    /**\n     * Shortcut for dom querySelector.\n     *\n     * @param {string} selector\n     * @param {string} key\n     * @param {element} target\n     * @returns {NodeList}\n     */\n    const domQueryAll = (selector, key = '', target = null) => {\n        const el = target ?? document;\n        const q = key === '' ? selector : selector.replace(\"<KEY>\", key);\n        return el.querySelectorAll(q);\n    };\n    /**\n     * Event listener to switch source lang.\n     * @param {*} cfg\n     */\n    const init = (cfg) => {\n        offsetTop = domQuery(Selectors.config.langstrings).offsetTop;\n        ScrollSpy.init('.local_deepler__form', '#local_deepler-scrollspy',\n            {highestLevel: 3, fadingDistance: 60, offsetEndOfScope: 1, offsetTop: 100, crumbsmaxlen: cfg.crumbsmaxlen});\n        Translation.init(cfg);\n        config = cfg;\n        Log.info(cfg);\n        registerUI();\n        registerEventListeners();\n        toggleAutotranslateButton();\n        doHideiframes(hideiframes.checked);\n        saveAllBtn.disabled = true;\n        selectAllBtn.disabled = !Translation.isTranslatable();\n        checkboxes.forEach((node) => {\n            node.disabled = selectAllBtn.disabled;\n        });\n        debouncedShowRows();\n    };\n    /**\n     * Api to be used by the other modules.\n     */\n    return {\n        init: init\n    };\n});\n"],"names":["define","Log","TinyMCEinit","TinyMCE","Modal","Selectors","Translation","Utils","Events","ScrollSpy","Api","debouncedShowRows","debounce","fn","delay","timer","_len","arguments","length","args","Array","_key","clearTimeout","setTimeout","showRows","cachedSelectors","wordCount","document","querySelector","statuses","wordcount","charWithSpace","charNumWithSpace","charWOSpace","charNumWithOutSpace","deeplUseSpan","deeplUsage","deeplMaxSpan","deeplMax","deeplStatusContainer","offsetTop","glossaryDetailViewr","filterTimeout","hideiframes","removedIframes","config","langstrings","autotranslateButton","saveAllBtn","selectAllBtn","checkboxes","format","Intl","NumberFormat","saveAllModal","errordbtitle","settingsUI","allDataFormatOne","onDBFailed","error","status","isVisible","hide","showModal","onDbSavedSuccess","errors","s","uistrings","errordbpartial","replace","showEntriesModal","ajaxResponse","glossaryid","entries","JSON","parse","message","table","createElement","className","thead","innerHTML","source","toUpperCase","target","appendChild","tbody","Object","forEach","_ref","key","value","row","create","title","body","type","show","removeOnClose","onGlossaryDbAllfailed","obj","info","onGlossaryDbfailed","onGlossaryDbSuccess","resizeEditors","editable","id","parent","domQuery","grandparent","parentElement","resizeObserver","ResizeObserver","updateEditableHeight","totalHeight","offsetHeight","style","height","observe","fetchCookies","targetlang","glossaryCookie","getCookie","newCookie","getEncodedCookie","settingsCookie","selector","undefined","setOptionFromCookie","checked","deepl","glossaryId","optionToSelect","selected","launchModal","async","messageObject","handleFocusEvent","e","closest","editors","targetarea","getIconStatus","tosave","options","getTinyMCE","setupForTarget","initTinyMCE","subdirs","maxbytes","maxfiles","noclean","trusttext","enable_filemanagement","autosave","removeorphaneddrafts","plugins","handleClickEvent","actions","toggleMultilang","onToggleMultilang","autoTranslateBtn","canimprove","deeplsourcelang","canttranslatesame","callDeeplServices","toggleAllCheckboxes","tothetop","window","scrollTo","top","behavior","checkBoxes","toggleAutotranslateButton","saveAll","saveTranslations","validatorsBtns","saveSingleTranslation","glossary","entriesviewerPage","getGlossariesEntries","handleChangeEvent","doHideiframes","targetSwitcher","switchTarget","sectionSwitcher","switchSection","moduleSwitcher","switchModules","sourceSwitcher","switchSource","showUpdated","showNeedUpdate","showHidden","onItemChecked","sourceselect","onSourceChange","display","isChecked","allIframes","domQueryAll","sourcetexts","iframes","iframe","push","parentNode","nextSibling","html","outerHTML","remove","tempDiv","newIframe","firstChild","insertBefore","keyid","getAttribute","keyidToKey","keys","multilang","multilangs","classList","toggle","selectedCheckboxes","checkedCheckBoxes","disabled","saveallmodaltitle","saveallmodalbody","then","r","catch","reason","data","from","map","dataset","hideErrorMessage","prepareDBitem","keyValidator","element","multiples","editorsWithKey","courseid","parseInt","tid","field","cmid","toggleStatus","countWordAndChar","updates","checkbox","shouldCheck","getParentRow","contains","requestAnimationFrame","_ref2","some","validatorBtn","setIconStatus","wait","isBtn","icon","add","setAttribute","statusstrings","node","replaceKey","parentrow","onTranslationFailed","deeplapiexception","onTranslationDone","onItemTranslated","translatemodaltitle","translatemodalbody","cookie","settings","prepareSettingsAndCookieValues","ckBox","sourceText","editor","findEditor","initTempForKey","sourcelangdd","newCookiename","COOKIE_PREFIX_NEW","currentlang","setEncodedCookie","stringify","cookieduration","callTranslations","warn","toJsonArray","tagHandling","queryRadioValue","initTemp","totranslate","translated","failed","success","saved","selectorMap","updated","needsupdate","hidden","mergedSelector","join","allItems","allSelected","item","shouldShow","matches","rowId","hiddenForStudentRows","child","childId","toggleChildCheckBoxSelection","shouldBeChecked","checkBoxesWithKey","onErrorMessageItem","indexOf","showErrorMessageForEditor","errortoolong","substring","alertChild","removeChild","onSuccessMessageItem","savedText","textAreas","multilangPill","prevTransStatus","errorMsg","url","URL","location","href","searchParams","set","rephrasesymbol","trim","toString","has","delete","wrdsc","cws","cwos","results","getCount","current","usage","character","count","innerText","limit","types","basic","userPrefs","findEditorByType","trace","editorType","et","ed","atto","findTinyInstanceByKey","other","getAllInstances","every","k","v","attributes","name","getBody","raw","trimmedVal","stripHTMLTags","fromBase64","match","radioValues","el","q","querySelectorAll","init","cfg","highestLevel","fadingDistance","offsetEndOfScope","crumbsmaxlen","registerUI","context","formality","modelType","ignoreTags","nonSplittingTags","outlineDetection","preserveFormatting","splitSentences","splittingTags","isfree","toneorstyle","escapeLatex","escapePre","debug","addEventListener","on","ON_ITEM_TRANSLATED","ON_TRANSLATION_FAILED","ON_TRANSLATION_DONE","ON_REPHRASE_FAILED","ON_DB_SAVE_SUCCESS","ON_DB_FAILED","ON_ITEM_SAVED","ON_ITEM_NOT_SAVED","GLOSSARY_DB_ALL_FAILED","GLOSSARY_DB_FAILED","GLOSSARY_DB_SUCCESS","GLOSSARY_ENTRIES_SUCCESS","GLOSSARY_ENTRIES_FAILED","isTranslatable"],"mappings":"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"}