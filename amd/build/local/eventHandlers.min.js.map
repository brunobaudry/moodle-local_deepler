{"version":3,"file":"eventHandlers.min.js","sources":["../../src/local/eventHandlers.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n *  description here.\n *\n * @module     'local_deepler'; // Full name of the plugin (used for diagnostics)./local/eventHandlers\n * @copyright  2025 Bruno Baudry <bruno.baudry@bfh.ch>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n        'core/log',\n        './utils',\n        './translation',\n        './api',\n        './customevents',\n        './selectors',\n        './uiHelpers',\n        './settings'\n    ],\n    (\n     Log,\n     Utils,\n     Translation,\n     Api,\n     Events,\n     Selectors,\n     UI,\n     Settings\n    )=>{\n        let config = {};\n        let filterTimeout;\n        let mainEditorIsTextArea;\n        /**\n         * Event factories.\n         */\n        const registerEventListeners = () => {\n            document.addEventListener('change', handleChangeEvent);\n            document.addEventListener('click', handleClickEvent);\n            document.addEventListener('focusin', handleFocusEvent);\n\n            // Translation events.\n            Events.on(Translation.ON_ITEM_TRANSLATED, onItemTranslated);\n            Events.on(Translation.ON_TRANSLATION_FAILED, onTranslationFailed);\n            Events.on(Translation.ON_TRANSLATION_DONE, onTranslationDone);\n            Events.on(Translation.ON_REPHRASE_FAILED, onTranslationFailed);\n            Events.on(Translation.ON_DB_SAVE_SUCCESS, onDbSavedSuccess);\n            Events.on(Translation.ON_DB_FAILED, onDBFailed);\n            Events.on(Translation.ON_ITEM_SAVED, onSuccessMessageItem);\n            Events.on(Translation.ON_ITEM_NOT_SAVED, onErrorMessageItem);\n            // Events.on(UI.ON_STATUS_CHANGED, onIconStatusChanged);\n            Events.on(Api.GLOSSARY_DB_ALL_FAILED, onGlossaryDbAllfailed);\n            Events.on(Api.GLOSSARY_DB_FAILED, onGlossaryDbfailed);\n            Events.on(Api.GLOSSARY_DB_SUCCESS, onGlossaryDbSuccess);\n            Events.on(Api.GLOSSARY_ENTRIES_SUCCESS, UI.showEntriesModal);\n            Events.on(Api.GLOSSARY_ENTRIES_FAILED, (e)=>Log.error(e));\n        };\n        /**\n         * Focus.\n         *\n         * @param {event} e\n         */\n        const handleFocusEvent = (e)=>{\n            if (e.target.closest(Selectors.editors.targetarea)) {\n                // Window.console.group('handleFocusEvent');\n                // window.console.log(e, e.target);\n                // window.console.groupEnd();\n                UI.wrapTinyOnTarget(e.target);\n            }\n        };\n        /**\n         * Event listener for click events.\n         *\n         * @param {event} e\n         */\n        const handleClickEvent = (e) => {\n\n            if (e.target.closest(Selectors.actions.autoTranslateBtn)) {\n                callDeeplServices();\n            }\n            if (e.target.closest(Selectors.actions.selectAllBtn)) {\n                // Here.\n                UI.toggleAllCheckboxes(e.target.checked);\n                Translation.updatTempStatusAll(\n                    e.target.checked ? Selectors.process.totranslate : Selectors.process.wait);\n            }\n            if (e.target.closest(Selectors.actions.tothetop)) {\n                UI.backToBase();\n            }\n           /* If (e.target.closest(Selectors.actions.checkBoxes)) {\n                UI.toggleAutotranslateButton();\n            }*/\n\n\n            if (e.target.closest(Selectors.glossary.entriesviewerPage)) {\n                Log.info('CLICK');\n                Log.info(Settings.getValue(Selectors.deepl.glossaryId));\n                Api.getGlossariesEntries(\n                    Settings.getValue(Selectors.deepl.glossaryId),\n                    config.deeplsourcelang,\n                    config.targetlang\n                );\n            }\n            const rowContainer = e.target.closest('[data-row-id]');\n            if (rowContainer) {\n                // Const key = rowContainer.getAttribute('data-row-id');\n                if (e.target.closest(Selectors.actions.toggleMultilang)) {\n                    onToggleMultilang(rowContainer);\n                }\n                if (e.target.closest(Selectors.actions.validatorsBtns)) {\n                    const process = rowContainer.getAttribute('data-process');\n                    switch (process) {\n                        case Selectors.process.tosave :\n                            // OnItemChecked(key, e.target.checked);\n                            saveSingleTranslation(rowContainer);\n                            break;\n                    }\n                }\n            }\n            if (e.target.closest(Selectors.actions.saveAll)) {\n                saveTranslations();\n            }\n        };\n        /**\n         * Event listener for change events.\n         * @param {Event} e\n         */\n        const handleChangeEvent = (e) => {\n            if (e.target.closest(Selectors.actions.escapeLatex)) {\n\n            }\n            if (e.target.closest(Selectors.actions.escapePre)) {\n\n            }\n            if (e.target.closest(Selectors.actions.hideiframes)) {\n                // Triggered by advanced admin #local_deepler__hideiframes.\n                UI.doHideiframes();\n            }\n            if (e.target.closest(Selectors.actions.targetSwitcher)) {\n                // Triggered by the target language drop down.\n                Utils.switchLocation(\n                    {\n                        key: 'target_lang',\n                        value: e.target.value.replace(config.rephrasesymbol, ''),\n                    }\n                );\n            }\n            if (e.target.closest(Selectors.deepl.glossaryId)) {\n                // Triggered by the glossary drop down.\n                UI.toggleGlossaryDetails(Settings.getValue(Selectors.deepl.glossaryId));\n            }\n            /**\n             * *************************************\n             ** Filters\n             **************************************\n             */\n            clearTimeout(filterTimeout);\n            filterTimeout = setTimeout(() => {\n                if (e.target.closest(Selectors.actions.showUpdated)) {\n                    UI.debouncedShowRows();\n                }\n                if (e.target.closest(Selectors.actions.showNeedUpdate)) {\n                    UI.debouncedShowRows();\n                }\n                if (e.target.closest(Selectors.actions.showHidden)) {\n                    UI.debouncedShowRows();\n                }\n            }, 30);\n            if (e.target.closest(Selectors.actions.sectionSwitcher)) {\n                // Triggered by the course section dropdown\n                Utils.switchLocation(\n                    {\n                        key: 'section_id',\n                        value: e.target.value,\n                    }, 'activity_id'\n                );\n            }\n            if (e.target.closest(Selectors.actions.moduleSwitcher)) {\n                // Triggered by the course module/activity dropdown\n                Utils.switchLocation(\n                    {\n                        key: 'activity_id',\n                        value: e.target.value,\n                    }\n                );\n            }\n            /**\n             ************************************** Row events.\n             */\n            const rowContainer = e.target.closest('[data-row-id]');\n            if (rowContainer) {\n                const key = rowContainer.getAttribute('data-row-id');\n                switch (e.target.getAttribute('data-action')) {\n                    case Selectors.actions.checkBoxes :\n                        onItemChecked(rowContainer, e.target.checked);\n                        break;\n                    case Selectors.actions.sourceselect:\n                        Translation.updateTempSourceLang(key, e.target.value);\n                        break;\n                }\n            }\n/*            If (e.target.closest(Selectors.actions.checkBoxes)) {\n                onItemChecked(e);\n            }\n            if (e.target.closest(Selectors.actions.sourceselect)) {\n                onSourceChange(e);\n            }*/\n/*\n            if (e.target.closest(Selectors.deepl.glossaryId)) {\n                UI.toggleGlossaryDetails(Settings.getValue(Selectors.deepl.glossaryId));\n            }\n*/\n\n        };\n        /**\n         * Launch deepl services.\n         */\n        const callDeeplServices = () => {\n            UI.launchTranslatingModal();\n            const keys = [];\n            const [cookie, settings] = Settings.prepareSettingsAndCookieValues();\n            // UI.saveAllBtn.disabled = false;\n            UI.disableSaveButton();\n            UI.formQueryAll(Selectors.statuses.checkedCheckBoxes)\n                .forEach((ckBox) => {\n                    const row = ckBox.closest(Selectors.actions.corerowid);\n                    const key = row.getAttribute(\"data-key\");\n                    const sourceText = UI.formQuery(Selectors.sourcetexts.singlelangkeys, key, row);\n                    const editor = UI.findEditor(key);\n                    Translation.initTempForKey(\n                        key, editor,\n                        sourceText.getAttribute(\"data-sourcetext-raw\"),\n                        sourceText.getAttribute(\"data-filedtext-raw\"),\n                        UI.formQuery(Selectors.sourcetexts.sourcelangdd, key, row).value\n                    );\n                    keys.push(key);\n                });\n            const newCookiename = Utils.COOKIE_PREFIX_NEW + config.currentlang + config.targetlang + config.courseid;\n            Utils.setEncodedCookie(newCookiename, JSON.stringify(cookie), config.cookieduration);\n            Translation.callTranslations(keys, config, settings);\n        };\n        /**\n         * Event Listener when DeepL API call failed.\n         * @param {string} error\n         */\n        const onTranslationFailed = (error) => {\n            UI.disableTranslateButton();\n            onTranslationDone();\n            UI.deeplErrorModal(error);\n        };\n        /**\n         * Event Listener when DeepL API call finished.\n         */\n        const onTranslationDone = () => {\n            // UI.saveAllBtn.disabled = false;\n            UI.disableTranslateButton();\n            UI.enableSaveButton();\n            UI.hideModal();\n        };\n        /**\n         * Event listener for the translations process to dispaly the status.\n         *\n         * @param {string} key\n         */\n        const onItemTranslated = (key) => {\n            // Add saved indicator.\n            UI.setIconStatus(key, Selectors.process.tosave, true);\n        };\n        /**\n         * Displays error message and icon.\n         *\n         * @param {string} key\n         * @param {string} error\n         */\n        const onErrorMessageItem = (key, error) => {\n            Log.warn(`ui/errorMessageItem`);\n            Log.warn(key);\n            Log.warn(error);\n            const editor = UI.formQuery(Selectors.editors.multiples.editorsWithKey, key);\n            editor.classList.add(\"local_deepler__error\");\n            UI.setIconStatus(key, Selectors.process.failed);\n            UI.showErrorMessageForEditor(key, error);\n        };\n        /**\n         * Listener for individual source change.\n         * @todo MDL-000 implement in v1.4.0\n         * @param {string} key\n         * @param {string} sourceLang\n         */\n        // eslint-disable-next-line no-unused-vars\n        const onSourceChange = (key, sourceLang) => {\n            Translation.updateTempSourceLang(key, sourceLang);\n            // Do check source and target and propose rephrase if PRO.\n            Log.info('source changed');\n            Log.info(key);\n        };\n        /**\n         * Event listener for selection checkboxes.\n         * @param {HTMLElement} row\n         * @param {boolean} checked\n         */\n        const onItemChecked = (row, checked) => {\n            // Check/uncheck checkboxes changes the charcount and icon status.\n            UI.toggleStatus(row, checked);\n            UI.countWordAndChar();\n            UI.toggleAutotranslateButton();\n        };\n       /* Const onItemChecked = (e) => {\n            // Check/uncheck checkboxes changes the charcount and icon status.\n            if (e.target.getAttribute('data-action') === \"local_deepler/checkbox\") {\n                const key = e.target.getAttribute('data-key');\n                UI.toggleStatus(key, e.target.checked, Translation.translated(key));\n                UI.countWordAndChar();\n            }\n        };*/\n        /**\n         * When a main error with the DB occurs.\n         *\n         * @param {string} error\n         * @param {int} status\n         */\n        const onDBFailed = (error, status) => {\n            UI.hideModal();\n            UI.dbErrorModal(error, status);\n        };\n        /**\n         *\n         * @param {array} errors\n         */\n        const onDbSavedSuccess = (errors) => {\n            UI.hideModal();\n            if (errors.length > 0) {\n                UI.dbErrorPartialModal(errors.length);\n            }\n        };\n\n        /**\n         * Multilang button handler\n         *\n         * @param {HTMLElement} row\n         * @param {string} key\n         */\n        const onToggleMultilang = (row, key) => {\n            // Window.console.log(e);\n            // const row = e.target.closest(Selectors.actions.corerowid);\n            // Let keyid = e.getAttribute('aria-controls');\n            // let key = Utils.keyidToKey(keyid);\n            //  let key = row.getAttribute('data-row-id');\n            if (key === null) {\n                Log.error(`KEY ${key} BAD FORMAT should be TABLE-ID-FIELD-CMID`);\n            } else {\n                let sourceText = UI.formQuery(Selectors.sourcetexts.singlelang, '', row);\n                let multilangText = UI.formQuery(Selectors.sourcetexts.multilangs, ',', row);\n                sourceText.classList.toggle(\"show\");\n                multilangText.classList.toggle(\"show\");\n            }\n        };\n        const onGlossaryDbAllfailed = (obj)=> {\n            Log.info('onGlossaryDbAllfailed');\n            Log.error(obj);\n        };\n\n        const onGlossaryDbfailed = (obj)=> {\n            Log.info('onGlossaryDbfailed');\n            Log.error(obj);\n        };\n\n        const onGlossaryDbSuccess = (obj)=> {\n            Log.info('onGlossaryDbSuccess');\n            Log.info(obj);\n        };\n        /**\n         * Displays success message and icon.\n         *\n         * @param {String} key\n         * @param {string} savedText\n         */\n        const onSuccessMessageItem = (key, savedText) => {\n            UI.formQuery(Selectors.editors.multiples.editorsWithKey, key)\n                .classList.add(\"local_deepler__success\");\n            // Add saved indicator.\n            UI.setIconStatus(key, Selectors.process.success, Translation.translated(key));\n            // Replace text in the multilang textarea.\n            const multilangTextarea = UI.formQuery(Selectors.editors.multiples.textAreas, key);\n            multilangTextarea.innerHTML = savedText;\n            // Deselect the checkbox.\n            UI.formQuery(Selectors.editors.multiples.checkBoxesWithKey, key).checked = false;\n            // Remove success message after a few seconds.\n            setTimeout(() => {\n                let multilangPill = UI.formQuery(Selectors.statuses.multilang, key);\n                let prevTransStatus = UI.formQuery(Selectors.statuses.prevTransStatus, key);\n                prevTransStatus.classList = \"badge badge-pill badge-success\";\n                if (multilangPill.classList.contains(\"disabled\")) {\n                    multilangPill.classList.remove('disabled');\n                }\n                UI.setIconStatus(key, Selectors.process.saved, Translation.translated(key));\n            });\n        };\n        /**\n         * @returns void\n         */\n        const saveTranslations = () => {\n            const selectedCheckboxes = UI.formQueryAll(Selectors.statuses.checkedCheckBoxes);\n            if (selectedCheckboxes.length === 0) {\n                return;\n            }\n            // Prepare the UI for the save process.\n            UI.disableSaveButton();\n            UI.launchSaveAllModal();\n            // Prepare the data to be saved.\n            const data = [];\n            /* Const keys = Array.from(selectedCheckboxes).map((e) => e.dataset.key);\n            keys.forEach((key) => {\n                    // @todo MDL-0000: should not rely on UI (add a flag in temptranslations object) .\n                    if (UI.getIconStatus(key) === Selectors.statuses.tosave) {\n                        UI.hideErrorMessage(key);\n                        const dbItem = UI.prepareDBitem(key, Selectors.editors.multiples.editorsWithKey, config.courseid);\n                        data.push(dbItem);\n                    }\n                }\n            );*/\n            selectedCheckboxes.forEach(\n                (ck)=>{\n                    // Const key = container.getAttribute('data-row-id');\n                    const row = ck.closest(Selectors.actions.corerowid);\n                    UI.hideErrorMessageForRow(row);\n                    data.push(UI.prepareRowForDB(row, config.courseid));\n                }\n            );\n            Translation.saveTranslations(data, mainEditorIsTextArea);\n        };\n    /**\n     * Saving a single translation to DB.\n     * @param {HTMLElement} row\n     */\n    const saveSingleTranslation = (row)=> {\n        UI.hideErrorMessageForRow(row);\n        const dbItem = UI.prepareRowForDB(row, config.courseid);\n        Translation.saveTranslations([dbItem], mainEditorIsTextArea);\n        // Const key = row.getAttribute('data-row-id');\n        // UI.hideErrorMessage(key);\n        // Const key = e.target.closest(Selectors.actions.validatorsBtns).dataset.keyValidator;\n        /* if (UI.getIconStatus(key) === Selectors.statuses.tosave) {\n            UI.hideErrorMessage(key);\n            const dbItem = Utils.prepareDBitem(key, Selectors.editors.multiples.editorsWithKey, config.courseid);\n            Translation.saveTranslations([dbItem], config.userPrefs === 'textarea');\n        }*/\n    };\n    /**\n     * Init.\n     *\n     * @param {object} cfg\n     */\n    const init = (cfg) => {\n        config = cfg;\n        mainEditorIsTextArea = config.userPrefs === 'textarea';\n        registerEventListeners();\n    };\n    return {\n        init: init\n    };\n});\n"],"names":["define","Log","Utils","Translation","Api","Events","Selectors","UI","Settings","filterTimeout","mainEditorIsTextArea","config","handleFocusEvent","e","target","closest","editors","targetarea","wrapTinyOnTarget","handleClickEvent","actions","autoTranslateBtn","callDeeplServices","selectAllBtn","toggleAllCheckboxes","checked","updatTempStatusAll","process","totranslate","wait","tothetop","backToBase","glossary","entriesviewerPage","info","getValue","deepl","glossaryId","getGlossariesEntries","deeplsourcelang","targetlang","rowContainer","toggleMultilang","onToggleMultilang","validatorsBtns","getAttribute","tosave","saveSingleTranslation","saveAll","saveTranslations","handleChangeEvent","escapeLatex","escapePre","hideiframes","doHideiframes","targetSwitcher","switchLocation","key","value","replace","rephrasesymbol","toggleGlossaryDetails","clearTimeout","setTimeout","showUpdated","debouncedShowRows","showNeedUpdate","showHidden","sectionSwitcher","moduleSwitcher","checkBoxes","onItemChecked","sourceselect","updateTempSourceLang","launchTranslatingModal","keys","cookie","settings","prepareSettingsAndCookieValues","disableSaveButton","formQueryAll","statuses","checkedCheckBoxes","forEach","ckBox","row","corerowid","sourceText","formQuery","sourcetexts","singlelangkeys","editor","findEditor","initTempForKey","sourcelangdd","push","newCookiename","COOKIE_PREFIX_NEW","currentlang","courseid","setEncodedCookie","JSON","stringify","cookieduration","callTranslations","onTranslationFailed","error","disableTranslateButton","onTranslationDone","deeplErrorModal","enableSaveButton","hideModal","onItemTranslated","setIconStatus","onErrorMessageItem","warn","multiples","editorsWithKey","classList","add","failed","showErrorMessageForEditor","toggleStatus","countWordAndChar","toggleAutotranslateButton","onDBFailed","status","dbErrorModal","onDbSavedSuccess","errors","length","dbErrorPartialModal","singlelang","multilangText","multilangs","toggle","onGlossaryDbAllfailed","obj","onGlossaryDbfailed","onGlossaryDbSuccess","onSuccessMessageItem","savedText","success","translated","textAreas","innerHTML","checkBoxesWithKey","multilangPill","multilang","prevTransStatus","contains","remove","saved","selectedCheckboxes","launchSaveAllModal","data","ck","hideErrorMessageForRow","prepareRowForDB","dbItem","init","cfg","userPrefs","document","addEventListener","on","ON_ITEM_TRANSLATED","ON_TRANSLATION_FAILED","ON_TRANSLATION_DONE","ON_REPHRASE_FAILED","ON_DB_SAVE_SUCCESS","ON_DB_FAILED","ON_ITEM_SAVED","ON_ITEM_NOT_SAVED","GLOSSARY_DB_ALL_FAILED","GLOSSARY_DB_FAILED","GLOSSARY_DB_SUCCESS","GLOSSARY_ENTRIES_SUCCESS","showEntriesModal","GLOSSARY_ENTRIES_FAILED"],"mappings":"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"}