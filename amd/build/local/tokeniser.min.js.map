{"version":3,"file":"tokeniser.min.js","sources":["../../src/local/tokeniser.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/*\n * @module     local_deepler/deepler\n * @copyright  2024 Bruno Baudry <bruno.baudry@bfh.ch>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([], () => {\n    /**\n     * @type {[{regex: RegExp, type: string},{regex: RegExp, type: string}]}\n     */\n    const patterns = [\n        {regex: /<pre\\b[^>]*>(.*?)<\\/pre>/gs, type: 'PRETAG'}, // Pre HTML.\n        {regex: /\\$\\$.*?\\$\\$/g, type: 'LATEX'} // Display math.\n    ];\n\n\n    /**\n     * Function to replace expressions with tokens.\n     * @param {String} text\n     * @param {Object} escapePatterns\n     * @returns {Object} {{expressions: *[], tokenizedText}}\n     */\n    const preprocess = (text, escapePatterns) => {\n        const expressions = [];\n        let tokenizedText = text;\n\n        // Patterns for different environments.\n        // Replace each expression with a token.\n        patterns.forEach(pattern => {\n            if (escapePatterns[pattern.type]) {\n                tokenizedText = tokenizedText.replace(pattern.regex, match => {\n                    const token = `__${pattern.type}_${expressions.length}__`;\n                    expressions.push({token: token, expression: match});\n                    return token;\n                });\n            }\n        });\n\n        return {tokenizedText, expressions: expressions};\n    };\n\n    /**\n     * Function to replace tokens with original expressions.\n     * @param {String} text\n     * @param {Array} expressions\n     * @returns {String}\n     */\n    const postprocess = (text, expressions) => {\n        expressions.forEach((expr) => {\n            const token = new RegExp(expr.token, 'g');\n            text = text.replace(token, escapeReplacementString(expr.expression));\n        });\n        return text;\n    };\n\n    /**\n     * Escape LaTeX tags.\n     * @param {String} str\n     * @returns {String}\n     */\n    const escapeReplacementString = (str) => {\n        return str.replace(/\\$/g, '$$$$');\n    };\n    return {\n        postprocess: postprocess,\n        preprocess: preprocess\n    };\n});\n"],"names":["define","patterns","regex","type","escapeReplacementString","str","replace","postprocess","text","expressions","forEach","expr","token","RegExp","expression","preprocess","escapePatterns","tokenizedText","pattern","match","length","push"],"mappings":";;;;;AAoBAA,uCAAO,IAAI,WAIDC,SAAW,CACb,CAACC,MAAO,6BAA8BC,KAAM,UAC5C,CAACD,MAAO,eAAgBC,KAAM,UAgD5BC,wBAA2BC,KACtBA,IAAIC,QAAQ,MAAO,cAEvB,CACHC,YAjBgB,CAACC,KAAMC,eACvBA,YAAYC,SAASC,aACXC,MAAQ,IAAIC,OAAOF,KAAKC,MAAO,KACrCJ,KAAOA,KAAKF,QAAQM,MAAOR,wBAAwBO,KAAKG,gBAErDN,MAaPO,WA3Ce,CAACP,KAAMQ,wBAChBP,YAAc,OAChBQ,cAAgBT,YAIpBP,SAASS,SAAQQ,UACTF,eAAeE,QAAQf,QACvBc,cAAgBA,cAAcX,QAAQY,QAAQhB,OAAOiB,cAC3CP,MAAS,KAAIM,QAAQf,QAAQM,YAAYW,kBAC/CX,YAAYY,KAAK,CAACT,MAAOA,MAAOE,WAAYK,QACrCP,aAKZ,CAACK,cAAAA,cAAeR,YAAaA"}