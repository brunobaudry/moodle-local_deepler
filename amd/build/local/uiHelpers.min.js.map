{"version":3,"file":"uiHelpers.min.js","sources":["../../src/local/uiHelpers.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n *  description here.\n *\n * @module     'local_deepler'; // Full name of the plugin (used for diagnostics)./local/uiHelpers\n * @copyright  2025 Bruno Baudry <bruno.baudry@bfh.ch>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['core/modal',\n    'core/log',\n    'editor_tiny/loader',\n    'editor_tiny/editor',\n    './utils',\n    './selectors',\n    './customevents',\n    './translation'\n    ], (\n        Modal,\n        Log,\n        TinyMCEinit,\n        TinyMCE,\n        Utils,\n        Selectors,\n        Events,\n        Translation)=>{\n    let config = {};\n    let format = new Intl.NumberFormat();\n    let autotranslateButton = {};\n    let saveAllBtn = {};\n    let saveAllModal = {};\n    let langstrings = {};\n    let selectAllBtn = {};\n    let removedIframes = [];\n    let allDataFormatOne = [];\n    let checkboxes = [];\n    let glossaryDetailViewr;\n    const optionsForTiny = {\n        subdirs: false,\n        maxbytes: 10240,\n        maxfiles: 0,\n        noclean: true,\n        trusttext: true,\n        // eslint-disable-next-line camelcase\n        enable_filemanagement: false,\n        autosave: false,\n        removeorphaneddrafts: true,\n        plugins: []\n    };\n    const ON_STATUS_CHANGED = 'onStatusChanged';\n    // Cached DOM elements\n    const cachedSelectors = {\n        wordCount: document.querySelector(Selectors.statuses.wordcount),\n        charWithSpace: document.querySelector(Selectors.statuses.charNumWithSpace),\n        charWOSpace: document.querySelector(Selectors.statuses.charNumWithOutSpace),\n        deeplUseSpan: document.querySelector(Selectors.statuses.deeplUsage),\n        deeplMaxSpan: document.querySelector(Selectors.statuses.deeplMax),\n        deeplStatusContainer: document.querySelector(Selectors.statuses.deeplStatusContainer)\n    };\n    /**\n     * Toggle iFrames in sourcetexts.\n     */\n    function doHideiframes() {\n        const isChecked = Utils.domQuery(Selectors.actions.hideiframes);\n        const allIframes = Utils.domQueryAll(Selectors.sourcetexts.iframes);\n        if (!isChecked && allIframes.length > 0) {\n            removedIframes = [];\n            allIframes.forEach(iframe => {\n                removedIframes.push({\n                    parent: iframe.parentNode,\n                    nextSibling: iframe.nextSibling,\n                    html: iframe.outerHTML\n                });\n                iframe.remove();\n            });\n        } else if (removedIframes.length > 0) {\n            // Restore all previously removed iframes.\n            removedIframes.forEach(info => {\n                // Create a new element from the stored HTML.\n                const tempDiv = document.createElement('div');\n                tempDiv.innerHTML = info.html;\n                const newIframe = tempDiv.firstChild;\n                // Insert it back into the DOM\n                if (info.nextSibling) {\n                    info.parent.insertBefore(newIframe, info.nextSibling);\n                } else {\n                    info.parent.appendChild(newIframe);\n                }\n            });\n            removedIframes = [];\n        }\n    }\n    /**\n     * Get the editor container based on recieved current user's editor preference.\n     *\n     * @param {string} key Translation Key\n     */\n    const findEditor = (key) => {\n        let e = Utils.domQuery(Selectors.editors.types.basic, key);\n        let et = 'basic';\n        if (e === null) {\n            let r = null;\n            let editorTab = [\"atto\", \"tiny\", \"marklar\", \"textarea\"];\n            if (editorTab.indexOf(config.userPrefs) === -1) {\n                Log.warn('Unsupported editor ' + config.userPrefs);\n            } else {\n                // First let's try the current editor.\n                try {\n                    r = findEditorByType(key, config.userPrefs);\n                } catch (error) {\n                    // Content was edited by another editor.\n                    Log.trace(`Editor not found: ${config.userPrefs} for key ${key}`);\n                }\n            }\n            return r;\n        } else {\n            return {editor: e, editorType: et};\n        }\n    };\n    /**\n     * @param {string} key\n     * @param {object} editorType\n     * @returns {{editor: object, editorType: string}}\n     */\n    const findEditorByType = (key, editorType) => {\n        let et = 'basic';\n        let ed = null;\n        switch (editorType) {\n            case \"atto\" :\n                et = 'iframe';\n                ed = Utils.domQuery(Selectors.editors.types.atto, key);\n                break;\n            case \"tiny\":\n                et = 'iframe';\n                ed = findTinyInstanceByKey(key);\n                break;\n            case 'marklar':\n            case \"textarea\" :\n                ed = Utils.domQuery(Selectors.editors.types.other, key);\n                break;\n        }\n        return {editor: ed, editorType: et};\n    };\n    /**\n     * Finds TinyMCE instance.\n     * @param {string} key\n     * @returns {Node}\n     */\n    const findTinyInstanceByKey = (key)=> {\n        let editor = null;\n        TinyMCE.getAllInstances().every((k, v)=>{\n            if (v.attributes.name.value.indexOf(key) === 0) {\n                editor = k.getBody();\n                return false;\n            }\n            return true;\n        });\n        return editor;\n    };\n    /**\n     * Hides an item's error message.\n     *\n     * @param {String} key\n     */\n    const hideErrorMessage = (key) => {\n        let parent = Utils.domQuery(Selectors.editors.multiples.editorsWithKey, key);\n        let alertChild = Utils.domQuery('.alert-danger', '', parent);\n        if (alertChild) {\n            parent.removeChild(alertChild);\n        }\n    };\n    /**\n     * Display an error message attached to the item's editor.\n     * @param {String} key\n     * @param {String} message\n     */\n    const showErrorMessageForEditor = (key, message) => {\n        let parent = Utils.domQuery(Selectors.editors.multiples.editorsWithKey, key);\n        const errorMsg = document.createElement('div');\n        const indexOfSET = message.indexOf(\"Data too long\");// Probably a text too long for the field if not -1.\n        // Display granular error messages.\n        if (indexOfSET > -1) {\n            message = message.substring(0, message.indexOf('WHERE id=?'));\n            message = message + ' ' + langstrings.uistrings.errortoolong;\n        }\n        errorMsg.id = 'local_deepler__errormsg';\n        errorMsg.classList = ['alert alert-danger'];\n        errorMsg.innerHTML = message;\n        parent.appendChild(errorMsg);\n    };\n    const showEntriesModal = (ajaxResponse)=>{\n        const glossaryid = ajaxResponse.glossaryid;\n        const entries = JSON.parse(ajaxResponse.entries);\n        const status = ajaxResponse.status;\n        const message = ajaxResponse.message;\n        if (status === 'success') {\n            const table = document.createElement('table');\n            table.className = 'generaltable';\n            // Create the header.\n            const thead = document.createElement('thead');\n            thead.innerHTML = `<tr><th>${ajaxResponse.source.toUpperCase()}</th>\n                <th>${ajaxResponse.target.toUpperCase()}</th></tr>`;\n            table.appendChild(thead);\n\n            const tbody = document.createElement('tbody');\n\n            Object.entries(entries).forEach(([key, value]) => {\n                const row = document.createElement('tr');\n                row.innerHTML = `<td>${key}</td><td>${value}</td>`;\n                tbody.appendChild(row);\n            });\n\n            table.appendChild(tbody);\n\n            Modal.create({\n                title: 'Entries',\n                body: table,\n                type: 'default',\n                show: true,\n                removeOnClose: true,\n            });\n        } else {\n            Modal.create({\n                title: `Error fetching entries for<br/><em>${glossaryid}</em>`,\n                body: message,\n                type: 'default',\n                show: true,\n                removeOnClose: true,\n            });\n        }\n    };\n    /**\n     * Launch, display count of Words And Chars.\n     */\n    const countWordAndChar = () => {\n        let wrdsc = 0,\n            cws = 0,\n            cwos = 0;\n\n        // Cache checkboxes matching selector once, convert to array if needed.\n        const checkedBoxes = Array.from(Utils.domQueryAll(Selectors.statuses.checkedCheckBoxes));\n\n        // Aggregate counts in one loop.\n        checkedBoxes.forEach(ckBox => {\n            const key = ckBox.getAttribute(\"data-key\");\n            const results = getCount(key);\n            wrdsc += results.wordCount;\n            cws += results.charNumWithSpace;\n            cwos += results.charNumWithOutSpace;\n        });\n\n        // Cache DOM elements once for output instead of querying repeatedly.\n        const wordCount = cachedSelectors.wordCount;\n        const charWithSpace = cachedSelectors.charWithSpace;\n        const charWOSpace = cachedSelectors.charWOSpace;\n        const deeplUseSpan = cachedSelectors.deeplUseSpan;\n        const deeplMaxSpan = cachedSelectors.deeplMaxSpan;\n        const parent = cachedSelectors.deeplStatusContainer;\n\n        // Calculate current usage once.\n        const current = cws + config.usage.character.count;\n\n        // Update UI in one batch (minimizes layout thrashing).\n        wordCount.innerText = wrdsc;\n        charWithSpace.innerText = cws;\n        charWOSpace.innerText = cwos;\n        deeplUseSpan.innerText = format.format(current);\n        deeplMaxSpan.innerText = config.usage.character.limit === null ? 'âˆž' : format.format(config.usage.character.limit);\n\n        // Toggle classes efficiently.\n        parent.classList.toggle('alert-success', current < config.usage.character.limit || config.usage.character.limit === null);\n        parent.classList.toggle('alert-danger', current >= config.usage.character.limit && config.usage.character.limit !== null);\n    };\n    /**\n     * Compile the needed counts for info.\n     *\n     * @param {string} key\n     * @returns {{wordCount: *, charNumWithSpace: *, charNumWithOutSpace: *}}\n     */\n    const getCount = (key) => {\n        const item = Utils.domQuery(Selectors.sourcetexts.keys, key);\n        const raw = item.getAttribute(\"data-sourcetext-raw\");\n        // Cleaned sourceText.\n        const trimmedVal = Utils.stripHTMLTags(Utils.fromBase64(raw)).trim();\n        return {\n            \"wordCount\": (trimmedVal.match(/\\S+/g) || []).length,\n            \"charNumWithSpace\": trimmedVal.length,\n            \"charNumWithOutSpace\": trimmedVal.replace(/\\s+/g, '').length\n        };\n    };\n    /**\n     * Factory to display process' statuses for each item.\n     *\n     * @param {String} key\n     * @param {Boolean} checked\n     * @param {Boolean} translated\n     */\n    const toggleStatus = (key, checked, translated) => {\n        const status = Utils.domQuery(Selectors.actions.validatorBtn, key).dataset.status;\n        switch (status) {\n            case Selectors.statuses.wait :\n                Events.emit(ON_STATUS_CHANGED, key);\n                if (checked) {\n                    setIconStatus(key, Selectors.statuses.totranslate);\n                }\n                break;\n            case Selectors.statuses.totranslate :\n                // If (checked && Translation.translated[key]) {\n                if (checked && translated) {\n                    setIconStatus(key, Selectors.statuses.tosave, true);\n                } else {\n                    setIconStatus(key, Selectors.statuses.wait);\n                }\n                break;\n            case Selectors.statuses.tosave :\n                if (!checked) {\n                    setIconStatus(key, Selectors.statuses.totranslate);\n                }\n                break;\n            case Selectors.statuses.failed :\n                if (checked) {\n                    setIconStatus(key, Selectors.statuses.totranslate);\n                }\n                break;\n            case Selectors.statuses.success :\n                break;\n            case Selectors.statuses.saved :\n                if (checked) {\n                    setIconStatus(key, Selectors.statuses.totranslate);\n                }\n                Events.emit(ON_STATUS_CHANGED, key);\n\n                break;\n        }\n    };\n    /**\n     * Get the translation row status icon.\n     *\n     * @param {string} key\n     * @returns {*}\n     */\n    const getIconStatus = (key)=> {\n        return Utils.domQuery(Selectors.actions.validatorBtn, key).getAttribute('data-status');\n    };\n    /**\n     * Change translation process status icon.\n     *\n     * @param {string} key\n     * @param {string} status\n     * @param {boolean} isBtn\n     */\n    const setIconStatus = (key, status = Selectors.statuses.wait, isBtn = false) => {\n        let icon = Utils.domQuery(Selectors.actions.validatorBtn, key);\n        if (!isBtn) {\n            if (!icon.classList.contains('disable')) {\n                icon.classList.add('disable');\n            }\n            if (icon.classList.contains('btn')) {\n                icon.classList.remove('btn');\n                icon.classList.remove('btn-outline-secondary');\n            }\n        } else {\n            if (!icon.classList.contains('btn')) {\n                icon.classList.add('btn');\n                icon.classList.add('btn-outline-secondary');\n            }\n            if (icon.classList.contains('disable')) {\n                icon.classList.remove('disable');\n            }\n        }\n        icon.setAttribute('role', isBtn ? 'button' : 'status');\n        icon.setAttribute('data-status', status);\n        icon.setAttribute('title', langstrings.statusstrings[status.replace('local_deepler/', '')]);\n    };\n    /**\n     * Opens a modal infobox to warn user trunks of fields are saving.\n     * @param {object} messageObject\n     * @returns {Promise<void>}\n     */\n    const launchModal = async(messageObject) => {\n        saveAllModal = await Modal.create(messageObject);\n        await saveAllModal.show();\n    };\n    const launchTranslatingModal = ()=>{\n        launchModal(\n            {\n                title: langstrings.uistrings.translatemodaltitle,\n                body: langstrings.uistrings.translatemodalbody,\n            }\n        );\n    };\n    const launchSaveAllModal = ()=>{\n        launchModal(\n            {\n                title: langstrings.uistrings.saveallmodaltitle,\n                body: langstrings.uistrings.saveallmodalbody,\n            }\n        ).then(r => Log.info('SaveAll Modal launched ' + r)).catch((reason)=>{\n            Log.error(reason);\n        });\n    };\n    const dbErrorPartialModal = (stringVar)=>{\n        const body = langstrings.uistrings.errordbpartial.replace('{$a}', stringVar);\n        dbErrorModal(body);\n    };\n    const dbErrorModal = (body, titleSuffix = '')=>{\n        let title = langstrings.uistrings.errordbtitle;\n        if (titleSuffix !== '') {\n            title += titleSuffix;\n        }\n        presentDialogModal(title, body, 'alert');\n    };\n    const deeplErrorModal = (body)=>{\n        presentDialogModal(langstrings.uistrings.deeplapiexception, body, 'Alert');\n    };\n    const presentDialogModal = (title, body, type = 'default') => {\n        Modal.create({\n            title: title,\n            body: body,\n            type: type,\n            show: true,\n            removeOnClose: true,\n        });\n    };\n\n    const hideModal = ()=>{\n        if (saveAllModal !== null && saveAllModal.isVisible) {\n            saveAllModal.hide();\n        }\n    };\n    const backToBase = () => {\n        const offsetTop = Utils.domQuery(Selectors.config.langstrings).offsetTop;\n        window.scrollTo({top: offsetTop - 5, behavior: 'smooth'});\n    };\n    const resizeEditors = ()=>{\n\n        allDataFormatOne.forEach((editable)=>{\n            const key = editable.id.replace('tiny_', '');\n            const selector = `[data-sourcetext-key=\"${key}\"]`;\n            let parent = Utils.domQuery(selector);\n            const grandparent = parent.parentElement;\n\n            const updateEditableHeight = ()=> {\n                const totalHeight = grandparent.offsetHeight + 80; // Tiny header average height is 80.\n                editable.style.height = totalHeight + 'px';\n            };\n\n            // Observe size changes in parent and grandparent.\n            const resizeObserver = new ResizeObserver(() => {\n                updateEditableHeight();\n            });\n\n            resizeObserver.observe(parent);\n            resizeObserver.observe(grandparent);\n\n        });\n    };\n\n\n    /**\n     * Toggle Autotranslate Button\n     */\n    const toggleAutotranslateButton = () => {\n        // Use Array.some() for early exit when a checked checkbox is found\n        autotranslateButton.disabled = !Array.from(checkboxes).some(e => e.checked);\n    };\n\n    /**\n     * Toggle checkboxes\n     * @param {Boolean} checked\n     */\n    const toggleAllCheckboxes = (checked) => {\n\n        const updates = [];\n\n        // Prepare all updates without applying immediately.\n        checkboxes.forEach(checkbox => {\n            // Parent row.\n            const parent = Utils.getParentRow(checkbox, Selectors.sourcetexts.parentrow);\n            // If the row is checked, verifiy that the parent is not hidden else do not select.\n            const shouldCheck = checked ? !parent.classList.contains('d-none') : false;\n            if (checkbox.checked !== shouldCheck) {\n                updates.push({checkbox, shouldCheck});\n            }\n        });\n\n        // Apply updates in the next animation frame, batching DOM writes.\n        requestAnimationFrame(() => {\n            updates.forEach(({checkbox, shouldCheck}) => {\n                checkbox.checked = shouldCheck;\n                const key = checkbox.getAttribute('data-key');\n                toggleStatus(key, shouldCheck, Translation.translated(key));\n            });\n\n            toggleAutotranslateButton();\n            countWordAndChar();\n        });\n    };\n    const toggleGlossaryDetails = (glossaryId)=> {\n        if (glossaryId !== '') {\n            glossaryDetailViewr.style.display = 'block';\n        } else {\n            glossaryDetailViewr.style.display = 'none';\n        }\n    };\n    /**\n     * Wrap debounce for displaying rows.\n     * @type {(function(...[*]): void)|*}\n     */\n    const debouncedShowRows = Utils.debounce(() => {\n        showRows();\n    }, 100);\n    /**\n     * Shows/hides rows.\n     */\n    const showRows = () => {\n        // Map each selector to its corresponding checkbox checked state\n        const selectorMap = {\n            [Selectors.statuses.updated]: Utils.domQuery(Selectors.actions.showUpdated).checked,\n            [Selectors.statuses.needsupdate]: Utils.domQuery(Selectors.actions.showNeedUpdate).checked,\n            [Selectors.statuses.hidden]: Utils.domQuery(Selectors.actions.showHidden).checked\n        };\n\n        // Combine all selectors into one comma-separated string for batch querying.\n        const mergedSelector = Object.keys(selectorMap).join(\",\");\n\n        // Query all items matching any of the selectors once.\n        const allItems = Utils.domQueryAll(mergedSelector);\n\n        // Cache the global \"select all\" button checked state once.\n        const allSelected = Utils.domQuery(Selectors.actions.selectAllBtn).checked;\n\n        allItems.forEach(item => {\n            // Determine which selector this item matches so we can apply the right checkbox state.\n            let shouldShow = false;\n            let shouldCheck = false;\n            for (const [selector, checked] of Object.entries(selectorMap)) {\n                if (item.matches(selector)) {\n                    shouldShow = checked;\n                    shouldCheck = allSelected && checked;\n                    break;\n                }\n            }\n\n            // Show or hide item based on checkbox state.\n            item.classList.toggle(\"d-none\", !shouldShow);\n\n            // Handle checkbox selection for this item or its children.\n            let rowId = item.getAttribute('data-row-id');\n            if (rowId === null) {\n                // For items without row-id, toggle checkboxes of their child rows.\n                const childs = Utils.domQueryAll(Selectors.statuses.hiddenForStudentRows, '', item);\n                childs.forEach(child => {\n                    const childId = child.getAttribute('data-row-id');\n                    toggleChildCheckBoxSelection(childId, shouldCheck);\n                });\n            } else {\n                toggleChildCheckBoxSelection(rowId, shouldCheck);\n            }\n        });\n\n        // Call global UI update functions once\n        toggleAutotranslateButton();\n        countWordAndChar();\n    };\n    /**\n     * Manages selection and icon status of fields.\n     *\n     * @param {string} key\n     * @param {bool} shouldBeChecked\n     */\n    const toggleChildCheckBoxSelection = (key, shouldBeChecked)=>{\n        const single = Utils.domQuery(Selectors.editors.multiples.checkBoxesWithKey, key);\n        single.checked = shouldBeChecked;\n        toggleStatus(key, false, Translation.translated(key));\n    };\n    const wrapTinyOnTarget = (element)=>{\n        const status = getIconStatus(element.id.replace('tiny_', ''));\n        if (status === Selectors.statuses.tosave) {\n            // eslint-disable-next-line promise/catch-or-return\n            TinyMCEinit.getTinyMCE().then(\n                // eslint-disable-next-line promise/always-return\n                ()=>{\n                    // eslint-disable-next-line promise/no-nesting\n                    TinyMCE.setupForTarget(element, optionsForTiny)\n                        // eslint-disable-next-line promise/always-return\n                        .then(()=>{\n                            Log.info('tiny loaded for ' + element.id);\n                        })\n                        .catch((r)=>{\n                            Log.error(r);\n                        });\n                }\n            );\n        }\n    };\n    const registerUI = () => {\n        if (!glossaryDetailViewr && document.querySelector(Selectors.glossary.entriesviewerPage)) {\n            glossaryDetailViewr = document.querySelector(Selectors.glossary.entriesviewerPage);\n        }\n        autotranslateButton = Utils.domQuery(Selectors.actions.autoTranslateBtn);\n        checkboxes = Utils.domQueryAll(Selectors.actions.checkBoxes);\n        allDataFormatOne = Utils.domQueryAll(Selectors.editors.targetarea);\n        selectAllBtn = Utils.domQuery(Selectors.actions.selectAllBtn);\n        saveAllBtn = Utils.domQuery(Selectors.actions.saveAll);\n        langstrings = JSON.parse(Utils.domQuery(Selectors.config.langstrings).getAttribute('data-langstrings'));\n    };\n    const init = (cfg) => {\n        config = cfg;\n        registerUI();\n        // Make the main UI adjustments\n        resizeEditors();\n        doHideiframes();\n        toggleAutotranslateButton();\n        saveAllBtn.disabled = true;\n        selectAllBtn.disabled = config.targetlang === '';\n        checkboxes.forEach((node) => {\n            node.disabled = selectAllBtn.disabled;\n        });\n        debouncedShowRows();\n    };\n    return {\n        ON_STATUS_CHANGED: ON_STATUS_CHANGED,\n        saveAllBtn: saveAllBtn,\n        selectAllBtn: selectAllBtn,\n        backToBase: backToBase,\n        countWordAndChar: countWordAndChar,\n        dbErrorModal: dbErrorModal,\n        dbErrorPartialModal: dbErrorPartialModal,\n        debouncedShowRows: debouncedShowRows,\n        deeplErrorModal: deeplErrorModal,\n        doHideiframes: doHideiframes,\n        findEditor: findEditor,\n        getIconStatus: getIconStatus,\n        hideModal: hideModal,\n        hideErrorMessage: hideErrorMessage,\n        init: init,\n        launchModal: launchModal,\n        launchSaveAllModal: launchSaveAllModal,\n        launchTranslatingModal: launchTranslatingModal,\n        presentDialogModal: presentDialogModal,\n        setIconStatus: setIconStatus,\n        showEntriesModal: showEntriesModal,\n        showErrorMessageForEditor: showErrorMessageForEditor,\n        toggleAllCheckboxes: toggleAllCheckboxes,\n        toggleAutotranslateButton: toggleAutotranslateButton,\n        toggleGlossaryDetails: toggleGlossaryDetails,\n        toggleStatus: toggleStatus,\n        wrapTinyOnTarget: wrapTinyOnTarget\n    };\n});\n"],"names":["define","Modal","Log","TinyMCEinit","TinyMCE","Utils","Selectors","Events","Translation","glossaryDetailViewr","config","format","Intl","NumberFormat","autotranslateButton","saveAllBtn","saveAllModal","langstrings","selectAllBtn","removedIframes","allDataFormatOne","checkboxes","optionsForTiny","subdirs","maxbytes","maxfiles","noclean","trusttext","enable_filemanagement","autosave","removeorphaneddrafts","plugins","cachedSelectors","wordCount","document","querySelector","statuses","wordcount","charWithSpace","charNumWithSpace","charWOSpace","charNumWithOutSpace","deeplUseSpan","deeplUsage","deeplMaxSpan","deeplMax","deeplStatusContainer","doHideiframes","isChecked","domQuery","actions","hideiframes","allIframes","domQueryAll","sourcetexts","iframes","length","forEach","iframe","push","parent","parentNode","nextSibling","html","outerHTML","remove","info","tempDiv","createElement","innerHTML","newIframe","firstChild","insertBefore","appendChild","findEditorByType","key","editorType","et","ed","editors","types","atto","findTinyInstanceByKey","other","editor","getAllInstances","every","k","v","attributes","name","value","indexOf","getBody","countWordAndChar","wrdsc","cws","cwos","Array","from","checkedCheckBoxes","ckBox","getAttribute","results","getCount","current","usage","character","count","innerText","limit","classList","toggle","raw","keys","trimmedVal","stripHTMLTags","fromBase64","trim","match","replace","toggleStatus","checked","translated","validatorBtn","dataset","status","wait","emit","setIconStatus","totranslate","tosave","failed","success","saved","getIconStatus","isBtn","icon","contains","add","setAttribute","statusstrings","launchModal","async","create","messageObject","show","dbErrorModal","body","titleSuffix","title","uistrings","errordbtitle","presentDialogModal","type","removeOnClose","resizeEditors","editable","id","selector","grandparent","parentElement","resizeObserver","ResizeObserver","totalHeight","offsetHeight","style","height","updateEditableHeight","observe","toggleAutotranslateButton","disabled","some","e","debouncedShowRows","debounce","showRows","selectorMap","updated","showUpdated","needsupdate","showNeedUpdate","hidden","showHidden","mergedSelector","Object","join","allItems","allSelected","item","shouldShow","shouldCheck","entries","matches","rowId","hiddenForStudentRows","child","childId","toggleChildCheckBoxSelection","shouldBeChecked","multiples","checkBoxesWithKey","ON_STATUS_CHANGED","backToBase","offsetTop","window","scrollTo","top","behavior","dbErrorPartialModal","stringVar","errordbpartial","deeplErrorModal","deeplapiexception","findEditor","basic","r","userPrefs","warn","error","trace","hideModal","isVisible","hide","hideErrorMessage","editorsWithKey","alertChild","removeChild","init","cfg","glossary","entriesviewerPage","autoTranslateBtn","checkBoxes","targetarea","saveAll","JSON","parse","targetlang","node","launchSaveAllModal","saveallmodaltitle","saveallmodalbody","then","catch","reason","launchTranslatingModal","translatemodaltitle","translatemodalbody","showEntriesModal","ajaxResponse","glossaryid","message","table","className","thead","source","toUpperCase","target","tbody","_ref","row","showErrorMessageForEditor","errorMsg","substring","errortoolong","toggleAllCheckboxes","updates","checkbox","getParentRow","parentrow","requestAnimationFrame","_ref2","toggleGlossaryDetails","glossaryId","display","wrapTinyOnTarget","element","getTinyMCE","setupForTarget"],"mappings":";;;;;;;AAsBAA,uCAAO,CAAC,aACJ,WACA,qBACA,qBACA,UACA,cACA,iBACA,kBACG,CACCC,MACAC,IACAC,YACAC,QACAC,MACAC,UACAC,OACAC,mBAWAC,oBAVAC,OAAS,GACTC,OAAS,IAAIC,KAAKC,aAClBC,oBAAsB,GACtBC,WAAa,GACbC,aAAe,GACfC,YAAc,GACdC,aAAe,GACfC,eAAiB,GACjBC,iBAAmB,GACnBC,WAAa,SAEXC,eAAiB,CACnBC,SAAS,EACTC,SAAU,MACVC,SAAU,EACVC,SAAS,EACTC,WAAW,EAEXC,uBAAuB,EACvBC,UAAU,EACVC,sBAAsB,EACtBC,QAAS,IAIPC,gBAAkB,CACpBC,UAAWC,SAASC,cAAc7B,UAAU8B,SAASC,WACrDC,cAAeJ,SAASC,cAAc7B,UAAU8B,SAASG,kBACzDC,YAAaN,SAASC,cAAc7B,UAAU8B,SAASK,qBACvDC,aAAcR,SAASC,cAAc7B,UAAU8B,SAASO,YACxDC,aAAcV,SAASC,cAAc7B,UAAU8B,SAASS,UACxDC,qBAAsBZ,SAASC,cAAc7B,UAAU8B,SAASU,gCAK3DC,sBACCC,UAAY3C,MAAM4C,SAAS3C,UAAU4C,QAAQC,aAC7CC,WAAa/C,MAAMgD,YAAY/C,UAAUgD,YAAYC,UACtDP,WAAaI,WAAWI,OAAS,GAClCrC,eAAiB,GACjBiC,WAAWK,SAAQC,SACfvC,eAAewC,KAAK,CAChBC,OAAQF,OAAOG,WACfC,YAAaJ,OAAOI,YACpBC,KAAML,OAAOM,YAEjBN,OAAOO,aAEJ9C,eAAeqC,OAAS,IAE/BrC,eAAesC,SAAQS,aAEbC,QAAUjC,SAASkC,cAAc,OACvCD,QAAQE,UAAYH,KAAKH,WACnBO,UAAYH,QAAQI,WAEtBL,KAAKJ,YACLI,KAAKN,OAAOY,aAAaF,UAAWJ,KAAKJ,aAEzCI,KAAKN,OAAOa,YAAYH,cAGhCnD,eAAiB,UAmCnBuD,iBAAmB,CAACC,IAAKC,kBACvBC,GAAK,QACLC,GAAK,YACDF,gBACC,OACDC,GAAK,SACLC,GAAKzE,MAAM4C,SAAS3C,UAAUyE,QAAQC,MAAMC,KAAMN,eAEjD,OACDE,GAAK,SACLC,GAAKI,sBAAsBP,eAE1B,cACA,WACDG,GAAKzE,MAAM4C,SAAS3C,UAAUyE,QAAQC,MAAMG,MAAOR,WAGpD,CAACS,OAAQN,GAAIF,WAAYC,KAO9BK,sBAAyBP,UACvBS,OAAS,YACbhF,QAAQiF,kBAAkBC,OAAM,CAACC,EAAGC,IACa,IAAzCA,EAAEC,WAAWC,KAAKC,MAAMC,QAAQjB,OAChCS,OAASG,EAAEM,WACJ,KAIRT,QA6ELU,iBAAmB,SACjBC,MAAQ,EACRC,IAAM,EACNC,KAAO,EAGUC,MAAMC,KAAK9F,MAAMgD,YAAY/C,UAAU8B,SAASgE,oBAGxD3C,SAAQ4C,cACX1B,IAAM0B,MAAMC,aAAa,YACzBC,QAAUC,SAAS7B,KACzBoB,OAASQ,QAAQtE,UACjB+D,KAAOO,QAAQhE,iBACf0D,MAAQM,QAAQ9D,6BAIdR,UAAYD,gBAAgBC,UAC5BK,cAAgBN,gBAAgBM,cAChCE,YAAcR,gBAAgBQ,YAC9BE,aAAeV,gBAAgBU,aAC/BE,aAAeZ,gBAAgBY,aAC/BgB,OAAS5B,gBAAgBc,qBAGzB2D,QAAUT,IAAMtF,OAAOgG,MAAMC,UAAUC,MAG7C3E,UAAU4E,UAAYd,MACtBzD,cAAcuE,UAAYb,IAC1BxD,YAAYqE,UAAYZ,KACxBvD,aAAamE,UAAYlG,OAAOA,OAAO8F,SACvC7D,aAAaiE,UAA6C,OAAjCnG,OAAOgG,MAAMC,UAAUG,MAAiB,IAAMnG,OAAOA,OAAOD,OAAOgG,MAAMC,UAAUG,OAG5GlD,OAAOmD,UAAUC,OAAO,gBAAiBP,QAAU/F,OAAOgG,MAAMC,UAAUG,OAA0C,OAAjCpG,OAAOgG,MAAMC,UAAUG,OAC1GlD,OAAOmD,UAAUC,OAAO,eAAgBP,SAAW/F,OAAOgG,MAAMC,UAAUG,OAA0C,OAAjCpG,OAAOgG,MAAMC,UAAUG,QAQxGN,SAAY7B,YAERsC,IADO5G,MAAM4C,SAAS3C,UAAUgD,YAAY4D,KAAMvC,KACvC2B,aAAa,uBAExBa,WAAa9G,MAAM+G,cAAc/G,MAAMgH,WAAWJ,MAAMK,aACvD,YACWH,WAAWI,MAAM,SAAW,IAAI/D,wBAC1B2D,WAAW3D,2BACR2D,WAAWK,QAAQ,OAAQ,IAAIhE,SAUxDiE,aAAe,CAAC9C,IAAK+C,QAASC,qBACjBtH,MAAM4C,SAAS3C,UAAU4C,QAAQ0E,aAAcjD,KAAKkD,QAAQC,aAElExH,UAAU8B,SAAS2F,KACpBxH,OAAOyH,KA5PO,kBA4PiBrD,KAC3B+C,SACAO,cAActD,IAAKrE,UAAU8B,SAAS8F,wBAGzC5H,UAAU8B,SAAS8F,YAEhBR,SAAWC,WACXM,cAActD,IAAKrE,UAAU8B,SAAS+F,QAAQ,GAE9CF,cAActD,IAAKrE,UAAU8B,SAAS2F,iBAGzCzH,UAAU8B,SAAS+F,OACfT,SACDO,cAActD,IAAKrE,UAAU8B,SAAS8F,wBAGzC5H,UAAU8B,SAASgG,OAChBV,SACAO,cAActD,IAAKrE,UAAU8B,SAAS8F,wBAGzC5H,UAAU8B,SAASiG,mBAEnB/H,UAAU8B,SAASkG,MAChBZ,SACAO,cAActD,IAAKrE,UAAU8B,SAAS8F,aAE1C3H,OAAOyH,KAzRO,kBAyRiBrD,OAWrC4D,cAAiB5D,KACZtE,MAAM4C,SAAS3C,UAAU4C,QAAQ0E,aAAcjD,KAAK2B,aAAa,eAStE2B,cAAgB,SAACtD,SAAKmD,8DAASxH,UAAU8B,SAAS2F,KAAMS,8DACtDC,KAAOpI,MAAM4C,SAAS3C,UAAU4C,QAAQ0E,aAAcjD,KACrD6D,OASIC,KAAK1B,UAAU2B,SAAS,SACzBD,KAAK1B,UAAU4B,IAAI,OACnBF,KAAK1B,UAAU4B,IAAI,0BAEnBF,KAAK1B,UAAU2B,SAAS,YACxBD,KAAK1B,UAAU9C,OAAO,aAbrBwE,KAAK1B,UAAU2B,SAAS,YACzBD,KAAK1B,UAAU4B,IAAI,WAEnBF,KAAK1B,UAAU2B,SAAS,SACxBD,KAAK1B,UAAU9C,OAAO,OACtBwE,KAAK1B,UAAU9C,OAAO,2BAW9BwE,KAAKG,aAAa,OAAQJ,MAAQ,SAAW,UAC7CC,KAAKG,aAAa,cAAed,QACjCW,KAAKG,aAAa,QAAS3H,YAAY4H,cAAcf,OAAON,QAAQ,iBAAkB,OAOpFsB,YAAcC,MAAAA,gBAChB/H,mBAAqBf,MAAM+I,OAAOC,qBAC5BjI,aAAakI,QAwBjBC,aAAe,SAACC,UAAMC,mEAAc,GAClCC,MAAQrI,YAAYsI,UAAUC,aACd,KAAhBH,cACAC,OAASD,aAEbI,mBAAmBH,MAAOF,KAAM,UAK9BK,mBAAqB,SAACH,MAAOF,UAAMM,4DAAO,UAC5CzJ,MAAM+I,OAAO,CACTM,MAAOA,MACPF,KAAMA,KACNM,KAAMA,KACNR,MAAM,EACNS,eAAe,KAajBC,cAAgB,KAElBxI,iBAAiBqC,SAASoG,iBAChBlF,IAAMkF,SAASC,GAAGtC,QAAQ,QAAS,IACnCuC,yCAAoCpF,cACtCf,OAASvD,MAAM4C,SAAS8G,gBACtBC,YAAcpG,OAAOqG,cAQrBC,eAAiB,IAAIC,gBAAe,KANb,YACnBC,YAAcJ,YAAYK,aAAe,GAC/CR,SAASS,MAAMC,OAASH,YAAc,MAKtCI,MAGJN,eAAeO,QAAQ7G,QACvBsG,eAAeO,QAAQT,iBASzBU,0BAA4B,KAE9B5J,oBAAoB6J,UAAYzE,MAAMC,KAAK9E,YAAYuJ,MAAKC,GAAKA,EAAEnD,WA6CjEoD,kBAAoBzK,MAAM0K,UAAS,KACrCC,aACD,KAIGA,SAAW,WAEPC,YAAc,EACf3K,UAAU8B,SAAS8I,SAAU7K,MAAM4C,SAAS3C,UAAU4C,QAAQiI,aAAazD,SAC3EpH,UAAU8B,SAASgJ,aAAc/K,MAAM4C,SAAS3C,UAAU4C,QAAQmI,gBAAgB3D,SAClFpH,UAAU8B,SAASkJ,QAASjL,MAAM4C,SAAS3C,UAAU4C,QAAQqI,YAAY7D,SAIxE8D,eAAiBC,OAAOvE,KAAK+D,aAAaS,KAAK,KAG/CC,SAAWtL,MAAMgD,YAAYmI,gBAG7BI,YAAcvL,MAAM4C,SAAS3C,UAAU4C,QAAQhC,cAAcwG,QAEnEiE,SAASlI,SAAQoI,WAETC,YAAa,EACbC,aAAc,MACb,MAAOhC,SAAUrC,WAAY+D,OAAOO,QAAQf,gBACzCY,KAAKI,QAAQlC,UAAW,CACxB+B,WAAapE,QACbqE,YAAcH,aAAelE,cAMrCmE,KAAK9E,UAAUC,OAAO,UAAW8E,gBAG7BI,MAAQL,KAAKvF,aAAa,kBAChB,OAAV4F,MAAgB,CAED7L,MAAMgD,YAAY/C,UAAU8B,SAAS+J,qBAAsB,GAAIN,MACvEpI,SAAQ2I,cACLC,QAAUD,MAAM9F,aAAa,eACnCgG,6BAA6BD,QAASN,qBAG1CO,6BAA6BJ,MAAOH,gBAK5CrB,4BACA5E,oBAQEwG,6BAA+B,CAAC3H,IAAK4H,mBACxBlM,MAAM4C,SAAS3C,UAAUyE,QAAQyH,UAAUC,kBAAmB9H,KACtE+C,QAAU6E,gBACjB9E,aAAa9C,KAAK,EAAOnE,YAAYmH,WAAWhD,aA+C7C,CACH+H,kBA7jBsB,kBA8jBtB3L,WAAYA,WACZG,aAAcA,aACdyL,WAnMe,WACTC,UAAYvM,MAAM4C,SAAS3C,UAAUI,OAAOO,aAAa2L,UAC/DC,OAAOC,SAAS,CAACC,IAAKH,UAAY,EAAGI,SAAU,YAkM/ClH,iBAAkBA,iBAClBqD,aAAcA,aACd8D,oBAnOyBC,kBACnB9D,KAAOnI,YAAYsI,UAAU4D,eAAe3F,QAAQ,OAAQ0F,WAClE/D,aAAaC,OAkOb0B,kBAAmBA,kBACnBsC,gBA1NqBhE,OACrBK,mBAAmBxI,YAAYsI,UAAU8D,kBAAmBjE,KAAM,UA0NlErG,cAAeA,cACfuK,WAvhBgB3I,UACZkG,EAAIxK,MAAM4C,SAAS3C,UAAUyE,QAAQC,MAAMuI,MAAO5I,QAE5C,OAANkG,EAAY,KACR2C,EAAI,SAEqC,IAD7B,CAAC,OAAQ,OAAQ,UAAW,YAC9B5H,QAAQlF,OAAO+M,WACzBvN,IAAIwN,KAAK,sBAAwBhN,OAAO+M,oBAIpCD,EAAI9I,iBAAiBC,IAAKjE,OAAO+M,WACnC,MAAOE,OAELzN,IAAI0N,kCAA2BlN,OAAO+M,8BAAqB9I,aAG5D6I,QAEA,CAACpI,OAAQyF,EAAGjG,WAjBd,UAshBT2D,cAAeA,cACfsF,UAjNc,KACO,OAAjB7M,cAAyBA,aAAa8M,WACtC9M,aAAa+M,QAgNjBC,iBAvdsBrJ,UAClBf,OAASvD,MAAM4C,SAAS3C,UAAUyE,QAAQyH,UAAUyB,eAAgBtJ,KACpEuJ,WAAa7N,MAAM4C,SAAS,gBAAiB,GAAIW,QACjDsK,YACAtK,OAAOuK,YAAYD,aAodvBE,KA7BUC,MACV3N,OAAS2N,KAXJ5N,qBAAuByB,SAASC,cAAc7B,UAAUgO,SAASC,qBAClE9N,oBAAsByB,SAASC,cAAc7B,UAAUgO,SAASC,oBAEpEzN,oBAAsBT,MAAM4C,SAAS3C,UAAU4C,QAAQsL,kBACvDnN,WAAahB,MAAMgD,YAAY/C,UAAU4C,QAAQuL,YACjDrN,iBAAmBf,MAAMgD,YAAY/C,UAAUyE,QAAQ2J,YACvDxN,aAAeb,MAAM4C,SAAS3C,UAAU4C,QAAQhC,cAChDH,WAAaV,MAAM4C,SAAS3C,UAAU4C,QAAQyL,SAC9C1N,YAAc2N,KAAKC,MAAMxO,MAAM4C,SAAS3C,UAAUI,OAAOO,aAAaqF,aAAa,qBAMnFsD,gBACA7G,gBACA2H,4BACA3J,WAAW4J,UAAW,EACtBzJ,aAAayJ,SAAiC,KAAtBjK,OAAOoO,WAC/BzN,WAAWoC,SAASsL,OAChBA,KAAKpE,SAAWzJ,aAAayJ,YAEjCG,qBAkBAhC,YAAaA,YACbkG,mBAvPuB,KACvBlG,YACI,CACIQ,MAAOrI,YAAYsI,UAAU0F,kBAC7B7F,KAAMnI,YAAYsI,UAAU2F,mBAElCC,MAAK3B,GAAKtN,IAAIgE,KAAK,0BAA4BsJ,KAAI4B,OAAOC,SACxDnP,IAAIyN,MAAM0B,YAiPdC,uBAhQ2B,KAC3BxG,YACI,CACIQ,MAAOrI,YAAYsI,UAAUgG,oBAC7BnG,KAAMnI,YAAYsI,UAAUiG,sBA6PpC/F,mBAAoBA,mBACpBxB,cAAeA,cACfwH,iBApcsBC,qBAChBC,WAAaD,aAAaC,WAC1B3D,QAAU4C,KAAKC,MAAMa,aAAa1D,SAClClE,OAAS4H,aAAa5H,OACtB8H,QAAUF,aAAaE,WACd,YAAX9H,OAAsB,OAChB+H,MAAQ3N,SAASkC,cAAc,SACrCyL,MAAMC,UAAY,qBAEZC,MAAQ7N,SAASkC,cAAc,SACrC2L,MAAM1L,4BAAuBqL,aAAaM,OAAOC,oDACvCP,aAAaQ,OAAOD,4BAC9BJ,MAAMpL,YAAYsL,aAEZI,MAAQjO,SAASkC,cAAc,SAErCqH,OAAOO,QAAQA,SAASvI,SAAQ2M,WAAEzL,IAAKgB,kBAC7B0K,IAAMnO,SAASkC,cAAc,MACnCiM,IAAIhM,wBAAmBM,wBAAegB,eACtCwK,MAAM1L,YAAY4L,QAGtBR,MAAMpL,YAAY0L,OAElBlQ,MAAM+I,OAAO,CACTM,MAAO,UACPF,KAAMyG,MACNnG,KAAM,UACNR,MAAM,EACNS,eAAe,SAGnB1J,MAAM+I,OAAO,CACTM,mDAA6CqG,oBAC7CvG,KAAMwG,QACNlG,KAAM,UACNR,MAAM,EACNS,eAAe,KAgavB2G,0BAnd8B,CAAC3L,IAAKiL,eAChChM,OAASvD,MAAM4C,SAAS3C,UAAUyE,QAAQyH,UAAUyB,eAAgBtJ,WAClE4L,SAAWrO,SAASkC,cAAc,OACrBwL,QAAQhK,QAAQ,kBAEjB,IAEdgK,SADAA,QAAUA,QAAQY,UAAU,EAAGZ,QAAQhK,QAAQ,gBAC3B,IAAM3E,YAAYsI,UAAUkH,cAEpDF,SAASzG,GAAK,0BACdyG,SAASxJ,UAAY,CAAC,sBACtBwJ,SAASlM,UAAYuL,QACrBhM,OAAOa,YAAY8L,WAwcnBG,oBA7KyBhJ,gBAEnBiJ,QAAU,GAGhBtP,WAAWoC,SAAQmN,iBAEThN,OAASvD,MAAMwQ,aAAaD,SAAUtQ,UAAUgD,YAAYwN,WAE5D/E,cAAcrE,UAAW9D,OAAOmD,UAAU2B,SAAS,UACrDkI,SAASlJ,UAAYqE,aACrB4E,QAAQhN,KAAK,CAACiN,SAAAA,SAAU7E,YAAAA,iBAKhCgF,uBAAsB,KAClBJ,QAAQlN,SAAQuN,YAACJ,SAACA,SAAD7E,YAAWA,mBACxB6E,SAASlJ,QAAUqE,kBACbpH,IAAMiM,SAAStK,aAAa,YAClCmB,aAAa9C,IAAKoH,YAAavL,YAAYmH,WAAWhD,SAG1D+F,4BACA5E,uBAsJJ4E,0BAA2BA,0BAC3BuG,sBApJ2BC,aAEvBzQ,oBAAoB6J,MAAM6G,QADX,KAAfD,WACoC,QAEA,QAiJxCzJ,aAAcA,aACd2J,iBAxEsBC,UACP9I,cAAc8I,QAAQvH,GAAGtC,QAAQ,QAAS,OAC1ClH,UAAU8B,SAAS+F,QAE9BhI,YAAYmR,aAAanC,MAErB,KAEI/O,QAAQmR,eAAeF,QAAS/P,gBAE3B6N,MAAK,KACFjP,IAAIgE,KAAK,mBAAqBmN,QAAQvH,OAEzCsF,OAAO5B,IACJtN,IAAIyN,MAAMH"}