{"version":3,"file":"uiHelpers.min.js","sources":["../../src/local/uiHelpers.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n *  description here.\n *\n * @module     'local_deepler'; // Full name of the plugin (used for diagnostics)./local/uiHelpers\n * @copyright  2025 Bruno Baudry <bruno.baudry@bfh.ch>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['core/modal',\n    'core/log',\n    'editor_tiny/loader',\n    'editor_tiny/editor',\n    './utils',\n    './selectors',\n    './customevents',\n    './translation'\n    ], (\n        Modal,\n        Log,\n        TinyMCEinit,\n        TinyMCE,\n        Utils,\n        Selectors,\n        Events,\n        Translation)=>{\n    let mainContainer;\n    let formContainer;\n    let settingsContainer;\n    let sourcetargetContainer;\n    let activityfilterContainer;\n    let statusfilterContainer;\n    // Let preloader;\n    let config = {};\n    let format = new Intl.NumberFormat();\n    let autotranslateButton = {};\n    let saveAllBtn = {};\n    let saveAllModal = {};\n    let langstrings = {};\n    let selectAllBtn = {};\n    let removedIframes = [];\n    let allDataFormatOne = [];\n    let checkboxes = [];\n    let allRows = [];\n    let glossaryDetailViewr;\n    let checkBoxParentMap = new Map();\n    const optionsForTiny = {\n        subdirs: false,\n        maxbytes: 10240,\n        maxfiles: 0,\n        noclean: true,\n        trusttext: true,\n        // eslint-disable-next-line camelcase\n        enable_filemanagement: false,\n        autosave: false,\n        removeorphaneddrafts: true,\n        plugins: []\n    };\n    // Const ON_STATUS_CHANGED = 'onStatusChanged';\n    // Cached DOM elements\n    const cachedSelectors = {\n        wordCount: document.querySelector(Selectors.statuses.wordcount),\n        charWithSpace: document.querySelector(Selectors.statuses.charNumWithSpace),\n        charWOSpace: document.querySelector(Selectors.statuses.charNumWithOutSpace),\n        deeplUseSpan: document.querySelector(Selectors.statuses.deeplUsage),\n        deeplMaxSpan: document.querySelector(Selectors.statuses.deeplMax),\n        deeplStatusContainer: document.querySelector(Selectors.statuses.deeplStatusContainer)\n    };\n    /**\n     * Toggle iFrames in sourcetexts.\n     */\n    function doHideiframes() {\n        const isChecked = settingsQuery(Selectors.actions.hideiframes);\n        const allIframes = formQueryAll(Selectors.sourcetexts.iframes);\n        if (!isChecked && allIframes.length > 0) {\n            removedIframes = [];\n            allIframes.forEach(iframe => {\n                removedIframes.push({\n                    parent: iframe.parentNode,\n                    nextSibling: iframe.nextSibling,\n                    html: iframe.outerHTML\n                });\n                iframe.remove();\n            });\n        } else if (removedIframes.length > 0) {\n            // Restore all previously removed iframes.\n            removedIframes.forEach(info => {\n                // Create a new element from the stored HTML.\n                const tempDiv = document.createElement('div');\n                tempDiv.innerHTML = info.html;\n                const newIframe = tempDiv.firstChild;\n                // Insert it back into the DOM\n                if (info.nextSibling) {\n                    info.parent.insertBefore(newIframe, info.nextSibling);\n                } else {\n                    info.parent.appendChild(newIframe);\n                }\n            });\n            removedIframes = [];\n        }\n    }\n    /**\n     * Get the editor container based on recieved current user's editor preference.\n     *\n     * @param {string} key Translation Key\n     * @param {HTMLElement} row\n     */\n    const findEditor = (key, row) => {\n        let e = formQuery(Selectors.editors.types.basic, key, row);\n        let et = 'basic';\n        if (e === null) {\n            let r = null;\n            let editorTab = [\"atto\", \"tiny\", \"marklar\", \"textarea\"];\n            if (editorTab.indexOf(config.userPrefs) === -1) {\n                Log.warn('Unsupported editor ' + config.userPrefs);\n            } else {\n                // First let's try the current editor.\n                try {\n                    r = findEditorByType(key, config.userPrefs, row);\n                } catch (error) {\n                    // Content was edited by another editor.\n                    Log.trace(`Editor not found: ${config.userPrefs} for key ${key}`);\n                }\n            }\n            return r;\n        } else {\n            return {editor: e, editorType: et};\n        }\n    };\n    /**\n     * @param {string} key\n     * @param {object} editorType\n     * @param {HTMLElement} row\n     * @returns {{editor: HTMLElement, editorType: string}}\n     */\n    const findEditorByType = (key, editorType, row) => {\n        let et = 'basic';\n        let ed = null;\n        switch (editorType) {\n            case \"atto\" :\n                et = 'iframe';\n                ed = formQuery(Selectors.editors.types.atto, key, row);\n                break;\n            case \"tiny\":\n                et = 'iframe';\n                ed = findTinyInstanceByKey(key);\n                break;\n            case 'marklar':\n            case \"textarea\" :\n                ed = formQuery(Selectors.editors.types.other, key, row);\n                break;\n        }\n        return {editor: ed, editorType: et};\n    };\n    /**\n     * Finds TinyMCE instance.\n     * @param {string} key\n     * @returns {Node}\n     */\n    const findTinyInstanceByKey = (key)=> {\n        let editor = null;\n        TinyMCE.getAllInstances().every((k, v)=>{\n            if (v.attributes.name.value.indexOf(key) === 0) {\n                editor = k.getBody();\n                return false;\n            }\n            return true;\n        });\n        return editor;\n    };\n    /**\n     * Hides an item's error message.\n     *\n     * @param {String} key\n     */\n/*    const hideErrorMessage = (key) => {\n        let parent = formQuery(Selectors.editors.multiples.editorsWithKey, key);\n        let alertChild = domQuery('.alert-danger', '', parent);\n        if (alertChild) {\n            parent.removeChild(alertChild);\n        }\n    };*/\n    /**\n     * Hides an item's error message.\n     *\n     * @param {HTMLElement} row\n     */\n    const hideErrorMessageForRow = (row) => {\n        let alertChild = domQuery('.alert-danger', '', row);\n        if (alertChild) {\n            row.removeChild(alertChild);\n        }\n    };\n    /**\n     * Display an error message attached to the item's editor.\n     * @param {String} key\n     * @param {String} message\n     */\n    const showErrorMessageForEditor = (key, message) => {\n        let parent = formQuery(Selectors.editors.multiples.editorsWithKey, key);\n        const errorMsg = document.createElement('div');\n        const indexOfSET = message.indexOf(\"Data too long\");// Probably a text too long for the field if not -1.\n        // Display granular error messages.\n        if (indexOfSET > -1) {\n            message = message.substring(0, message.indexOf('WHERE id=?'));\n            message = message + ' ' + langstrings.uistrings.errortoolong;\n        }\n        errorMsg.id = 'local_deepler__errormsg';\n        errorMsg.classList = ['alert alert-danger'];\n        errorMsg.innerHTML = message;\n        parent.appendChild(errorMsg);\n    };\n    const showEntriesModal = (ajaxResponse)=>{\n        const glossaryid = ajaxResponse.glossaryid;\n        const entries = JSON.parse(ajaxResponse.entries);\n        const status = ajaxResponse.status;\n        const message = ajaxResponse.message;\n        if (status === 'success') {\n            const table = document.createElement('table');\n            table.className = 'generaltable';\n            // Create the header.\n            const thead = document.createElement('thead');\n            thead.innerHTML = `<tr><th>${ajaxResponse.source.toUpperCase()}</th>\n                <th>${ajaxResponse.target.toUpperCase()}</th></tr>`;\n            table.appendChild(thead);\n\n            const tbody = document.createElement('tbody');\n\n            Object.entries(entries).forEach(([key, value]) => {\n                const row = document.createElement('tr');\n                row.innerHTML = `<td>${key}</td><td>${value}</td>`;\n                tbody.appendChild(row);\n            });\n\n            table.appendChild(tbody);\n\n            Modal.create({\n                title: 'Entries',\n                body: table,\n                type: 'default',\n                show: true,\n                removeOnClose: true,\n            });\n        } else {\n            Modal.create({\n                title: `Error fetching entries for<br/><em>${glossaryid}</em>`,\n                body: message,\n                type: 'default',\n                show: true,\n                removeOnClose: true,\n            });\n        }\n    };\n    /**\n     * Launch, display count of Words And Chars.\n     */\n    const countWordAndChar = () => {\n        let wrdsc = 0,\n            cws = 0,\n            cwos = 0;\n\n        // Cache checkboxes matching selector once, convert to array if needed.\n        const checkedBoxes = Array.from(formQueryAll(Selectors.statuses.checkedCheckBoxes));\n\n        // Aggregate counts in one loop.\n        checkedBoxes.forEach(ckBox => {\n            const key = ckBox.getAttribute(\"data-key\");\n            const results = getCount(key);\n            wrdsc += results.wordCount;\n            cws += results.charNumWithSpace;\n            cwos += results.charNumWithOutSpace;\n        });\n\n        // Cache DOM elements once for output instead of querying repeatedly.\n        const wordCount = cachedSelectors.wordCount;\n        const charWithSpace = cachedSelectors.charWithSpace;\n        const charWOSpace = cachedSelectors.charWOSpace;\n        const deeplUseSpan = cachedSelectors.deeplUseSpan;\n        const deeplMaxSpan = cachedSelectors.deeplMaxSpan;\n        const parent = cachedSelectors.deeplStatusContainer;\n\n        // Calculate current usage once.\n        const current = cws + config.usage.character.count;\n\n        // Update UI in one batch (minimizes layout thrashing).\n        wordCount.innerText = wrdsc;\n        charWithSpace.innerText = cws;\n        charWOSpace.innerText = cwos;\n        deeplUseSpan.innerText = format.format(current);\n        deeplMaxSpan.innerText = config.usage.character.limit === null ? 'âˆž' : format.format(config.usage.character.limit);\n\n        // Toggle classes efficiently.\n        parent.classList.toggle('alert-success', current < config.usage.character.limit || config.usage.character.limit === null);\n        parent.classList.toggle('alert-danger', current >= config.usage.character.limit && config.usage.character.limit !== null);\n    };\n    /**\n     * Compile the needed counts for info.\n     *\n     * @param {string} key\n     * @returns {{wordCount: *, charNumWithSpace: *, charNumWithOutSpace: *}}\n     */\n    const getCount = (key) => {\n        const item = formQuery(Selectors.sourcetexts.singlelangkeys, key);\n        const raw = item.getAttribute(\"data-sourcetext-raw\");\n        // Cleaned sourceText.\n        const trimmedVal = Utils.stripHTMLTags(Utils.fromBase64(raw)).trim();\n        return {\n            \"wordCount\": (trimmedVal.match(/\\S+/g) || []).length,\n            \"charNumWithSpace\": trimmedVal.length,\n            \"charNumWithOutSpace\": trimmedVal.replace(/\\s+/g, '').length\n        };\n    };\n\n    /**\n     * Factory to display process' statuses for each item.\n     *\n     * @param {HTMLElement} row\n     * @param {Boolean} checked\n     * @todo MDL-0000 optimize\n     */\n    const toggleStatus = (row, checked) => {\n        const key = row.getAttribute('data-row-id');\n        const translated = Translation.translated(key);\n        const icon = formQuery(Selectors.actions.validatorBtn, key);\n        const status = icon?.dataset.status;\n        // Let disaptchStatus = Selectors.process.wait;\n\n        if (!status) {\n            return;\n        }\n\n        switch (status) {\n            case Selectors.process.wait:\n                // Events.emit(ON_STATUS_CHANGED, key );\n                if (checked) {\n                    setIconElementStatus(icon, Selectors.process.totranslate);\n                    // DisaptchStatus = Selectors.process.totranslate;\n                }\n                break;\n\n            case Selectors.process.totranslate:\n                if (checked && translated) {\n                    setIconElementStatus(icon, Selectors.process.tosave, true);\n                    // DisaptchStatus = Selectors.process.tosave;\n                } else {\n                    setIconElementStatus(icon, Selectors.process.wait);\n                }\n                break;\n\n            case Selectors.process.tosave:\n                if (!checked) {\n                    setIconElementStatus(icon, Selectors.process.totranslate);\n                    // DisaptchStatus = Selectors.process.totranslate;\n                }\n                break;\n\n            case Selectors.process.failed:\n                if (checked) {\n                    setIconElementStatus(icon, Selectors.process.totranslate);\n                    // DisaptchStatus = Selectors.process.totranslate;\n                }\n                break;\n\n            case Selectors.process.success:\n                // DisaptchStatus = Selectors.process.success;\n                break;\n\n            case Selectors.process.saved:\n                if (checked) {\n                    setIconElementStatus(icon, Selectors.process.totranslate);\n                    // DisaptchStatus = Selectors.process.totranslate;\n                }\n                break;\n        }\n        // Events.emit(ON_STATUS_CHANGED, key, disaptchStatus);\n    };\n    /**\n     * Change translation process status icon.\n     *\n     * @param {element} icon\n     * @param {string} status\n     * @param {boolean} isBtn\n     * @todo MDL-0000 optimize\n     */\n    const setIconElementStatus = (icon, status = Selectors.process.wait, isBtn = false) => {\n        if (!icon) {\n         return;\n        }\n\n        const classList = icon.classList;\n\n        // Update classes only if needed\n        if (isBtn) {\n            if (!classList.contains('btn')) {\n                classList.add('btn', 'btn-outline-secondary');\n            }\n            if (classList.contains('disable')) {\n                classList.remove('disable');\n            }\n        } else {\n            if (!classList.contains('disable')) {\n                classList.add('disable');\n            }\n            if (classList.contains('btn')) {\n                classList.remove('btn', 'btn-outline-secondary');\n            }\n        }\n\n        // Update attributes only if changed\n        if (icon.getAttribute('role') !== (isBtn ? 'button' : 'status')) {\n            icon.setAttribute('role', isBtn ? 'button' : 'status');\n        }\n\n        if (icon.dataset.status !== status) {\n            icon.setAttribute('data-status', status);\n        }\n\n        const title = langstrings.statusstrings[status.replace('local_deepler/', '')];\n        if (icon.getAttribute('title') !== title) {\n            icon.setAttribute('title', title);\n        }\n    };\n\n\n    const setIconStatus = (key, status = Selectors.process.wait, isBtn = false) => {\n        let icon = formQuery(Selectors.actions.validatorBtn, key);\n        setIconElementStatus(icon, status, isBtn);\n    };\n    /**\n     * Get the translation row status icon.\n     *\n     * @param {string} key\n     * @returns {*}\n     */\n    const getIconStatus = (key)=> {\n        return formQuery(Selectors.actions.validatorBtn, key).getAttribute('data-status');\n    };\n    /**\n     * Opens a modal infobox to warn user trunks of fields are saving.\n     * @param {object} messageObject\n     * @returns {Promise<void>}\n     */\n    const launchModal = async(messageObject) => {\n        saveAllModal = await Modal.create(messageObject);\n        await saveAllModal.show();\n    };\n    const launchTranslatingModal = ()=>{\n        return launchModal(\n            {\n                title: langstrings.uistrings.translatemodaltitle,\n                body: langstrings.uistrings.translatemodalbody,\n            }\n        );\n    };\n    const launchSaveAllModal = ()=>{\n        launchModal(\n            {\n                title: langstrings.uistrings.saveallmodaltitle,\n                body: langstrings.uistrings.saveallmodalbody,\n            }\n        ).then(r => Log.info('SaveAll Modal launched ' + r)).catch((reason)=>{\n            Log.error(reason);\n        });\n    };\n    const dbErrorPartialModal = (stringVar)=>{\n        const body = langstrings.uistrings.errordbpartial.replace('{$a}', stringVar);\n        dbErrorModal(body);\n    };\n    const dbErrorModal = (body, titleSuffix = '')=>{\n        let title = langstrings.uistrings.errordbtitle;\n        if (titleSuffix !== '') {\n            title += titleSuffix;\n        }\n        presentDialogModal(title, body, 'alert');\n    };\n    const deeplErrorModal = (body)=>{\n        presentDialogModal(langstrings.uistrings.deeplapiexception, body, 'Alert');\n    };\n    const presentDialogModal = (title, body, type = 'default') => {\n        Modal.create({\n            title: title,\n            body: body,\n            type: type,\n            show: true,\n            removeOnClose: true,\n        });\n    };\n\n    const hideModal = ()=>{\n        if (saveAllModal !== null && saveAllModal.isVisible) {\n            saveAllModal.hide();\n        }\n    };\n    const backToBase = () => {\n        const offsetTop = domQuery(Selectors.config.langstrings).offsetTop;\n        window.scrollTo({top: offsetTop - 5, behavior: 'smooth'});\n    };\n\n    const resizeEditors = ()=>{\n        allDataFormatOne.forEach((editable)=>{\n            const grandparent = editable.closest('[data-row-id]');\n            const sourceTextSinglelang = formQuery(Selectors.sourcetexts.singlelang, '', grandparent);\n            const sourceTextMultilang = formQuery(Selectors.sourcetexts.multilangs, '', grandparent);\n             const updateEditableHeight = ()=> {\n                 const offsetElement = sourceTextMultilang.classList.contains('show') ? sourceTextMultilang : sourceTextSinglelang;\n               const totalHeight = offsetElement.offsetHeight + 80; // Tiny header average height is 80.\n                editable.style.height = totalHeight + 'px';\n            };\n\n            // Observe size changes in parent and grandparent.\n             const resizeObserver = new ResizeObserver(() => {\n                updateEditableHeight();\n            });\n             resizeObserver.observe(sourceTextSinglelang);\n             resizeObserver.observe(sourceTextMultilang);\n        });\n    };\n\n\n    /**\n     * Toggle Autotranslate Button\n     */\n    const toggleAutotranslateButton = () => {\n        // Use Array.some() for early exit when a checked checkbox is found\n        autotranslateButton.disabled = !Array.from(checkboxes).some(e => e.checked);\n    };\n\n    /**\n     * Toggle checkboxes\n     * @param {Boolean} checked\n     */\n    const toggleAllCheckboxes = (checked) => {\n        const updates = [];\n        // Prepare all updates without applying immediately.\n        checkboxes.forEach(checkbox => {\n            // Parent row.\n            let parent;\n            if (!checkBoxParentMap.has(checkbox)) {\n                parent = Utils.getParentRow(checkbox, Selectors.sourcetexts.parentrow);\n                checkBoxParentMap.set(checkbox, parent);\n            } else {\n                parent = checkBoxParentMap.get(checkbox);\n            }\n            // If the row is checked, verifiy that the parent is not hidden else do not select.\n            const shouldCheck = checked ? !parent.classList.contains('d-none') : false;\n            if (checkbox.checked !== shouldCheck) {\n                updates.push({checkbox, shouldCheck});\n            }\n        });\n        // Apply updates in the next animation frame, batching DOM writes.\n        requestAnimationFrame(() => {\n            updates.forEach(({checkbox, shouldCheck}) => {\n                checkbox.checked = shouldCheck;\n                const rowEl = checkBoxParentMap.get(checkbox);\n                toggleStatus(rowEl, shouldCheck);\n            });\n            toggleAutotranslateButton();\n            countWordAndChar();\n        });\n    };\n    const toggleGlossaryDetails = (glossaryId)=> {\n        if (glossaryId !== '') {\n            glossaryDetailViewr.style.display = 'block';\n        } else {\n            glossaryDetailViewr.style.display = 'none';\n        }\n    };\n    /**\n     * Wrap debounce for displaying rows.\n     * @type {(function(...[*]): void)|*}\n     */\n    const debouncedShowRows = Utils.debounce(() => {\n        showRows();\n    }, 100);\n    /**\n     * Shows/hides rows.\n     */\n    const showRows = () => {\n        // Map each selector to its corresponding checkbox checked state\n        const selectorMap = {\n            [Selectors.statuses.updated]: statusFilterQuery(Selectors.actions.showUpdated).checked,\n            [Selectors.statuses.needsupdate]: statusFilterQuery(Selectors.actions.showNeedUpdate).checked,\n            [Selectors.statuses.hidden]: statusFilterQuery(Selectors.actions.showHidden).checked\n        };\n\n        // Combine all selectors into one comma-separated string for batch querying.\n        const mergedSelector = Object.keys(selectorMap).join(\",\");\n\n        // Query all items matching any of the selectors once.\n        const allItems = formQueryAll(mergedSelector);\n\n        // Cache the global \"select all\" button checked state once.\n        const allSelected = statusFilterQuery(Selectors.actions.selectAllBtn).checked;\n\n        allItems.forEach(item => {\n            // Determine which selector this item matches so we can apply the right checkbox state.\n            let shouldShow = false;\n            let shouldCheck = false;\n            for (const [selector, checked] of Object.entries(selectorMap)) {\n                if (item.matches(selector)) {\n                    shouldShow = checked;\n                    shouldCheck = allSelected && checked;\n                    break;\n                }\n            }\n\n            // Show or hide item based on checkbox state.\n            item.classList.toggle(\"d-none\", !shouldShow);\n\n            // Handle checkbox selection for this item or its children.\n            let rowId = item.getAttribute('data-row-id');\n            if (rowId === null) {\n                // For items without row-id, toggle checkboxes of their child rows.\n                const childs = formQueryAll(Selectors.statuses.hiddenForStudentRows, '', item);\n                childs.forEach(child => {\n                    const childId = child.getAttribute('data-row-id');\n                    toggleChildCheckBoxSelection(childId, shouldCheck);\n                });\n            } else {\n                toggleChildCheckBoxSelection(rowId, shouldCheck);\n            }\n        });\n\n        // Call global UI update functions once\n        toggleAutotranslateButton();\n        countWordAndChar();\n        resizeEditors();\n    };\n    /**\n     * Manages selection and icon status of fields.\n     *\n     * @param {HTMLElement} row\n     * @param {bool} shouldBeChecked\n     */\n    const toggleChildCheckBoxSelection = (row, shouldBeChecked)=>{\n        // Normalize to element\n        const rowEl = typeof row === 'string' ? formQuery(Selectors.actions.corerowid, row) : row;\n        if (!rowEl) {\n            return;\n        }\n        const single = formQuery(Selectors.actions.checkBoxes, '', rowEl);\n        if (single) {\n            single.checked = shouldBeChecked;\n        }\n        toggleStatus(rowEl, false);\n    };\n/*    Const togglePreloader = () => {\n        if (preloader?.classList.contains('show') || preloader?.classList.contains('d-block')) {\n            preloader.classList.remove('show', 'd-block');\n            preloader.classList.add('d-none');\n        } else {\n            preloader.classList.remove('d-none');\n            preloader.classList.add('show', 'd-block');\n        }\n    };*/\n\n    const wrapTinyOnTarget = (element)=>{\n        const status = getIconStatus(element.id.replace('tiny_', ''));\n        if (status === Selectors.process.tosave) {\n            // eslint-disable-next-line promise/catch-or-return\n            TinyMCEinit.getTinyMCE().then(\n                // eslint-disable-next-line promise/always-return\n                ()=>{\n                    // eslint-disable-next-line promise/no-nesting\n                    TinyMCE.setupForTarget(element, optionsForTiny)\n                        // eslint-disable-next-line promise/always-return\n                        .then(()=>{\n                            Log.info('tiny loaded for ' + element.id);\n                        })\n                        .catch((r)=>{\n                            Log.error(r);\n                        });\n                }\n            );\n        }\n    };\n    const disableSaveButton = ()=>{\n        saveAllBtn.disabled = true;\n    };\n    const enableSaveButton = ()=>{\n        saveAllBtn.disabled = false;\n    };\n    const disableTranslateButton = ()=>{\n        autotranslateButton.disabled = true;\n    };\n    const enableTranslateButton = ()=>{\n        autotranslateButton.disabled = false;\n    };\n    const registerUI = () => {\n        // Capture the main to restrict Dom queries.\n        mainContainer = document.querySelector(Selectors.config.main);\n        formContainer = mainContainer.querySelector(Selectors.config.form);\n        allRows = formQueryAll(Selectors.actions.corerowid);\n        settingsContainer = mainContainer.querySelector(Selectors.config.advancedsettings);\n        sourcetargetContainer = mainContainer.querySelector(Selectors.config.sourcetarget);\n        Log.log(sourcetargetContainer);\n        activityfilterContainer = mainContainer.querySelector(Selectors.config.activityfilter);\n        statusfilterContainer = mainContainer.querySelector(Selectors.config.statusfilter);\n        if (!glossaryDetailViewr && document.querySelector(Selectors.glossary.entriesviewerPage)) {\n            glossaryDetailViewr = document.querySelector(Selectors.glossary.entriesviewerPage);\n        }\n        autotranslateButton = statusFilterQuery(Selectors.actions.autoTranslateBtn);\n        checkboxes = formQueryAll(Selectors.actions.checkBoxes);\n        allDataFormatOne = formQueryAll(Selectors.editors.targetarea);\n        selectAllBtn = statusFilterQuery(Selectors.actions.selectAllBtn);\n        saveAllBtn = statusFilterQuery(Selectors.actions.saveAll);\n        langstrings = JSON.parse(domQuery(Selectors.config.langstrings).getAttribute('data-langstrings'));\n    };\n    /**\n     *\n     * @param {string} key\n     * @param {string} selector\n     * @param {int} courseId\n     * @returns {{key, courseid, id: number, tid: *, table: *, field: *}}\n     */\n/*    const prepareDBitem = (key, selector, courseId) => {\n        const element = domQuery(selector, key);\n        return {\n            key: key,\n            courseid: courseId,\n            id: parseInt(element.getAttribute(\"data-id\")),\n            tid: element.getAttribute(\"data-tid\"),\n            table: element.getAttribute(\"data-table\"),\n            field: element.getAttribute(\"data-field\"),\n            cmid: element.getAttribute(\"data-cmid\"),\n        };\n    };*/\n    /**\n     *\n     * @param {HTMLElement} row\n     * @param {int} courseId\n     */\n    const prepareRowForDB = (row, courseId)=>{\n        const key = row.getAttribute(\"data-row-id\");\n        return {\n            key: key,\n            courseid: courseId,\n            tid: row.getAttribute(\"data-tid\")\n        };\n    };\n    /**\n     *\n     * @param {String} selector\n     * @param {String} key\n     * @param {HTMLElement} parent\n     * @returns {HTMLElement}\n     */\n    const formQuery = (selector, key = '', parent = null)=>{\n        return domQuery(selector, key, parent ?? formContainer);\n    };\n    /**\n     *\n     * @param {String} selector\n     * @param {String} key\n     * @param {HTMLElement} parent\n     * @returns {HTMLElement}\n     */\n    const settingsQuery = (selector, key = '', parent = null)=>{\n        return domQuery(selector, key, parent ?? settingsContainer);\n    };\n    /**\n     *\n     * @param {String} selector\n     * @param {String} key\n     * @param {HTMLElement} parent\n     * @returns {HTMLElement}\n     */\n/*    Const sourceTargetQuery = (selector, key = '', parent = null)=>{\n        return domQuery(selector, key, parent ?? sourcetargetContainer);\n    };*/\n    const activityFilterQuery = (selector, key = '', parent = null)=>{\n        return domQuery(selector, key, parent ?? activityfilterContainer);\n    };\n    /**\n     *\n     * @param {String} selector\n     * @param {String} key\n     * @param {HTMLElement} parent\n     * @returns {HTMLElement}\n     */\n    const statusFilterQuery = (selector, key = '', parent = null)=>{\n        return domQuery(selector, key, parent ?? statusfilterContainer);\n    };\n    /**\n     *\n     * @param {String} selector\n     * @param {String} key\n     * @param {HTMLElement} parent\n     * @returns {NodeList}\n     */\n    const formQueryAll = (selector, key = '', parent = null)=>{\n        return domQueryAll(selector, key, parent ?? formContainer);\n    };\n    /**\n     *\n     * @param {String} selector\n     * @param {String} key\n     * @param {HTMLElement} parent\n     * @returns {NodeList}\n     */\n    const settingsQueryAll = (selector, key = '', parent = null)=>{\n        return domQueryAll(selector, key, parent ?? settingsContainer);\n    };\n    /**\n     *\n     * @param {String} selector\n     * @param {String} key\n     * @param {HTMLElement} parent\n     * @returns {NodeList}\n     */\n/*    Const sourceTargetQueryAll = (selector, key = '', parent = null)=>{\n        return domQueryAll(selector, key , parent ?? sourcetargetContainer);\n    };*/\n    /**\n     *\n     * @param {String} selector\n     * @param {String} key\n     * @param {HTMLElement} parent\n     * @returns {NodeList}\n     */\n    const activityFilterQueryAll = (selector, key = '', parent = null)=>{\n        return domQueryAll(selector, key, parent ?? activityfilterContainer);\n    };\n    /**\n     *\n     * @param {String} selector\n     * @param {String} key\n     * @param {HTMLElement} parent\n     * @returns {NodeList}\n     */\n    const statusFilterQueryAll = (selector, key = '', parent = null)=>{\n        return domQueryAll(selector, key, parent ?? statusfilterContainer);\n    };\n    /**\n     * Shortcut for dom querySelector.\n     *\n     * @param {string} selector\n     * @param {string} key\n     * @param {HTMLElement} target\n     * @returns {HTMLElement}\n     */\n    const domQuery = (selector, key = '', target = null) => {\n        const el = target ?? mainContainer;\n        const q = key === '' ? selector : selector.replace(\"<KEY>\", key);\n        return el.querySelector(q);\n    };\n\n    /**\n     * Shortcut for dom querySelector.\n     *\n     * @param {string} selector\n     * @param {string} key\n     * @param {HTMLElement} target\n     * @returns {NodeList}\n     */\n    const domQueryAll = (selector, key = '', target = null) => {\n        const el = target ?? mainContainer;\n        const q = key === '' ? selector : selector.replace(\"<KEY>\", key);\n        return el.querySelectorAll(q);\n    };\n    const init = (cfg) => {\n        // Preloader = pr;\n        config = cfg;\n        registerUI();\n        // Make the main UI adjustments\n        doHideiframes();\n        toggleAutotranslateButton();\n        // SaveAllBtn.disabled = true;\n        disableSaveButton();\n        selectAllBtn.disabled = config.targetlang === '';\n        checkboxes.forEach((node) => {\n            node.disabled = selectAllBtn.disabled;\n        });\n        // Initial edit.\n        allRows.forEach(\n            (row)=>{\n                const key = row.getAttribute('data-row-id');\n                const editor = findEditor(key, row);\n                const sourceEl = formQuery(Selectors.sourcetexts.singlelangkeys, key, row);\n                const srcRaw = sourceEl ? sourceEl.getAttribute('data-sourcetext-raw') : '';\n                const multiRaw = sourceEl ? sourceEl.getAttribute('data-filedtext-raw') : '';\n                Translation.initTemp(\n                    key,\n                    editor.editor,\n                    editor.editorType,\n                    srcRaw,\n                    multiRaw\n                );\n            }\n        );\n        debouncedShowRows();\n    };\n    return {\n        // ON_STATUS_CHANGED: ON_STATUS_CHANGED,\n        domQuery: domQuery,\n        formQuery: formQuery,\n        formQueryAll: formQueryAll,\n        settingsQuery: settingsQuery,\n        settingsQueryAll: settingsQueryAll,\n        statusFilterQuery: statusFilterQuery,\n        statusFilterQueryAll: statusFilterQueryAll,\n        activityFilterQuery: activityFilterQuery,\n        activityFilterQueryAll: activityFilterQueryAll,\n        domQueryAll: domQueryAll,\n        backToBase: backToBase,\n        countWordAndChar: countWordAndChar,\n        dbErrorModal: dbErrorModal,\n        dbErrorPartialModal: dbErrorPartialModal,\n        disableSaveButton: disableSaveButton,\n        disableTranslateButton: disableTranslateButton,\n        enableSaveButton: enableSaveButton,\n        enableTranslateButton: enableTranslateButton,\n        debouncedShowRows: debouncedShowRows,\n        deeplErrorModal: deeplErrorModal,\n        doHideiframes: doHideiframes,\n        findEditor: findEditor,\n        getIconStatus: getIconStatus,\n        hideModal: hideModal,\n        // HideErrorMessage: hideErrorMessage,\n        hideErrorMessageForRow: hideErrorMessageForRow,\n        init: init,\n        launchModal: launchModal,\n        launchSaveAllModal: launchSaveAllModal,\n        launchTranslatingModal: launchTranslatingModal,\n        prepareRowForDB: prepareRowForDB,\n        presentDialogModal: presentDialogModal,\n        setIconStatus: setIconStatus,\n        showEntriesModal: showEntriesModal,\n        showErrorMessageForEditor: showErrorMessageForEditor,\n        toggleAllCheckboxes: toggleAllCheckboxes,\n        toggleAutotranslateButton: toggleAutotranslateButton,\n        toggleGlossaryDetails: toggleGlossaryDetails,\n        toggleStatus: toggleStatus,\n        wrapTinyOnTarget: wrapTinyOnTarget\n    };\n});\n"],"names":["define","Modal","Log","TinyMCEinit","TinyMCE","Utils","Selectors","Events","Translation","mainContainer","formContainer","settingsContainer","sourcetargetContainer","activityfilterContainer","statusfilterContainer","glossaryDetailViewr","config","format","Intl","NumberFormat","autotranslateButton","saveAllBtn","saveAllModal","langstrings","selectAllBtn","removedIframes","allDataFormatOne","checkboxes","allRows","checkBoxParentMap","Map","optionsForTiny","subdirs","maxbytes","maxfiles","noclean","trusttext","enable_filemanagement","autosave","removeorphaneddrafts","plugins","cachedSelectors","wordCount","document","querySelector","statuses","wordcount","charWithSpace","charNumWithSpace","charWOSpace","charNumWithOutSpace","deeplUseSpan","deeplUsage","deeplMaxSpan","deeplMax","deeplStatusContainer","doHideiframes","isChecked","settingsQuery","actions","hideiframes","allIframes","formQueryAll","sourcetexts","iframes","length","forEach","iframe","push","parent","parentNode","nextSibling","html","outerHTML","remove","info","tempDiv","createElement","innerHTML","newIframe","firstChild","insertBefore","appendChild","findEditor","key","row","e","formQuery","editors","types","basic","r","indexOf","userPrefs","warn","findEditorByType","error","trace","editor","editorType","et","ed","atto","findTinyInstanceByKey","other","getAllInstances","every","k","v","attributes","name","value","getBody","countWordAndChar","wrdsc","cws","cwos","Array","from","checkedCheckBoxes","ckBox","getAttribute","results","getCount","current","usage","character","count","innerText","limit","classList","toggle","raw","singlelangkeys","trimmedVal","stripHTMLTags","fromBase64","trim","match","replace","toggleStatus","checked","translated","icon","validatorBtn","status","dataset","process","wait","setIconElementStatus","totranslate","tosave","failed","success","saved","isBtn","contains","add","setAttribute","title","statusstrings","getIconStatus","launchModal","async","create","messageObject","show","dbErrorModal","body","titleSuffix","uistrings","errordbtitle","presentDialogModal","type","removeOnClose","resizeEditors","editable","grandparent","closest","sourceTextSinglelang","singlelang","sourceTextMultilang","multilangs","resizeObserver","ResizeObserver","totalHeight","offsetHeight","style","height","updateEditableHeight","observe","toggleAutotranslateButton","disabled","some","debouncedShowRows","debounce","showRows","selectorMap","updated","statusFilterQuery","showUpdated","needsupdate","showNeedUpdate","hidden","showHidden","mergedSelector","Object","keys","join","allItems","allSelected","item","shouldShow","shouldCheck","selector","entries","matches","rowId","hiddenForStudentRows","child","childId","toggleChildCheckBoxSelection","shouldBeChecked","rowEl","corerowid","single","checkBoxes","disableSaveButton","domQuery","domQueryAll","target","el","q","querySelectorAll","settingsQueryAll","statusFilterQueryAll","activityFilterQuery","activityFilterQueryAll","backToBase","offsetTop","window","scrollTo","top","behavior","dbErrorPartialModal","stringVar","errordbpartial","disableTranslateButton","enableSaveButton","enableTranslateButton","deeplErrorModal","deeplapiexception","hideModal","isVisible","hide","hideErrorMessageForRow","alertChild","removeChild","init","cfg","main","form","advancedsettings","sourcetarget","log","activityfilter","statusfilter","glossary","entriesviewerPage","autoTranslateBtn","targetarea","saveAll","JSON","parse","targetlang","node","sourceEl","srcRaw","multiRaw","initTemp","launchSaveAllModal","saveallmodaltitle","saveallmodalbody","then","catch","reason","launchTranslatingModal","translatemodaltitle","translatemodalbody","prepareRowForDB","courseId","courseid","tid","setIconStatus","showEntriesModal","ajaxResponse","glossaryid","message","table","className","thead","source","toUpperCase","tbody","_ref","showErrorMessageForEditor","multiples","editorsWithKey","errorMsg","substring","errortoolong","id","toggleAllCheckboxes","updates","checkbox","has","get","getParentRow","parentrow","set","requestAnimationFrame","_ref2","toggleGlossaryDetails","glossaryId","display","wrapTinyOnTarget","element","getTinyMCE","setupForTarget"],"mappings":"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"}