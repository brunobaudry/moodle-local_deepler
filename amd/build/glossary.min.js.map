{"version":3,"file":"glossary.min.js","sources":["../src/glossary.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n *  description here.\n *\n * @module     local_deepler/deepler\n * @copyright  2025 Bruno Baudry <bruno.baudry@bfh.ch>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['./local/selectors', './local/api', './local/customevents', 'core/modal', 'core/log'],\n    function(Selectors, Api, Events, Modal, Log) {\n    let version = '';\n    const initCode = (cfg)=> {\n        version = cfg;\n        const fileInput = document.getElementById('local_deepler/fileElem');\n        const fileNameDisplay = document.getElementById('local_deepler/filename-display');\n        const createGloBtn = document.getElementById('local_deepler/createglossary');\n\n        fileInput.addEventListener('change', function() {\n            Log.info(\"change\");\n            if (fileInput.files.length > 0) {\n                fileNameDisplay.classList.remove('invisible');\n                createGloBtn.classList.remove('invisible');\n            } else {\n                fileNameDisplay.classList.add('invisible');\n                createGloBtn.classList.add('invisible');\n            }\n        });\n    };\n    const registerEventListeners = ()=>{\n        const allVisibilitySelect = document.querySelectorAll(Selectors.glossary.visibilityDropdown);\n        allVisibilitySelect.forEach((e)=>{\n        e.addEventListener('change',\n                (evt)=>{\n                    Log.info(evt.target.dataset.glossary, evt.target.value);\n                    Api.updateGlossariesVisibility(evt.target.dataset.glossary, evt.target.value);\n                }\n            );\n        });\n        const allGlossarriesEntry = document.querySelectorAll(Selectors.glossary.entriesviewer);\n        Log.info(allGlossarriesEntry);\n        allGlossarriesEntry.forEach((e)=>{\n            e.addEventListener('click',\n                (e)=>{\n                if (e.target.dataset.length !== 0 && e.target.dataset.glossary !== undefined) {\n                    Log.info(e.target.dataset.glossary);\n                    Api.getGlossariesEntries(\n                        e.target.dataset.glossary,\n                        version\n                    );\n                } else if (e.target.parentNode.dataset && e.target.parentNode.dataset.glossary) {\n                    Log.info(e.target.parentNode.dataset.glossary);\n                    Api.getGlossariesEntries(\n                        e.target.parentNode.dataset.glossary,\n                        version\n                    );\n                } else {\n                  Log.error('Cannot not find glossary ID');\n                }\n            }\n            );\n        });\n        Events.on(Api.GLOSSARY_ENTRIES_SUCCESS, showEntriesModal);\n        Events.on(Api.GLOSSARY_ENTRIES_FAILED, (e)=>{\n         Log.error(Api.GLOSSARY_ENTRIES_FAILED); Log.error(e);\n        });\n    };\n    const showEntriesModal = (ajaxResponse)=>{\n        const glossaryid = ajaxResponse.glossaryid;\n        const entries = JSON.parse(ajaxResponse.entries);\n        const status = ajaxResponse.status;\n        const message = ajaxResponse.message;\n        if (status === 'success') {\n            const table = document.createElement('table');\n            table.className = 'generaltable';\n            // Create the header.\n            const thead = document.createElement('thead');\n            thead.innerHTML = `<tr><th>${ajaxResponse.source.toUpperCase()}</th><th>${ajaxResponse.target.toUpperCase()}</th></tr>`;\n            table.appendChild(thead);\n\n            const tbody = document.createElement('tbody');\n\n            Object.entries(entries).forEach(([key, value]) => {\n                const row = document.createElement('tr');\n                row.innerHTML = `<td>${key}</td><td>${value}</td>`;\n                tbody.appendChild(row);\n            });\n\n            table.appendChild(tbody);\n\n            Modal.create({\n                title: 'Entries',\n                body: table,\n                type: 'default',\n                show: true,\n                removeOnClose: true,\n            });\n        } else {\n            Modal.create({\n                title: `Error fetching entries for<br/><em>${glossaryid}</em>`,\n                body: message,\n                type: 'default',\n                show: true,\n                removeOnClose: true,\n            });\n        }\n    };\n\n    return {\n        init: function(cfg) {\n            if (document.readyState !== 'loading') {\n                // DOM is already ready.\n                initCode(cfg);\n                registerEventListeners();\n            } else {\n                // Wait for DOMContentLoaded.\n                document.addEventListener('DOMContentLoaded', initCode);\n            }\n        }\n    };\n});\n"],"names":["define","Selectors","Api","Events","Modal","Log","version","initCode","cfg","fileInput","document","getElementById","fileNameDisplay","createGloBtn","addEventListener","info","files","length","classList","remove","add","showEntriesModal","ajaxResponse","glossaryid","entries","JSON","parse","status","message","table","createElement","className","thead","innerHTML","source","toUpperCase","target","appendChild","tbody","Object","forEach","_ref","key","value","row","create","title","body","type","show","removeOnClose","init","readyState","registerEventListeners","querySelectorAll","glossary","visibilityDropdown","e","evt","dataset","updateGlossariesVisibility","allGlossarriesEntry","entriesviewer","undefined","getGlossariesEntries","parentNode","error","on","GLOSSARY_ENTRIES_SUCCESS","GLOSSARY_ENTRIES_FAILED"],"mappings":";;;;;;;AAsBAA,OAAM,yBAAC,CAAC,oBAAqB,cAAe,uBAAwB,aAAc,YAC9E,SAASC,UAAWC,IAAKC,OAAQC,MAAOC,KACxC,IAAIC,QAAU,GACd,MAAMC,SAAYC,MACdF,QAAUE,IACV,MAAMC,UAAYC,SAASC,eAAe,0BACpCC,gBAAkBF,SAASC,eAAe,kCAC1CE,aAAeH,SAASC,eAAe,gCAE7CF,UAAUK,iBAAiB,SAAU,WACjCT,IAAIU,KAAK,UACLN,UAAUO,MAAMC,OAAS,GACzBL,gBAAgBM,UAAUC,OAAO,aACjCN,aAAaK,UAAUC,OAAO,eAE9BP,gBAAgBM,UAAUE,IAAI,aAC9BP,aAAaK,UAAUE,IAAI,aAEnC,IAwCEC,iBAAoBC,eACtB,MAAMC,WAAaD,aAAaC,WAC1BC,QAAUC,KAAKC,MAAMJ,aAAaE,SAClCG,OAASL,aAAaK,OACtBC,QAAUN,aAAaM,QAC7B,GAAe,YAAXD,OAAsB,CACtB,MAAME,MAAQnB,SAASoB,cAAc,SACrCD,MAAME,UAAY,eAElB,MAAMC,MAAQtB,SAASoB,cAAc,SACrCE,MAAMC,UAAY,WAAWX,aAAaY,OAAOC,yBAAyBb,aAAac,OAAOD,0BAC9FN,MAAMQ,YAAYL,OAElB,MAAMM,MAAQ5B,SAASoB,cAAc,SAErCS,OAAOf,QAAQA,SAASgB,QAAQC,OAAkB,IAAhBC,IAAKC,OAAMF,KACzC,MAAMG,IAAMlC,SAASoB,cAAc,MACnCc,IAAIX,UAAY,OAAOS,eAAeC,aACtCL,MAAMD,YAAYO,OAGtBf,MAAMQ,YAAYC,OAElBlC,MAAMyC,OAAO,CACTC,MAAO,UACPC,KAAMlB,MACNmB,KAAM,UACNC,MAAM,EACNC,eAAe,GAEvB,MACI9C,MAAMyC,OAAO,CACTC,MAAO,sCAAsCvB,kBAC7CwB,KAAMnB,QACNoB,KAAM,UACNC,MAAM,EACNC,eAAe,KAK3B,MAAO,CACHC,KAAM,SAAS3C,KACiB,YAAxBE,SAAS0C,YAET7C,SAASC,KAnFU6C,MACC3C,SAAS4C,iBAAiBrD,UAAUsD,SAASC,oBACrDhB,QAASiB,IAC7BA,EAAE3C,iBAAiB,SACV4C,MACGrD,IAAIU,KAAK2C,IAAItB,OAAOuB,QAAQJ,SAAUG,IAAItB,OAAOO,OACjDzC,IAAI0D,2BAA2BF,IAAItB,OAAOuB,QAAQJ,SAAUG,IAAItB,OAAOO,WAInF,MAAMkB,oBAAsBnD,SAAS4C,iBAAiBrD,UAAUsD,SAASO,eACzEzD,IAAIU,KAAK8C,qBACTA,oBAAoBrB,QAASiB,IACzBA,EAAE3C,iBAAiB,QACd2C,IAC+B,IAA5BA,EAAErB,OAAOuB,QAAQ1C,aAA8C8C,IAA9BN,EAAErB,OAAOuB,QAAQJ,UAClDlD,IAAIU,KAAK0C,EAAErB,OAAOuB,QAAQJ,UAC1BrD,IAAI8D,qBACAP,EAAErB,OAAOuB,QAAQJ,SACjBjD,UAEGmD,EAAErB,OAAO6B,WAAWN,SAAWF,EAAErB,OAAO6B,WAAWN,QAAQJ,UAClElD,IAAIU,KAAK0C,EAAErB,OAAO6B,WAAWN,QAAQJ,UACrCrD,IAAI8D,qBACAP,EAAErB,OAAO6B,WAAWN,QAAQJ,SAC5BjD,UAGND,IAAI6D,MAAM,mCAKpB/D,OAAOgE,GAAGjE,IAAIkE,yBAA0B/C,kBACxClB,OAAOgE,GAAGjE,IAAImE,wBAA0BZ,IACvCpD,IAAI6D,MAAMhE,IAAImE,yBAA0BhE,IAAI6D,MAAMT,MAiD3CJ,IAGA3C,SAASI,iBAAiB,mBAAoBP,SAEtD,EAER"}