/**
 * @module     local_deepler/deepler
 * @file       amd/src/deepler.js
 * @copyright  2022 Kaleb Heitzman <kaleb@jamfire.io>
 * @copyright  2024 Bruno Baudry <bruno.baudry@bfh.ch>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_deepler/deepler",["core/log","jquery","./local/translation","./local/scrollspy","./local/eventHandlers","./local/uiHelpers","./local/settings"],((Log,$,Translation,ScrollSpy,EventHandler,UI,Settings)=>{const debug_NONE=0,debug_MINIMAL=5,debug_NORMAL=15,debug_ALL=30719,debug_DEVELOPER=32767;let config;return{init:cfg=>{var _levelMap$config$debu;config=cfg;const level=null!==(_levelMap$config$debu={[debug_NONE]:5,[debug_MINIMAL]:3,[debug_NORMAL]:2,[debug_ALL]:1,[debug_DEVELOPER]:0}[config.debug])&&void 0!==_levelMap$config$debu?_levelMap$config$debu:5;Log.setConfig({level:level});let activeRequests=0,ajaxStopFired=!1;const preloader=document.getElementById("local_deepler_preloaderModal"),onAjaxStop=()=>{preloader&&(preloader.classList.remove("show","d-block"),preloader.classList.add("d-none")),ajaxStopFired=!0};(()=>{const originalOpen=XMLHttpRequest.prototype.open;let isNative=!0;try{isNative=originalOpen.toString().includes("[native code]")}catch(e){return Log.log("unable to determine if native"),!1}return isNative?(Log.log("useXMLHttpRequestTracking"),XMLHttpRequest.prototype.open=function(){activeRequests++,ajaxStopFired=!1,this.addEventListener("readystatechange",(function(){4===this.readyState&&(Log.log("readystatechange",activeRequests,ajaxStopFired),activeRequests--,0!==activeRequests||ajaxStopFired||(ajaxStopFired=!0,onAjaxStop()))}),!1);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];originalOpen.apply(this,args)},Log.log("Using custom XMLHttpRequest tracking."),!0):(Log.log("Theme already overrides XMLHttpRequest. Skipping custom tracking."),!1)})()||($(document).ajaxStart((function(){activeRequests++,ajaxStopFired=!1,Log.log("ajaxStart",activeRequests,ajaxStopFired)})),$(document).ajaxStop((function(){activeRequests=0,ajaxStopFired||(ajaxStopFired=!0,Log.log("ajaxStop",activeRequests,ajaxStopFired),onAjaxStop())})),Log.log("Using jQuery AJAX tracking.")),window.addEventListener("load",(cfg=>{ScrollSpy.init(".local_deepler__form","#local_deepler-scrollspy",{highestLevel:3,fadingDistance:60,offsetEndOfScope:1,offsetTop:100,crumbsmaxlen:cfg.crumbsmaxlen}),Settings.init(cfg),Translation.init(cfg),UI.init(cfg),EventHandler.init(cfg),Log.info(cfg)})(cfg))}}}));

//# sourceMappingURL=deepler.min.js.map