/**
 * @module     local_deepler/deepler
 * @file       amd/src/deepler.js
 * @copyright  2022 Kaleb Heitzman <kaleb@jamfire.io>
 * @copyright  2024 Bruno Baudry <bruno.baudry@bfh.ch>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_deepler/deepler",["./local/ui_deepler","core/log","jquery"],((UI,Log,$)=>{const debug_NONE=0,debug_MINIMAL=5,debug_NORMAL=15,debug_ALL=30719,debug_DEVELOPER=32767;return{init:cfg=>{var _levelMap$cfg$debug;const level=null!==(_levelMap$cfg$debug={[debug_NONE]:5,[debug_MINIMAL]:3,[debug_NORMAL]:2,[debug_ALL]:1,[debug_DEVELOPER]:0}[cfg.debug])&&void 0!==_levelMap$cfg$debug?_levelMap$cfg$debug:5;Log.setConfig({level:level});let activeRequests=0,ajaxStopFired=!1;const onAjaxStop=()=>{const preloader=document.getElementById("local_deepler_preloaderModal");preloader&&(preloader.classList.remove("show","d-block"),preloader.classList.add("d-none")),ajaxStopFired=!0};(()=>{const originalOpen=XMLHttpRequest.prototype.open;let isNative=!0;try{isNative=originalOpen.toString().includes("[native code]")}catch(e){return Log.log("unable to determine if native"),!1}return isNative?(Log.log("useXMLHttpRequestTracking"),XMLHttpRequest.prototype.open=function(){activeRequests++,ajaxStopFired=!1,this.addEventListener("readystatechange",(function(){Log.log("readystatechange",this.readyState),4===this.readyState&&(activeRequests--,Log.log("readystatechange",activeRequests,ajaxStopFired),0!==activeRequests||ajaxStopFired||(ajaxStopFired=!0,onAjaxStop()))}),!1);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];originalOpen.apply(this,args)},Log.log("Using custom XMLHttpRequest tracking."),!0):(Log.log("Theme already overrides XMLHttpRequest. Skipping custom tracking."),!1)})()||($(document).ajaxStart((function(){activeRequests++,ajaxStopFired=!1,Log.log("ajaxStart",activeRequests,ajaxStopFired)})),$(document).ajaxStop((function(){activeRequests=0,ajaxStopFired||(ajaxStopFired=!0,Log.log("ajaxStop",activeRequests,ajaxStopFired),onAjaxStop())})),Log.log("Using jQuery AJAX tracking.")),window.addEventListener("load",UI.init(cfg))}}}));

//# sourceMappingURL=deepler.min.js.map